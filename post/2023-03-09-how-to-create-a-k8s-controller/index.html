<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta property="og:site_name" content="Huabing Blog"><meta property="og:type" content="article"><meta property="og:image" content="https://images.unsplash.com/photo-1432821596592-e2c18b78144f?ixlib=rb-4.0.3&amp;ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&amp;auto=format&amp;fit=crop&amp;w=2370&amp;q=80"><meta property="twitter:image" content="https://images.unsplash.com/photo-1432821596592-e2c18b78144f?ixlib=rb-4.0.3&amp;ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&amp;auto=format&amp;fit=crop&amp;w=2370&amp;q=80"><meta name=title content="Kubernetes Controller 机制详解（一）"><meta property="og:title" content="Kubernetes Controller 机制详解（一）"><meta property="twitter:title" content="Kubernetes Controller 机制详解（一）"><meta name=description content="Kubernetes(简称K8s) 是一套容器编排和管理系统，可以帮助我们部署、扩展和管理容器化应用程序。在 K8s 中，Controller 是一个重要的组件，它可以根据我们的期望状态和实际状态来进行调谐，以确保我们的应用程序始终处于所需的状态。本系列文章将解析 K8s Controller 的实现机制，并介绍如何编写一个 Controller。"><meta property="og:description" content="Kubernetes(简称K8s) 是一套容器编排和管理系统，可以帮助我们部署、扩展和管理容器化应用程序。在 K8s 中，Controller 是一个重要的组件，它可以根据我们的期望状态和实际状态来进行调谐，以确保我们的应用程序始终处于所需的状态。本系列文章将解析 K8s Controller 的实现机制，并介绍如何编写一个 Controller。"><meta property="twitter:description" content="Kubernetes(简称K8s) 是一套容器编排和管理系统，可以帮助我们部署、扩展和管理容器化应用程序。在 K8s 中，Controller 是一个重要的组件，它可以根据我们的期望状态和实际状态来进行调谐，以确保我们的应用程序始终处于所需的状态。本系列文章将解析 K8s Controller 的实现机制，并介绍如何编写一个 Controller。"><meta property="twitter:card" content="summary"><meta name=keyword content="赵化冰, zhaohuabing, Zhaohuabing, , 赵化冰的网络日志, 赵化冰的博客, Zhaohuabing Blog, 博客, 个人网站, 互联网, Web, 云原生, PaaS, Istio, Kubernetes, 微服务, Microservice"><link rel="shortcut icon" href=/hugo-template/img/favicon.ico><title>Kubernetes Controller 机制详解（一） | 赵化冰的博客 | Zhaohuabing Blog</title>
<link rel=canonical href=/hugo-template/post/2023-03-09-how-to-create-a-k8s-controller/><link rel=stylesheet href=/hugo-template/css/bootstrap.min.css><link rel=stylesheet href=/hugo-template/css/hugo-theme-cleanwhite.min.css><link rel=stylesheet href=/hugo-template/css/zanshang.css><link rel=stylesheet href=/hugo-template/css/font-awesome.all.min.css><script src=/hugo-template/js/jquery.min.js></script><script src=/hugo-template/js/bootstrap.min.js></script><script src=/hugo-template/js/hux-blog.min.js></script><script src=/hugo-template/js/lazysizes.min.js></script></head><nav class="navbar navbar-default navbar-custom navbar-fixed-top"><div class=container-fluid><div class="navbar-header page-scroll"><button type=button class=navbar-toggle>
<span class=sr-only>Toggle navigation</span>
<span class=icon-bar></span>
<span class=icon-bar></span>
<span class=icon-bar></span>
</button>
<a class=navbar-brand href=/>Huabing Blog</a></div><div id=huxblog_navbar><div class=navbar-collapse><ul class="nav navbar-nav navbar-right"><li><a href=/>All Posts</a></li><li><a href=/hugo-template/categories/books/>books</a></li><li><a href=/hugo-template/categories/open-source/>open source</a></li><li><a href=/hugo-template/categories/presentations/>presentations</a></li><li><a href=/hugo-template/categories/tech/>tech</a></li><li><a href=/archive//>ARCHIVE</a></li><li><a href=/notes//>NOTES</a></li><li><a href=/about//>ABOUT</a></li><li><a href=/hugo-template/search><i class="fa fa-search"></i></a></li></ul></div></div></div></nav><script>var $body=document.body,$toggle=document.querySelector(".navbar-toggle"),$navbar=document.querySelector("#huxblog_navbar"),$collapse=document.querySelector(".navbar-collapse");$toggle.addEventListener("click",handleMagic);function handleMagic(){$navbar.className.indexOf("in")>0?($navbar.className=" ",setTimeout(function(){$navbar.className.indexOf("in")<0&&($collapse.style.height="0px")},400)):($collapse.style.height="auto",$navbar.className+=" in")}</script><style type=text/css>header.intro-header{background-image:url(https://images.unsplash.com/photo-1432821596592-e2c18b78144f?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=2370&q=80)}</style><header class=intro-header><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><div class=post-heading><div class=tags><a class=tag href=/tags/kubernetes title=Kubernetes>Kubernetes</a></div><h1>Kubernetes Controller 机制详解（一）</h1><h2 class=subheading>Kubernetes API List/Watch 机制 与 Informer 客户端库</h2><span class=meta>Posted by
赵化冰
on
Thursday, March 9, 2023</span></div></div></div></div></header><article><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2
col-md-10 col-md-offset-1
post-container"><p>Kubernetes(简称K8s) 是一套容器编排和管理系统，可以帮助我们部署、扩展和管理容器化应用程序。在 K8s 中，Controller 是一个重要的组件，它可以根据我们的期望状态和实际状态来进行调谐，以确保我们的应用程序始终处于所需的状态。本系列博文将解析 K8s Controller 的实现机制，并介绍如何编写一个 Controller。</p><h1 id=controller-原理>Controller 原理</h1><p>在 K8s 中，用户通过<strong>声明式 API</strong> 定义资源的“预期状态”，Controller 则负责监视资源的实际状态，当资源的实际状态和“预期状态”不一致时，Controller 则对系统进行必要的更改，以确保两者一致，这个过程被称之为调谐（Reconcile）。</p><p>例如下图中，用户定义了一个 Deployment 资源，其中指定了运行的容器镜像，副本数等信息。Deployment Controller 会根据该定义在 K8s 节点上创建对应的 Pod，并对这些 Pod 进行持续监控。如果某个 Pod 异常退出了，Deployment Controller 会重新创建一个 Pod，以保证系统的实际状态和用户定义的“预期状态”（8个副本）一致。</p><p><img src=https://zhaohuabing.com/static/img/2023-03-09-how-to-create-a-k8s-controller/deployment-controller.png alt></p><p>K8s 中有多种类型的 Controller，例如 Deployment Controller、ReplicaSet Controller 和 StatefulSet Controller等。每个控制器都有不同的工作原理和适用场景，但它们的基本原理都是相同的。我们也可以根据需要编写 Controller 来实现自定义的业务逻辑。</p><blockquote><p>有时候 Controller 也被叫做 Operator。这两个术语的混用有时让人感到迷惑。Controller 是一个通用的术语，凡是遵循 “Watch K8s 资源并根据资源变化进行调谐” 模式的控制程序都可以叫做 Controller。而 Operator 是一种专用的 Controller，用于在 Kubernetes 中管理一些复杂的，有状态的应用程序。例如在 Kubernetes 中管理 MySQL 数据库的 MySQL Operator。</p></blockquote><h1 id=k8s-http-api-的-list-watch-机制>K8s HTTP API 的 List Watch 机制</h1><p>前面我们讲到 Controller 需要监控 K8s 中资源的状态，这是如何实现的呢？</p><p>K8s API Server 提供了获取某类资源集合的 HTTP API，此类 API 被称为 List 接口。例如下面的 URL 可以列出 default namespace 下面的 pod。</p><pre tabindex=0><code>HTTP GET api/v1/namespaces/default/pods
</code></pre><p>在该 URL 后面加上参数 <code>?watch=true</code>，则 API Server 会对 default namespace 下面的 pod 的状态进行持续监控，并在 pod 状态发生变化时通过 <a href=https://datatracker.ietf.org/doc/html/rfc9112#name-chunked-transfer-coding>chunked</a> Response (HTTP 1.1) 或者 <a href=https://datatracker.ietf.org/doc/html/rfc9113#name-server-push>Server Push</a>（HTTP2）通知到客户端。K8s 称此机制为 <a href=https://kubernetes.io/docs/reference/using-api/api-concepts/#efficient-detection-of-changes>watch</a>。</p><pre tabindex=0><code>HTTP GET api/v1/namespaces/default/pods?watch=true
</code></pre><p><img src=https://zhaohuabing.com/static/img/2023-03-09-how-to-create-a-k8s-controller/k8s-http-api-watch.png alt></p><p>通过使用 <code>curl</code> 命令向 K8s API Server 发起 HTTP GET 请求，我们可以很直观地查看 K8s 的 List 和 Watch 接口的返回数据。</p><p>首先通过 <code>kubectl proxy</code> 启动 API Server 的代理服务器。</p><pre tabindex=0><code>kubectl proxy --port 8080
</code></pre><p>通过 <code>curl</code> 来 List pod 资源。</p><pre tabindex=0><code>curl http://localhost:8080/api/v1/namespaces/default/pods
</code></pre><p>在该命令的输出中，我们可以看到 HTTP Response 是一个 json 格式的数据结构，里面列出来目前 default namespace 中的所有 pod。在返回数据结构中有一个 <code>resourceVersion</code> 字段，该字段的值是此次 List 操作得到的资源的版本号。我们在 watch 请求中可以带上该版本号作为参数，API Server 会 watch 将该版本之后的资源变化并通知客户端。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>&#34;kind&#34;</span>: <span style=color:#f1fa8c>&#34;PodList&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>&#34;apiVersion&#34;</span>: <span style=color:#f1fa8c>&#34;v1&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>&#34;metadata&#34;</span>: {
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>&#34;resourceVersion&#34;</span>: <span style=color:#f1fa8c>&#34;770715&#34;</span> <span style=color:#6272a4>//资源版本号
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>  },
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>&#34;items&#34;</span>: [
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>&#34;metadata&#34;</span>: {
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>&#34;name&#34;</span>: <span style=color:#f1fa8c>&#34;foo&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>&#34;namespace&#34;</span>: <span style=color:#f1fa8c>&#34;default&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>&#34;uid&#34;</span>: <span style=color:#f1fa8c>&#34;d6adfe72-4e90-4b6e-bf14-b6192acb5d07&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>&#34;resourceVersion&#34;</span>: <span style=color:#f1fa8c>&#34;762448&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>&#34;creationTimestamp&#34;</span>: <span style=color:#f1fa8c>&#34;2023-03-10T16:16:02Z&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>&#34;annotations&#34;</span>: {…},
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>&#34;managedFields&#34;</span>: […]
</span></span><span style=display:flex><span>      },
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>&#34;spec&#34;</span>: {…},
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>&#34;status&#34;</span>: {…}
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>	{
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>&#34;metadata&#34;</span>: {
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>&#34;name&#34;</span>: <span style=color:#f1fa8c>&#34;bar&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>&#34;namespace&#34;</span>: <span style=color:#f1fa8c>&#34;default&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>&#34;uid&#34;</span>: <span style=color:#f1fa8c>&#34;bac55478-ad8d-49a6-bab2-23bfdc788736&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>&#34;resourceVersion&#34;</span>: <span style=color:#f1fa8c>&#34;762904&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>&#34;creationTimestamp&#34;</span>: <span style=color:#f1fa8c>&#34;2023-03-10T16:19:17Z&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>&#34;annotations&#34;</span>: {…},
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>&#34;managedFields&#34;</span>: […]
</span></span><span style=display:flex><span>      },
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>&#34;spec&#34;</span>: {…},
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>&#34;status&#34;</span>: {…}
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  ]
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>在请求中加上 watch 参数，并带上前面 List 返回的版本号，以 watch pod 资源的变化。</p><pre tabindex=0><code>curl http://localhost:8080/api/v1/namespaces/default/pods?watch=true&amp;resourceVersion=770715
</code></pre><p>在另一个终端中创建一个名为 test 的 pod，然后将其删除，可以看到下面的输出：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{<span style=color:#ff79c6>&#34;type&#34;</span>:<span style=color:#f1fa8c>&#34;ADDED&#34;</span>,<span style=color:#ff79c6>&#34;object&#34;</span>:{<span style=color:#ff79c6>&#34;kind&#34;</span>:<span style=color:#f1fa8c>&#34;Pod&#34;</span>,<span style=color:#ff79c6>&#34;apiVersion&#34;</span>:<span style=color:#f1fa8c>&#34;v1&#34;</span>,<span style=color:#ff79c6>&#34;metadata&#34;</span>:{<span style=color:#ff79c6>&#34;name&#34;</span>:<span style=color:#f1fa8c>&#34;network-tool1&#34;</span>,<span style=color:#ff79c6>&#34;namespace&#34;</span>:<span style=color:#f1fa8c>&#34;default&#34;</span>,<span style=color:#ff79c6>&#34;uid&#34;</span>:<span style=color:#f1fa8c>&#34;c7173455-4a47-4d7f-818d-6634df001f15&#34;</span>,<span style=color:#ff79c6>&#34;resourceVersion&#34;</span>:<span style=color:#f1fa8c>&#34;744176&#34;</span>,<span style=color:#ff79c6>&#34;creationTimestamp&#34;</span>:<span style=color:#f1fa8c>&#34;2023-03-09T06:59:09Z&#34;</span>,<span style=color:#ff79c6>&#34;annotations&#34;</span>:{<span style=color:#ff79c6>&#34;kubectl.kubernetes.io/last-applied-configuration&#34;</span>:<span style=color:#f1fa8c>&#34;{\&#34;apiVersion\&#34;:\&#34;v1\&#34;,\&#34;kind\&#34;:\&#34;Pod\&#34;,\&#34;metadata\&#34;:{\&#34;annotations\&#34;:{\&#34;sidecar.istio.io/inject\&#34;:\&#34;false\&#34;},\&#34;name\&#34;:\&#34;network-tool1\&#34;,\&#34;namespace\&#34;:\&#34;default\&#34;},\&#34;spec\&#34;:{\&#34;containers\&#34;:[{\&#34;image\&#34;:\&#34;zhaohuabing/network-tool\&#34;,\&#34;name\&#34;:\&#34;network-tool1\&#34;,\&#34;securityContext\&#34;:{\&#34;capabilities\&#34;:{\&#34;add\&#34;:[\&#34;NET_ADMIN\&#34;]}}}]}}\n&#34;</span>,<span style=color:#ff79c6>&#34;sidecar.istio.io/inject&#34;</span>:<span style=color:#f1fa8c>&#34;false&#34;</span>},<span style=color:#ff79c6>&#34;managedFields&#34;</span>:[{<span style=color:#ff79c6>&#34;manager&#34;</span>:<span style=color:#f1fa8c>&#34;kubectl-client-side-apply&#34;</span>,<span style=color:#ff79c6>&#34;operation&#34;</span>:<span style=color:#f1fa8c>&#34;Update&#34;</span>,<span style=color:#ff79c6>&#34;apiVersion&#34;</span>:<span style=color:#f1fa8c>&#34;v1&#34;</span>,<span style=color:#ff79c6>&#34;time&#34;</span>:<span style=color:#f1fa8c>&#34;2023-03-09T06:59:09Z&#34;</span>,<span style=color:#ff79c6>&#34;fieldsType&#34;</span>:<span style=color:#f1fa8c>&#34;FieldsV1&#34;</span>,<span style=color:#ff79c6>&#34;fieldsV1&#34;</span>:{<span style=color:#ff79c6>&#34;f:metadata&#34;</span>:{<span style=color:#ff79c6>&#34;f:annotations&#34;</span>:{<span style=color:#ff79c6>&#34;.&#34;</span>:{},<span style=color:#ff79c6>&#34;f:kubectl.kubernetes.io/last-applied-configuration&#34;</span>:{},<span style=color:#ff79c6>&#34;f:sidecar.istio.io/inject&#34;</span>:{}}},<span style=color:#ff79c6>&#34;f:spec&#34;</span>:{<span style=color:#ff79c6>&#34;f:containers&#34;</span>:{<span style=color:#ff79c6>&#34;k:{\&#34;name\&#34;:\&#34;network-tool1\&#34;}&#34;</span>:{<span style=color:#ff79c6>&#34;.&#34;</span>:{},<span style=color:#ff79c6>&#34;f:image&#34;</span>:{},<span style=color:#ff79c6>&#34;f:imagePullPolicy&#34;</span>:{},<span style=color:#ff79c6>&#34;f:name&#34;</span>:{},<span style=color:#ff79c6>&#34;f:resources&#34;</span>:{},<span style=color:#ff79c6>&#34;f:securityContext&#34;</span>:{<span style=color:#ff79c6>&#34;.&#34;</span>:{},<span style=color:#ff79c6>&#34;f:capabilities&#34;</span>:{<span style=color:#ff79c6>&#34;.&#34;</span>:{},<span style=color:#ff79c6>&#34;f:add&#34;</span>:{}}},<span style=color:#ff79c6>&#34;f:terminationMessagePath&#34;</span>:{},<span style=color:#ff79c6>&#34;f:terminationMessagePolicy&#34;</span>:{}}},<span style=color:#ff79c6>&#34;f:dnsPolicy&#34;</span>:{},<span style=color:#ff79c6>&#34;f:enableServiceLinks&#34;</span>:{},<span style=color:#ff79c6>&#34;f:restartPolicy&#34;</span>:{},<span style=color:#ff79c6>&#34;f:schedulerName&#34;</span>:{},<span style=color:#ff79c6>&#34;f:securityContext&#34;</span>:{},<span style=color:#ff79c6>&#34;f:terminationGracePeriodSeconds&#34;</span>:{}}}},{<span style=color:#ff79c6>&#34;manager&#34;</span>:<span style=color:#f1fa8c>&#34;kubelet&#34;</span>,<span style=color:#ff79c6>&#34;operation&#34;</span>:<span style=color:#f1fa8c>&#34;Update&#34;</span>,<span style=color:#ff79c6>&#34;apiVersion&#34;</span>:<span style=color:#f1fa8c>&#34;v1&#34;</span>,<span style=color:#ff79c6>&#34;time&#34;</span>:<span style=color:#f1fa8c>&#34;2023-03-10T13:36:54Z&#34;</span>,<span style=color:#ff79c6>&#34;fieldsType&#34;</span>:<span style=color:#f1fa8c>&#34;FieldsV1&#34;</span>,<span style=color:#ff79c6>&#34;fieldsV1&#34;</span>:{<span style=color:#ff79c6>&#34;f:status&#34;</span>:{<span style=color:#ff79c6>&#34;f:conditions&#34;</span>:{<span style=color:#ff79c6>&#34;k:{\&#34;type\&#34;:\&#34;ContainersReady\&#34;}&#34;</span>:{<span style=color:#ff79c6>&#34;.&#34;</span>:{},<span style=color:#ff79c6>&#34;f:lastProbeTime&#34;</span>:{},<span style=color:#ff79c6>&#34;f:lastTransitionTime&#34;</span>:{},<span style=color:#ff79c6>&#34;f:status&#34;</span>:{},<span style=color:#ff79c6>&#34;f:type&#34;</span>:{}},<span style=color:#ff79c6>&#34;k:{\&#34;type\&#34;:\&#34;Initialized\&#34;}&#34;</span>:{<span style=color:#ff79c6>&#34;.&#34;</span>:{},<span style=color:#ff79c6>&#34;f:lastProbeTime&#34;</span>:{},<span style=color:#ff79c6>&#34;f:lastTransitionTime&#34;</span>:{},<span style=color:#ff79c6>&#34;f:status&#34;</span>:{},<span style=color:#ff79c6>&#34;f:type&#34;</span>:{}},<span style=color:#ff79c6>&#34;k:{\&#34;type\&#34;:\&#34;Ready\&#34;}&#34;</span>:{<span style=color:#ff79c6>&#34;.&#34;</span>:{},<span style=color:#ff79c6>&#34;f:lastProbeTime&#34;</span>:{},<span style=color:#ff79c6>&#34;f:lastTransitionTime&#34;</span>:{},<span style=color:#ff79c6>&#34;f:status&#34;</span>:{},<span style=color:#ff79c6>&#34;f:type&#34;</span>:{}}},<span style=color:#ff79c6>&#34;f:containerStatuses&#34;</span>:{},<span style=color:#ff79c6>&#34;f:hostIP&#34;</span>:{},<span style=color:#ff79c6>&#34;f:phase&#34;</span>:{},<span style=color:#ff79c6>&#34;f:podIP&#34;</span>:{},<span style=color:#ff79c6>&#34;f:podIPs&#34;</span>:{<span style=color:#ff79c6>&#34;.&#34;</span>:{},<span style=color:#ff79c6>&#34;k:{\&#34;ip\&#34;:\&#34;10.244.0.6\&#34;}&#34;</span>:{<span style=color:#ff79c6>&#34;.&#34;</span>:{},<span style=color:#ff79c6>&#34;f:ip&#34;</span>:{}}},<span style=color:#ff79c6>&#34;f:startTime&#34;</span>:{}}}}]},<span style=color:#ff79c6>&#34;spec&#34;</span>:{<span style=color:#ff79c6>&#34;volumes&#34;</span>:[{<span style=color:#ff79c6>&#34;name&#34;</span>:<span style=color:#f1fa8c>&#34;kube-api-access-rdz4f&#34;</span>,<span style=color:#ff79c6>&#34;projected&#34;</span>:{<span style=color:#ff79c6>&#34;sources&#34;</span>:[{<span style=color:#ff79c6>&#34;serviceAccountToken&#34;</span>:{<span style=color:#ff79c6>&#34;expirationSeconds&#34;</span>:<span style=color:#bd93f9>3607</span>,<span style=color:#ff79c6>&#34;path&#34;</span>:<span style=color:#f1fa8c>&#34;token&#34;</span>}},{<span style=color:#ff79c6>&#34;configMap&#34;</span>:{<span style=color:#ff79c6>&#34;name&#34;</span>:<span style=color:#f1fa8c>&#34;kube-root-ca.crt&#34;</span>,<span style=color:#ff79c6>&#34;items&#34;</span>:[{<span style=color:#ff79c6>&#34;key&#34;</span>:<span style=color:#f1fa8c>&#34;ca.crt&#34;</span>,<span style=color:#ff79c6>&#34;path&#34;</span>:<span style=color:#f1fa8c>&#34;ca.crt&#34;</span>}]}},{<span style=color:#ff79c6>&#34;downwardAPI&#34;</span>:{<span style=color:#ff79c6>&#34;items&#34;</span>:[{<span style=color:#ff79c6>&#34;path&#34;</span>:<span style=color:#f1fa8c>&#34;namespace&#34;</span>,<span style=color:#ff79c6>&#34;fieldRef&#34;</span>:{<span style=color:#ff79c6>&#34;apiVersion&#34;</span>:<span style=color:#f1fa8c>&#34;v1&#34;</span>,<span style=color:#ff79c6>&#34;fieldPath&#34;</span>:<span style=color:#f1fa8c>&#34;metadata.namespace&#34;</span>}}]}}],<span style=color:#ff79c6>&#34;defaultMode&#34;</span>:<span style=color:#bd93f9>420</span>}}],<span style=color:#ff79c6>&#34;containers&#34;</span>:[{<span style=color:#ff79c6>&#34;name&#34;</span>:<span style=color:#f1fa8c>&#34;network-tool1&#34;</span>,<span style=color:#ff79c6>&#34;image&#34;</span>:<span style=color:#f1fa8c>&#34;zhaohuabing/network-tool&#34;</span>,<span style=color:#ff79c6>&#34;resources&#34;</span>:{},<span style=color:#ff79c6>&#34;volumeMounts&#34;</span>:[{<span style=color:#ff79c6>&#34;name&#34;</span>:<span style=color:#f1fa8c>&#34;kube-api-access-rdz4f&#34;</span>,<span style=color:#ff79c6>&#34;readOnly&#34;</span>:<span style=color:#ff79c6>true</span>,<span style=color:#ff79c6>&#34;mountPath&#34;</span>:<span style=color:#f1fa8c>&#34;/var/run/secrets/kubernetes.io/serviceaccount&#34;</span>}],<span style=color:#ff79c6>&#34;terminationMessagePath&#34;</span>:<span style=color:#f1fa8c>&#34;/dev/termination-log&#34;</span>,<span style=color:#ff79c6>&#34;terminationMessagePolicy&#34;</span>:<span style=color:#f1fa8c>&#34;File&#34;</span>,<span style=color:#ff79c6>&#34;imagePullPolicy&#34;</span>:<span style=color:#f1fa8c>&#34;Always&#34;</span>,<span style=color:#ff79c6>&#34;securityContext&#34;</span>:{<span style=color:#ff79c6>&#34;capabilities&#34;</span>:{<span style=color:#ff79c6>&#34;add&#34;</span>:[<span style=color:#f1fa8c>&#34;NET_ADMIN&#34;</span>]}}}],<span style=color:#ff79c6>&#34;restartPolicy&#34;</span>:<span style=color:#f1fa8c>&#34;Always&#34;</span>,<span style=color:#ff79c6>&#34;terminationGracePeriodSeconds&#34;</span>:<span style=color:#bd93f9>30</span>,<span style=color:#ff79c6>&#34;dnsPolicy&#34;</span>:<span style=color:#f1fa8c>&#34;ClusterFirst&#34;</span>,<span style=color:#ff79c6>&#34;serviceAccountName&#34;</span>:<span style=color:#f1fa8c>&#34;default&#34;</span>,<span style=color:#ff79c6>&#34;serviceAccount&#34;</span>:<span style=color:#f1fa8c>&#34;default&#34;</span>,<span style=color:#ff79c6>&#34;nodeName&#34;</span>:<span style=color:#f1fa8c>&#34;aeraki-control-plane&#34;</span>,<span style=color:#ff79c6>&#34;securityContext&#34;</span>:{},<span style=color:#ff79c6>&#34;schedulerName&#34;</span>:<span style=color:#f1fa8c>&#34;default-scheduler&#34;</span>,<span style=color:#ff79c6>&#34;tolerations&#34;</span>:[{<span style=color:#ff79c6>&#34;key&#34;</span>:<span style=color:#f1fa8c>&#34;node.kubernetes.io/not-ready&#34;</span>,<span style=color:#ff79c6>&#34;operator&#34;</span>:<span style=color:#f1fa8c>&#34;Exists&#34;</span>,<span style=color:#ff79c6>&#34;effect&#34;</span>:<span style=color:#f1fa8c>&#34;NoExecute&#34;</span>,<span style=color:#ff79c6>&#34;tolerationSeconds&#34;</span>:<span style=color:#bd93f9>300</span>},{<span style=color:#ff79c6>&#34;key&#34;</span>:<span style=color:#f1fa8c>&#34;node.kubernetes.io/unreachable&#34;</span>,<span style=color:#ff79c6>&#34;operator&#34;</span>:<span style=color:#f1fa8c>&#34;Exists&#34;</span>,<span style=color:#ff79c6>&#34;effect&#34;</span>:<span style=color:#f1fa8c>&#34;NoExecute&#34;</span>,<span style=color:#ff79c6>&#34;tolerationSeconds&#34;</span>:<span style=color:#bd93f9>300</span>}],<span style=color:#ff79c6>&#34;priority&#34;</span>:<span style=color:#bd93f9>0</span>,<span style=color:#ff79c6>&#34;enableServiceLinks&#34;</span>:<span style=color:#ff79c6>true</span>,<span style=color:#ff79c6>&#34;preemptionPolicy&#34;</span>:<span style=color:#f1fa8c>&#34;PreemptLowerPriority&#34;</span>},<span style=color:#ff79c6>&#34;status&#34;</span>:{<span style=color:#ff79c6>&#34;phase&#34;</span>:<span style=color:#f1fa8c>&#34;Running&#34;</span>,<span style=color:#ff79c6>&#34;conditions&#34;</span>:[{<span style=color:#ff79c6>&#34;type&#34;</span>:<span style=color:#f1fa8c>&#34;Initialized&#34;</span>,<span style=color:#ff79c6>&#34;status&#34;</span>:<span style=color:#f1fa8c>&#34;True&#34;</span>,<span style=color:#ff79c6>&#34;lastProbeTime&#34;</span>:<span style=color:#ff79c6>null</span>,<span style=color:#ff79c6>&#34;lastTransitionTime&#34;</span>:<span style=color:#f1fa8c>&#34;2023-03-09T06:59:09Z&#34;</span>},{<span style=color:#ff79c6>&#34;type&#34;</span>:<span style=color:#f1fa8c>&#34;Ready&#34;</span>,<span style=color:#ff79c6>&#34;status&#34;</span>:<span style=color:#f1fa8c>&#34;True&#34;</span>,<span style=color:#ff79c6>&#34;lastProbeTime&#34;</span>:<span style=color:#ff79c6>null</span>,<span style=color:#ff79c6>&#34;lastTransitionTime&#34;</span>:<span style=color:#f1fa8c>&#34;2023-03-10T13:36:54Z&#34;</span>},{<span style=color:#ff79c6>&#34;type&#34;</span>:<span style=color:#f1fa8c>&#34;ContainersReady&#34;</span>,<span style=color:#ff79c6>&#34;status&#34;</span>:<span style=color:#f1fa8c>&#34;True&#34;</span>,<span style=color:#ff79c6>&#34;lastProbeTime&#34;</span>:<span style=color:#ff79c6>null</span>,<span style=color:#ff79c6>&#34;lastTransitionTime&#34;</span>:<span style=color:#f1fa8c>&#34;2023-03-10T13:36:54Z&#34;</span>},{<span style=color:#ff79c6>&#34;type&#34;</span>:<span style=color:#f1fa8c>&#34;PodScheduled&#34;</span>,<span style=color:#ff79c6>&#34;status&#34;</span>:<span style=color:#f1fa8c>&#34;True&#34;</span>,<span style=color:#ff79c6>&#34;lastProbeTime&#34;</span>:<span style=color:#ff79c6>null</span>,<span style=color:#ff79c6>&#34;lastTransitionTime&#34;</span>:<span style=color:#f1fa8c>&#34;2023-03-09T06:59:09Z&#34;</span>}],<span style=color:#ff79c6>&#34;hostIP&#34;</span>:<span style=color:#f1fa8c>&#34;172.20.0.2&#34;</span>,<span style=color:#ff79c6>&#34;podIP&#34;</span>:<span style=color:#f1fa8c>&#34;10.244.0.6&#34;</span>,<span style=color:#ff79c6>&#34;podIPs&#34;</span>:[{<span style=color:#ff79c6>&#34;ip&#34;</span>:<span style=color:#f1fa8c>&#34;10.244.0.6&#34;</span>}],<span style=color:#ff79c6>&#34;startTime&#34;</span>:<span style=color:#f1fa8c>&#34;2023-03-09T06:59:09Z&#34;</span>,<span style=color:#ff79c6>&#34;containerStatuses&#34;</span>:[{<span style=color:#ff79c6>&#34;name&#34;</span>:<span style=color:#f1fa8c>&#34;network-tool1&#34;</span>,<span style=color:#ff79c6>&#34;state&#34;</span>:{<span style=color:#ff79c6>&#34;running&#34;</span>:{<span style=color:#ff79c6>&#34;startedAt&#34;</span>:<span style=color:#f1fa8c>&#34;2023-03-10T13:36:53Z&#34;</span>}},<span style=color:#ff79c6>&#34;lastState&#34;</span>:{<span style=color:#ff79c6>&#34;terminated&#34;</span>:{<span style=color:#ff79c6>&#34;exitCode&#34;</span>:<span style=color:#bd93f9>255</span>,<span style=color:#ff79c6>&#34;reason&#34;</span>:<span style=color:#f1fa8c>&#34;Unknown&#34;</span>,<span style=color:#ff79c6>&#34;startedAt&#34;</span>:<span style=color:#f1fa8c>&#34;2023-03-09T06:59:18Z&#34;</span>,<span style=color:#ff79c6>&#34;finishedAt&#34;</span>:<span style=color:#f1fa8c>&#34;2023-03-10T13:31:39Z&#34;</span>,<span style=color:#ff79c6>&#34;containerID&#34;</span>:<span style=color:#f1fa8c>&#34;containerd://63447ff37e212b476f96fd7529d734a7ae965c38d596d585bbe6a14b7b38f0ec&#34;</span>}},<span style=color:#ff79c6>&#34;ready&#34;</span>:<span style=color:#ff79c6>true</span>,<span style=color:#ff79c6>&#34;restartCount&#34;</span>:<span style=color:#bd93f9>1</span>,<span style=color:#ff79c6>&#34;image&#34;</span>:<span style=color:#f1fa8c>&#34;docker.io/zhaohuabing/network-tool:latest&#34;</span>,<span style=color:#ff79c6>&#34;imageID&#34;</span>:<span style=color:#f1fa8c>&#34;docker.io/zhaohuabing/network-tool@sha256:5843e4f12742f0e34932ba42205f177a62d930eadb419d99fa4881483ea46629&#34;</span>,<span style=color:#ff79c6>&#34;containerID&#34;</span>:<span style=color:#f1fa8c>&#34;containerd://a8c787bc61c1f09d901ac91065b1462533ea32293c43afe3021efd8c92366375&#34;</span>,<span style=color:#ff79c6>&#34;started&#34;</span>:<span style=color:#ff79c6>true</span>}],<span style=color:#ff79c6>&#34;qosClass&#34;</span>:<span style=color:#f1fa8c>&#34;BestEffort&#34;</span>}}}
</span></span><span style=display:flex><span>{<span style=color:#ff79c6>&#34;type&#34;</span>:<span style=color:#f1fa8c>&#34;ADDED&#34;</span>,<span style=color:#ff79c6>&#34;object&#34;</span>:{<span style=color:#ff79c6>&#34;kind&#34;</span>:<span style=color:#f1fa8c>&#34;Pod&#34;</span>,<span style=color:#ff79c6>&#34;apiVersion&#34;</span>:<span style=color:#f1fa8c>&#34;v1&#34;</span>,<span style=color:#ff79c6>&#34;metadata&#34;</span>:{<span style=color:#ff79c6>&#34;name&#34;</span>:<span style=color:#f1fa8c>&#34;network-tool&#34;</span>,<span style=color:#ff79c6>&#34;namespace&#34;</span>:<span style=color:#f1fa8c>&#34;default&#34;</span>,<span style=color:#ff79c6>&#34;uid&#34;</span>:<span style=color:#f1fa8c>&#34;548a29a9-9359-4858-8a18-48633d29d394&#34;</span>,<span style=color:#ff79c6>&#34;resourceVersion&#34;</span>:<span style=color:#f1fa8c>&#34;744186&#34;</span>,<span style=color:#ff79c6>&#34;creationTimestamp&#34;</span>:<span style=color:#f1fa8c>&#34;2023-03-09T09:30:14Z&#34;</span>,<span style=color:#ff79c6>&#34;annotations&#34;</span>:{<span style=color:#ff79c6>&#34;kubectl.kubernetes.io/last-applied-configuration&#34;</span>:<span style=color:#f1fa8c>&#34;{\&#34;apiVersion\&#34;:\&#34;v1\&#34;,\&#34;kind\&#34;:\&#34;Pod\&#34;,\&#34;metadata\&#34;:{\&#34;annotations\&#34;:{\&#34;sidecar.istio.io/inject\&#34;:\&#34;false\&#34;},\&#34;name\&#34;:\&#34;network-tool\&#34;,\&#34;namespace\&#34;:\&#34;default\&#34;},\&#34;spec\&#34;:{\&#34;containers\&#34;:[{\&#34;image\&#34;:\&#34;zhaohuabing/network-tool\&#34;,\&#34;name\&#34;:\&#34;network-tool\&#34;,\&#34;securityContext\&#34;:{\&#34;capabilities\&#34;:{\&#34;add\&#34;:[\&#34;NET_ADMIN\&#34;]}}}]}}\n&#34;</span>,<span style=color:#ff79c6>&#34;sidecar.istio.io/inject&#34;</span>:<span style=color:#f1fa8c>&#34;false&#34;</span>},<span style=color:#ff79c6>&#34;managedFields&#34;</span>:[{<span style=color:#ff79c6>&#34;manager&#34;</span>:<span style=color:#f1fa8c>&#34;kubectl-client-side-apply&#34;</span>,<span style=color:#ff79c6>&#34;operation&#34;</span>:<span style=color:#f1fa8c>&#34;Update&#34;</span>,<span style=color:#ff79c6>&#34;apiVersion&#34;</span>:<span style=color:#f1fa8c>&#34;v1&#34;</span>,<span style=color:#ff79c6>&#34;time&#34;</span>:<span style=color:#f1fa8c>&#34;2023-03-09T09:30:14Z&#34;</span>,<span style=color:#ff79c6>&#34;fieldsType&#34;</span>:<span style=color:#f1fa8c>&#34;FieldsV1&#34;</span>,<span style=color:#ff79c6>&#34;fieldsV1&#34;</span>:{<span style=color:#ff79c6>&#34;f:metadata&#34;</span>:{<span style=color:#ff79c6>&#34;f:annotations&#34;</span>:{<span style=color:#ff79c6>&#34;.&#34;</span>:{},<span style=color:#ff79c6>&#34;f:kubectl.kubernetes.io/last-applied-configuration&#34;</span>:{},<span style=color:#ff79c6>&#34;f:sidecar.istio.io/inject&#34;</span>:{}}},<span style=color:#ff79c6>&#34;f:spec&#34;</span>:{<span style=color:#ff79c6>&#34;f:containers&#34;</span>:{<span style=color:#ff79c6>&#34;k:{\&#34;name\&#34;:\&#34;network-tool\&#34;}&#34;</span>:{<span style=color:#ff79c6>&#34;.&#34;</span>:{},<span style=color:#ff79c6>&#34;f:image&#34;</span>:{},<span style=color:#ff79c6>&#34;f:imagePullPolicy&#34;</span>:{},<span style=color:#ff79c6>&#34;f:name&#34;</span>:{},<span style=color:#ff79c6>&#34;f:resources&#34;</span>:{},<span style=color:#ff79c6>&#34;f:securityContext&#34;</span>:{<span style=color:#ff79c6>&#34;.&#34;</span>:{},<span style=color:#ff79c6>&#34;f:capabilities&#34;</span>:{<span style=color:#ff79c6>&#34;.&#34;</span>:{},<span style=color:#ff79c6>&#34;f:add&#34;</span>:{}}},<span style=color:#ff79c6>&#34;f:terminationMessagePath&#34;</span>:{},<span style=color:#ff79c6>&#34;f:terminationMessagePolicy&#34;</span>:{}}},<span style=color:#ff79c6>&#34;f:dnsPolicy&#34;</span>:{},<span style=color:#ff79c6>&#34;f:enableServiceLinks&#34;</span>:{},<span style=color:#ff79c6>&#34;f:restartPolicy&#34;</span>:{},<span style=color:#ff79c6>&#34;f:schedulerName&#34;</span>:{},<span style=color:#ff79c6>&#34;f:securityContext&#34;</span>:{},<span style=color:#ff79c6>&#34;f:terminationGracePeriodSeconds&#34;</span>:{}}}},{<span style=color:#ff79c6>&#34;manager&#34;</span>:<span style=color:#f1fa8c>&#34;kubelet&#34;</span>,<span style=color:#ff79c6>&#34;operation&#34;</span>:<span style=color:#f1fa8c>&#34;Update&#34;</span>,<span style=color:#ff79c6>&#34;apiVersion&#34;</span>:<span style=color:#f1fa8c>&#34;v1&#34;</span>,<span style=color:#ff79c6>&#34;time&#34;</span>:<span style=color:#f1fa8c>&#34;2023-03-10T13:36:56Z&#34;</span>,<span style=color:#ff79c6>&#34;fieldsType&#34;</span>:<span style=color:#f1fa8c>&#34;FieldsV1&#34;</span>,<span style=color:#ff79c6>&#34;fieldsV1&#34;</span>:{<span style=color:#ff79c6>&#34;f:status&#34;</span>:{<span style=color:#ff79c6>&#34;f:conditions&#34;</span>:{<span style=color:#ff79c6>&#34;k:{\&#34;type\&#34;:\&#34;ContainersReady\&#34;}&#34;</span>:{<span style=color:#ff79c6>&#34;.&#34;</span>:{},<span style=color:#ff79c6>&#34;f:lastProbeTime&#34;</span>:{},<span style=color:#ff79c6>&#34;f:lastTransitionTime&#34;</span>:{},<span style=color:#ff79c6>&#34;f:status&#34;</span>:{},<span style=color:#ff79c6>&#34;f:type&#34;</span>:{}},<span style=color:#ff79c6>&#34;k:{\&#34;type\&#34;:\&#34;Initialized\&#34;}&#34;</span>:{<span style=color:#ff79c6>&#34;.&#34;</span>:{},<span style=color:#ff79c6>&#34;f:lastProbeTime&#34;</span>:{},<span style=color:#ff79c6>&#34;f:lastTransitionTime&#34;</span>:{},<span style=color:#ff79c6>&#34;f:status&#34;</span>:{},<span style=color:#ff79c6>&#34;f:type&#34;</span>:{}},<span style=color:#ff79c6>&#34;k:{\&#34;type\&#34;:\&#34;Ready\&#34;}&#34;</span>:{<span style=color:#ff79c6>&#34;.&#34;</span>:{},<span style=color:#ff79c6>&#34;f:lastProbeTime&#34;</span>:{},<span style=color:#ff79c6>&#34;f:lastTransitionTime&#34;</span>:{},<span style=color:#ff79c6>&#34;f:status&#34;</span>:{},<span style=color:#ff79c6>&#34;f:type&#34;</span>:{}}},<span style=color:#ff79c6>&#34;f:containerStatuses&#34;</span>:{},<span style=color:#ff79c6>&#34;f:hostIP&#34;</span>:{},<span style=color:#ff79c6>&#34;f:phase&#34;</span>:{},<span style=color:#ff79c6>&#34;f:podIP&#34;</span>:{},<span style=color:#ff79c6>&#34;f:podIPs&#34;</span>:{<span style=color:#ff79c6>&#34;.&#34;</span>:{},<span style=color:#ff79c6>&#34;k:{\&#34;ip\&#34;:\&#34;10.244.0.8\&#34;}&#34;</span>:{<span style=color:#ff79c6>&#34;.&#34;</span>:{},<span style=color:#ff79c6>&#34;f:ip&#34;</span>:{}}},<span style=color:#ff79c6>&#34;f:startTime&#34;</span>:{}}}}]},<span style=color:#ff79c6>&#34;spec&#34;</span>:{<span style=color:#ff79c6>&#34;volumes&#34;</span>:[{<span style=color:#ff79c6>&#34;name&#34;</span>:<span style=color:#f1fa8c>&#34;kube-api-access-cwjmv&#34;</span>,<span style=color:#ff79c6>&#34;projected&#34;</span>:{<span style=color:#ff79c6>&#34;sources&#34;</span>:[{<span style=color:#ff79c6>&#34;serviceAccountToken&#34;</span>:{<span style=color:#ff79c6>&#34;expirationSeconds&#34;</span>:<span style=color:#bd93f9>3607</span>,<span style=color:#ff79c6>&#34;path&#34;</span>:<span style=color:#f1fa8c>&#34;token&#34;</span>}},{<span style=color:#ff79c6>&#34;configMap&#34;</span>:{<span style=color:#ff79c6>&#34;name&#34;</span>:<span style=color:#f1fa8c>&#34;kube-root-ca.crt&#34;</span>,<span style=color:#ff79c6>&#34;items&#34;</span>:[{<span style=color:#ff79c6>&#34;key&#34;</span>:<span style=color:#f1fa8c>&#34;ca.crt&#34;</span>,<span style=color:#ff79c6>&#34;path&#34;</span>:<span style=color:#f1fa8c>&#34;ca.crt&#34;</span>}]}},{<span style=color:#ff79c6>&#34;downwardAPI&#34;</span>:{<span style=color:#ff79c6>&#34;items&#34;</span>:[{<span style=color:#ff79c6>&#34;path&#34;</span>:<span style=color:#f1fa8c>&#34;namespace&#34;</span>,<span style=color:#ff79c6>&#34;fieldRef&#34;</span>:{<span style=color:#ff79c6>&#34;apiVersion&#34;</span>:<span style=color:#f1fa8c>&#34;v1&#34;</span>,<span style=color:#ff79c6>&#34;fieldPath&#34;</span>:<span style=color:#f1fa8c>&#34;metadata.namespace&#34;</span>}}]}}],<span style=color:#ff79c6>&#34;defaultMode&#34;</span>:<span style=color:#bd93f9>420</span>}}],<span style=color:#ff79c6>&#34;containers&#34;</span>:[{<span style=color:#ff79c6>&#34;name&#34;</span>:<span style=color:#f1fa8c>&#34;network-tool&#34;</span>,<span style=color:#ff79c6>&#34;image&#34;</span>:<span style=color:#f1fa8c>&#34;zhaohuabing/network-tool&#34;</span>,<span style=color:#ff79c6>&#34;resources&#34;</span>:{},<span style=color:#ff79c6>&#34;volumeMounts&#34;</span>:[{<span style=color:#ff79c6>&#34;name&#34;</span>:<span style=color:#f1fa8c>&#34;kube-api-access-cwjmv&#34;</span>,<span style=color:#ff79c6>&#34;readOnly&#34;</span>:<span style=color:#ff79c6>true</span>,<span style=color:#ff79c6>&#34;mountPath&#34;</span>:<span style=color:#f1fa8c>&#34;/var/run/secrets/kubernetes.io/serviceaccount&#34;</span>}],<span style=color:#ff79c6>&#34;terminationMessagePath&#34;</span>:<span style=color:#f1fa8c>&#34;/dev/termination-log&#34;</span>,<span style=color:#ff79c6>&#34;terminationMessagePolicy&#34;</span>:<span style=color:#f1fa8c>&#34;File&#34;</span>,<span style=color:#ff79c6>&#34;imagePullPolicy&#34;</span>:<span style=color:#f1fa8c>&#34;Always&#34;</span>,<span style=color:#ff79c6>&#34;securityContext&#34;</span>:{<span style=color:#ff79c6>&#34;capabilities&#34;</span>:{<span style=color:#ff79c6>&#34;add&#34;</span>:[<span style=color:#f1fa8c>&#34;NET_ADMIN&#34;</span>]}}}],<span style=color:#ff79c6>&#34;restartPolicy&#34;</span>:<span style=color:#f1fa8c>&#34;Always&#34;</span>,<span style=color:#ff79c6>&#34;terminationGracePeriodSeconds&#34;</span>:<span style=color:#bd93f9>30</span>,<span style=color:#ff79c6>&#34;dnsPolicy&#34;</span>:<span style=color:#f1fa8c>&#34;ClusterFirst&#34;</span>,<span style=color:#ff79c6>&#34;serviceAccountName&#34;</span>:<span style=color:#f1fa8c>&#34;default&#34;</span>,<span style=color:#ff79c6>&#34;serviceAccount&#34;</span>:<span style=color:#f1fa8c>&#34;default&#34;</span>,<span style=color:#ff79c6>&#34;nodeName&#34;</span>:<span style=color:#f1fa8c>&#34;aeraki-control-plane&#34;</span>,<span style=color:#ff79c6>&#34;securityContext&#34;</span>:{},<span style=color:#ff79c6>&#34;schedulerName&#34;</span>:<span style=color:#f1fa8c>&#34;default-scheduler&#34;</span>,<span style=color:#ff79c6>&#34;tolerations&#34;</span>:[{<span style=color:#ff79c6>&#34;key&#34;</span>:<span style=color:#f1fa8c>&#34;node.kubernetes.io/not-ready&#34;</span>,<span style=color:#ff79c6>&#34;operator&#34;</span>:<span style=color:#f1fa8c>&#34;Exists&#34;</span>,<span style=color:#ff79c6>&#34;effect&#34;</span>:<span style=color:#f1fa8c>&#34;NoExecute&#34;</span>,<span style=color:#ff79c6>&#34;tolerationSeconds&#34;</span>:<span style=color:#bd93f9>300</span>},{<span style=color:#ff79c6>&#34;key&#34;</span>:<span style=color:#f1fa8c>&#34;node.kubernetes.io/unreachable&#34;</span>,<span style=color:#ff79c6>&#34;operator&#34;</span>:<span style=color:#f1fa8c>&#34;Exists&#34;</span>,<span style=color:#ff79c6>&#34;effect&#34;</span>:<span style=color:#f1fa8c>&#34;NoExecute&#34;</span>,<span style=color:#ff79c6>&#34;tolerationSeconds&#34;</span>:<span style=color:#bd93f9>300</span>}],<span style=color:#ff79c6>&#34;priority&#34;</span>:<span style=color:#bd93f9>0</span>,<span style=color:#ff79c6>&#34;enableServiceLinks&#34;</span>:<span style=color:#ff79c6>true</span>,<span style=color:#ff79c6>&#34;preemptionPolicy&#34;</span>:<span style=color:#f1fa8c>&#34;PreemptLowerPriority&#34;</span>},<span style=color:#ff79c6>&#34;status&#34;</span>:{<span style=color:#ff79c6>&#34;phase&#34;</span>:<span style=color:#f1fa8c>&#34;Running&#34;</span>,<span style=color:#ff79c6>&#34;conditions&#34;</span>:[{<span style=color:#ff79c6>&#34;type&#34;</span>:<span style=color:#f1fa8c>&#34;Initialized&#34;</span>,<span style=color:#ff79c6>&#34;status&#34;</span>:<span style=color:#f1fa8c>&#34;True&#34;</span>,<span style=color:#ff79c6>&#34;lastProbeTime&#34;</span>:<span style=color:#ff79c6>null</span>,<span style=color:#ff79c6>&#34;lastTransitionTime&#34;</span>:<span style=color:#f1fa8c>&#34;2023-03-09T09:30:14Z&#34;</span>},{<span style=color:#ff79c6>&#34;type&#34;</span>:<span style=color:#f1fa8c>&#34;Ready&#34;</span>,<span style=color:#ff79c6>&#34;status&#34;</span>:<span style=color:#f1fa8c>&#34;True&#34;</span>,<span style=color:#ff79c6>&#34;lastProbeTime&#34;</span>:<span style=color:#ff79c6>null</span>,<span style=color:#ff79c6>&#34;lastTransitionTime&#34;</span>:<span style=color:#f1fa8c>&#34;2023-03-10T13:36:56Z&#34;</span>},{<span style=color:#ff79c6>&#34;type&#34;</span>:<span style=color:#f1fa8c>&#34;ContainersReady&#34;</span>,<span style=color:#ff79c6>&#34;status&#34;</span>:<span style=color:#f1fa8c>&#34;True&#34;</span>,<span style=color:#ff79c6>&#34;lastProbeTime&#34;</span>:<span style=color:#ff79c6>null</span>,<span style=color:#ff79c6>&#34;lastTransitionTime&#34;</span>:<span style=color:#f1fa8c>&#34;2023-03-10T13:36:56Z&#34;</span>},{<span style=color:#ff79c6>&#34;type&#34;</span>:<span style=color:#f1fa8c>&#34;PodScheduled&#34;</span>,<span style=color:#ff79c6>&#34;status&#34;</span>:<span style=color:#f1fa8c>&#34;True&#34;</span>,<span style=color:#ff79c6>&#34;lastProbeTime&#34;</span>:<span style=color:#ff79c6>null</span>,<span style=color:#ff79c6>&#34;lastTransitionTime&#34;</span>:<span style=color:#f1fa8c>&#34;2023-03-09T09:30:14Z&#34;</span>}],<span style=color:#ff79c6>&#34;hostIP&#34;</span>:<span style=color:#f1fa8c>&#34;172.20.0.2&#34;</span>,<span style=color:#ff79c6>&#34;podIP&#34;</span>:<span style=color:#f1fa8c>&#34;10.244.0.8&#34;</span>,<span style=color:#ff79c6>&#34;podIPs&#34;</span>:[{<span style=color:#ff79c6>&#34;ip&#34;</span>:<span style=color:#f1fa8c>&#34;10.244.0.8&#34;</span>}],<span style=color:#ff79c6>&#34;startTime&#34;</span>:<span style=color:#f1fa8c>&#34;2023-03-09T09:30:14Z&#34;</span>,<span style=color:#ff79c6>&#34;containerStatuses&#34;</span>:[{<span style=color:#ff79c6>&#34;name&#34;</span>:<span style=color:#f1fa8c>&#34;network-tool&#34;</span>,<span style=color:#ff79c6>&#34;state&#34;</span>:{<span style=color:#ff79c6>&#34;running&#34;</span>:{<span style=color:#ff79c6>&#34;startedAt&#34;</span>:<span style=color:#f1fa8c>&#34;2023-03-10T13:36:56Z&#34;</span>}},<span style=color:#ff79c6>&#34;lastState&#34;</span>:{<span style=color:#ff79c6>&#34;terminated&#34;</span>:{<span style=color:#ff79c6>&#34;exitCode&#34;</span>:<span style=color:#bd93f9>255</span>,<span style=color:#ff79c6>&#34;reason&#34;</span>:<span style=color:#f1fa8c>&#34;Unknown&#34;</span>,<span style=color:#ff79c6>&#34;startedAt&#34;</span>:<span style=color:#f1fa8c>&#34;2023-03-09T09:30:18Z&#34;</span>,<span style=color:#ff79c6>&#34;finishedAt&#34;</span>:<span style=color:#f1fa8c>&#34;2023-03-10T13:31:39Z&#34;</span>,<span style=color:#ff79c6>&#34;containerID&#34;</span>:<span style=color:#f1fa8c>&#34;containerd://b52804466bbe6ad9d233b8c080b8d33289c247dbcf1be4d2bd9c609099041a96&#34;</span>}},<span style=color:#ff79c6>&#34;ready&#34;</span>:<span style=color:#ff79c6>true</span>,<span style=color:#ff79c6>&#34;restartCount&#34;</span>:<span style=color:#bd93f9>1</span>,<span style=color:#ff79c6>&#34;image&#34;</span>:<span style=color:#f1fa8c>&#34;docker.io/zhaohuabing/network-tool:latest&#34;</span>,<span style=color:#ff79c6>&#34;imageID&#34;</span>:<span style=color:#f1fa8c>&#34;docker.io/zhaohuabing/network-tool@sha256:5843e4f12742f0e34932ba42205f177a62d930eadb419d99fa4881483ea46629&#34;</span>,<span style=color:#ff79c6>&#34;containerID&#34;</span>:<span style=color:#f1fa8c>&#34;containerd://020d9b471682786883498e220bc48f932973f64fff6c5629559da3dca9d2358e&#34;</span>,<span style=color:#ff79c6>&#34;started&#34;</span>:<span style=color:#ff79c6>true</span>}],<span style=color:#ff79c6>&#34;qosClass&#34;</span>:<span style=color:#f1fa8c>&#34;BestEffort&#34;</span>}}}
</span></span><span style=display:flex><span>{<span style=color:#ff79c6>&#34;type&#34;</span>:<span style=color:#f1fa8c>&#34;MODIFIED&#34;</span>,<span style=color:#ff79c6>&#34;object&#34;</span>:{<span style=color:#ff79c6>&#34;kind&#34;</span>:<span style=color:#f1fa8c>&#34;Pod&#34;</span>,<span style=color:#ff79c6>&#34;apiVersion&#34;</span>:<span style=color:#f1fa8c>&#34;v1&#34;</span>,<span style=color:#ff79c6>&#34;metadata&#34;</span>:{<span style=color:#ff79c6>&#34;name&#34;</span>:<span style=color:#f1fa8c>&#34;network-tool&#34;</span>,<span style=color:#ff79c6>&#34;namespace&#34;</span>:<span style=color:#f1fa8c>&#34;default&#34;</span>,<span style=color:#ff79c6>&#34;uid&#34;</span>:<span style=color:#f1fa8c>&#34;548a29a9-9359-4858-8a18-48633d29d394&#34;</span>,<span style=color:#ff79c6>&#34;resourceVersion&#34;</span>:<span style=color:#f1fa8c>&#34;759935&#34;</span>,<span style=color:#ff79c6>&#34;creationTimestamp&#34;</span>:<span style=color:#f1fa8c>&#34;2023-03-09T09:30:14Z&#34;</span>,<span style=color:#ff79c6>&#34;deletionTimestamp&#34;</span>:<span style=color:#f1fa8c>&#34;2023-03-10T15:59:10Z&#34;</span>,<span style=color:#ff79c6>&#34;deletionGracePeriodSeconds&#34;</span>:<span style=color:#bd93f9>30</span>,<span style=color:#ff79c6>&#34;annotations&#34;</span>:{<span style=color:#ff79c6>&#34;kubectl.kubernetes.io/last-applied-configuration&#34;</span>:<span style=color:#f1fa8c>&#34;{\&#34;apiVersion\&#34;:\&#34;v1\&#34;,\&#34;kind\&#34;:\&#34;Pod\&#34;,\&#34;metadata\&#34;:{\&#34;annotations\&#34;:{\&#34;sidecar.istio.io/inject\&#34;:\&#34;false\&#34;},\&#34;name\&#34;:\&#34;network-tool\&#34;,\&#34;namespace\&#34;:\&#34;default\&#34;},\&#34;spec\&#34;:{\&#34;containers\&#34;:[{\&#34;image\&#34;:\&#34;zhaohuabing/network-tool\&#34;,\&#34;name\&#34;:\&#34;network-tool\&#34;,\&#34;securityContext\&#34;:{\&#34;capabilities\&#34;:{\&#34;add\&#34;:[\&#34;NET_ADMIN\&#34;]}}}]}}\n&#34;</span>,<span style=color:#ff79c6>&#34;sidecar.istio.io/inject&#34;</span>:<span style=color:#f1fa8c>&#34;false&#34;</span>},<span style=color:#ff79c6>&#34;managedFields&#34;</span>:[{<span style=color:#ff79c6>&#34;manager&#34;</span>:<span style=color:#f1fa8c>&#34;kubectl-client-side-apply&#34;</span>,<span style=color:#ff79c6>&#34;operation&#34;</span>:<span style=color:#f1fa8c>&#34;Update&#34;</span>,<span style=color:#ff79c6>&#34;apiVersion&#34;</span>:<span style=color:#f1fa8c>&#34;v1&#34;</span>,<span style=color:#ff79c6>&#34;time&#34;</span>:<span style=color:#f1fa8c>&#34;2023-03-09T09:30:14Z&#34;</span>,<span style=color:#ff79c6>&#34;fieldsType&#34;</span>:<span style=color:#f1fa8c>&#34;FieldsV1&#34;</span>,<span style=color:#ff79c6>&#34;fieldsV1&#34;</span>:{<span style=color:#ff79c6>&#34;f:metadata&#34;</span>:{<span style=color:#ff79c6>&#34;f:annotations&#34;</span>:{<span style=color:#ff79c6>&#34;.&#34;</span>:{},<span style=color:#ff79c6>&#34;f:kubectl.kubernetes.io/last-applied-configuration&#34;</span>:{},<span style=color:#ff79c6>&#34;f:sidecar.istio.io/inject&#34;</span>:{}}},<span style=color:#ff79c6>&#34;f:spec&#34;</span>:{<span style=color:#ff79c6>&#34;f:containers&#34;</span>:{<span style=color:#ff79c6>&#34;k:{\&#34;name\&#34;:\&#34;network-tool\&#34;}&#34;</span>:{<span style=color:#ff79c6>&#34;.&#34;</span>:{},<span style=color:#ff79c6>&#34;f:image&#34;</span>:{},<span style=color:#ff79c6>&#34;f:imagePullPolicy&#34;</span>:{},<span style=color:#ff79c6>&#34;f:name&#34;</span>:{},<span style=color:#ff79c6>&#34;f:resources&#34;</span>:{},<span style=color:#ff79c6>&#34;f:securityContext&#34;</span>:{<span style=color:#ff79c6>&#34;.&#34;</span>:{},<span style=color:#ff79c6>&#34;f:capabilities&#34;</span>:{<span style=color:#ff79c6>&#34;.&#34;</span>:{},<span style=color:#ff79c6>&#34;f:add&#34;</span>:{}}},<span style=color:#ff79c6>&#34;f:terminationMessagePath&#34;</span>:{},<span style=color:#ff79c6>&#34;f:terminationMessagePolicy&#34;</span>:{}}},<span style=color:#ff79c6>&#34;f:dnsPolicy&#34;</span>:{},<span style=color:#ff79c6>&#34;f:enableServiceLinks&#34;</span>:{},<span style=color:#ff79c6>&#34;f:restartPolicy&#34;</span>:{},<span style=color:#ff79c6>&#34;f:schedulerName&#34;</span>:{},<span style=color:#ff79c6>&#34;f:securityContext&#34;</span>:{},<span style=color:#ff79c6>&#34;f:terminationGracePeriodSeconds&#34;</span>:{}}}},{<span style=color:#ff79c6>&#34;manager&#34;</span>:<span style=color:#f1fa8c>&#34;kubelet&#34;</span>,<span style=color:#ff79c6>&#34;operation&#34;</span>:<span style=color:#f1fa8c>&#34;Update&#34;</span>,<span style=color:#ff79c6>&#34;apiVersion&#34;</span>:<span style=color:#f1fa8c>&#34;v1&#34;</span>,<span style=color:#ff79c6>&#34;time&#34;</span>:<span style=color:#f1fa8c>&#34;2023-03-10T13:36:56Z&#34;</span>,<span style=color:#ff79c6>&#34;fieldsType&#34;</span>:<span style=color:#f1fa8c>&#34;FieldsV1&#34;</span>,<span style=color:#ff79c6>&#34;fieldsV1&#34;</span>:{<span style=color:#ff79c6>&#34;f:status&#34;</span>:{<span style=color:#ff79c6>&#34;f:conditions&#34;</span>:{<span style=color:#ff79c6>&#34;k:{\&#34;type\&#34;:\&#34;ContainersReady\&#34;}&#34;</span>:{<span style=color:#ff79c6>&#34;.&#34;</span>:{},<span style=color:#ff79c6>&#34;f:lastProbeTime&#34;</span>:{},<span style=color:#ff79c6>&#34;f:lastTransitionTime&#34;</span>:{},<span style=color:#ff79c6>&#34;f:status&#34;</span>:{},<span style=color:#ff79c6>&#34;f:type&#34;</span>:{}},<span style=color:#ff79c6>&#34;k:{\&#34;type\&#34;:\&#34;Initialized\&#34;}&#34;</span>:{<span style=color:#ff79c6>&#34;.&#34;</span>:{},<span style=color:#ff79c6>&#34;f:lastProbeTime&#34;</span>:{},<span style=color:#ff79c6>&#34;f:lastTransitionTime&#34;</span>:{},<span style=color:#ff79c6>&#34;f:status&#34;</span>:{},<span style=color:#ff79c6>&#34;f:type&#34;</span>:{}},<span style=color:#ff79c6>&#34;k:{\&#34;type\&#34;:\&#34;Ready\&#34;}&#34;</span>:{<span style=color:#ff79c6>&#34;.&#34;</span>:{},<span style=color:#ff79c6>&#34;f:lastProbeTime&#34;</span>:{},<span style=color:#ff79c6>&#34;f:lastTransitionTime&#34;</span>:{},<span style=color:#ff79c6>&#34;f:status&#34;</span>:{},<span style=color:#ff79c6>&#34;f:type&#34;</span>:{}}},<span style=color:#ff79c6>&#34;f:containerStatuses&#34;</span>:{},<span style=color:#ff79c6>&#34;f:hostIP&#34;</span>:{},<span style=color:#ff79c6>&#34;f:phase&#34;</span>:{},<span style=color:#ff79c6>&#34;f:podIP&#34;</span>:{},<span style=color:#ff79c6>&#34;f:podIPs&#34;</span>:{<span style=color:#ff79c6>&#34;.&#34;</span>:{},<span style=color:#ff79c6>&#34;k:{\&#34;ip\&#34;:\&#34;10.244.0.8\&#34;}&#34;</span>:{<span style=color:#ff79c6>&#34;.&#34;</span>:{},<span style=color:#ff79c6>&#34;f:ip&#34;</span>:{}}},<span style=color:#ff79c6>&#34;f:startTime&#34;</span>:{}}}}]},<span style=color:#ff79c6>&#34;spec&#34;</span>:{<span style=color:#ff79c6>&#34;volumes&#34;</span>:[{<span style=color:#ff79c6>&#34;name&#34;</span>:<span style=color:#f1fa8c>&#34;kube-api-access-cwjmv&#34;</span>,<span style=color:#ff79c6>&#34;projected&#34;</span>:{<span style=color:#ff79c6>&#34;sources&#34;</span>:[{<span style=color:#ff79c6>&#34;serviceAccountToken&#34;</span>:{<span style=color:#ff79c6>&#34;expirationSeconds&#34;</span>:<span style=color:#bd93f9>3607</span>,<span style=color:#ff79c6>&#34;path&#34;</span>:<span style=color:#f1fa8c>&#34;token&#34;</span>}},{<span style=color:#ff79c6>&#34;configMap&#34;</span>:{<span style=color:#ff79c6>&#34;name&#34;</span>:<span style=color:#f1fa8c>&#34;kube-root-ca.crt&#34;</span>,<span style=color:#ff79c6>&#34;items&#34;</span>:[{<span style=color:#ff79c6>&#34;key&#34;</span>:<span style=color:#f1fa8c>&#34;ca.crt&#34;</span>,<span style=color:#ff79c6>&#34;path&#34;</span>:<span style=color:#f1fa8c>&#34;ca.crt&#34;</span>}]}},{<span style=color:#ff79c6>&#34;downwardAPI&#34;</span>:{<span style=color:#ff79c6>&#34;items&#34;</span>:[{<span style=color:#ff79c6>&#34;path&#34;</span>:<span style=color:#f1fa8c>&#34;namespace&#34;</span>,<span style=color:#ff79c6>&#34;fieldRef&#34;</span>:{<span style=color:#ff79c6>&#34;apiVersion&#34;</span>:<span style=color:#f1fa8c>&#34;v1&#34;</span>,<span style=color:#ff79c6>&#34;fieldPath&#34;</span>:<span style=color:#f1fa8c>&#34;metadata.namespace&#34;</span>}}]}}],<span style=color:#ff79c6>&#34;defaultMode&#34;</span>:<span style=color:#bd93f9>420</span>}}],<span style=color:#ff79c6>&#34;containers&#34;</span>:[{<span style=color:#ff79c6>&#34;name&#34;</span>:<span style=color:#f1fa8c>&#34;network-tool&#34;</span>,<span style=color:#ff79c6>&#34;image&#34;</span>:<span style=color:#f1fa8c>&#34;zhaohuabing/network-tool&#34;</span>,<span style=color:#ff79c6>&#34;resources&#34;</span>:{},<span style=color:#ff79c6>&#34;volumeMounts&#34;</span>:[{<span style=color:#ff79c6>&#34;name&#34;</span>:<span style=color:#f1fa8c>&#34;kube-api-access-cwjmv&#34;</span>,<span style=color:#ff79c6>&#34;readOnly&#34;</span>:<span style=color:#ff79c6>true</span>,<span style=color:#ff79c6>&#34;mountPath&#34;</span>:<span style=color:#f1fa8c>&#34;/var/run/secrets/kubernetes.io/serviceaccount&#34;</span>}],<span style=color:#ff79c6>&#34;terminationMessagePath&#34;</span>:<span style=color:#f1fa8c>&#34;/dev/termination-log&#34;</span>,<span style=color:#ff79c6>&#34;terminationMessagePolicy&#34;</span>:<span style=color:#f1fa8c>&#34;File&#34;</span>,<span style=color:#ff79c6>&#34;imagePullPolicy&#34;</span>:<span style=color:#f1fa8c>&#34;Always&#34;</span>,<span style=color:#ff79c6>&#34;securityContext&#34;</span>:{<span style=color:#ff79c6>&#34;capabilities&#34;</span>:{<span style=color:#ff79c6>&#34;add&#34;</span>:[<span style=color:#f1fa8c>&#34;NET_ADMIN&#34;</span>]}}}],<span style=color:#ff79c6>&#34;restartPolicy&#34;</span>:<span style=color:#f1fa8c>&#34;Always&#34;</span>,<span style=color:#ff79c6>&#34;terminationGracePeriodSeconds&#34;</span>:<span style=color:#bd93f9>30</span>,<span style=color:#ff79c6>&#34;dnsPolicy&#34;</span>:<span style=color:#f1fa8c>&#34;ClusterFirst&#34;</span>,<span style=color:#ff79c6>&#34;serviceAccountName&#34;</span>:<span style=color:#f1fa8c>&#34;default&#34;</span>,<span style=color:#ff79c6>&#34;serviceAccount&#34;</span>:<span style=color:#f1fa8c>&#34;default&#34;</span>,<span style=color:#ff79c6>&#34;nodeName&#34;</span>:<span style=color:#f1fa8c>&#34;aeraki-control-plane&#34;</span>,<span style=color:#ff79c6>&#34;securityContext&#34;</span>:{},<span style=color:#ff79c6>&#34;schedulerName&#34;</span>:<span style=color:#f1fa8c>&#34;default-scheduler&#34;</span>,<span style=color:#ff79c6>&#34;tolerations&#34;</span>:[{<span style=color:#ff79c6>&#34;key&#34;</span>:<span style=color:#f1fa8c>&#34;node.kubernetes.io/not-ready&#34;</span>,<span style=color:#ff79c6>&#34;operator&#34;</span>:<span style=color:#f1fa8c>&#34;Exists&#34;</span>,<span style=color:#ff79c6>&#34;effect&#34;</span>:<span style=color:#f1fa8c>&#34;NoExecute&#34;</span>,<span style=color:#ff79c6>&#34;tolerationSeconds&#34;</span>:<span style=color:#bd93f9>300</span>},{<span style=color:#ff79c6>&#34;key&#34;</span>:<span style=color:#f1fa8c>&#34;node.kubernetes.io/unreachable&#34;</span>,<span style=color:#ff79c6>&#34;operator&#34;</span>:<span style=color:#f1fa8c>&#34;Exists&#34;</span>,<span style=color:#ff79c6>&#34;effect&#34;</span>:<span style=color:#f1fa8c>&#34;NoExecute&#34;</span>,<span style=color:#ff79c6>&#34;tolerationSeconds&#34;</span>:<span style=color:#bd93f9>300</span>}],<span style=color:#ff79c6>&#34;priority&#34;</span>:<span style=color:#bd93f9>0</span>,<span style=color:#ff79c6>&#34;enableServiceLinks&#34;</span>:<span style=color:#ff79c6>true</span>,<span style=color:#ff79c6>&#34;preemptionPolicy&#34;</span>:<span style=color:#f1fa8c>&#34;PreemptLowerPriority&#34;</span>},<span style=color:#ff79c6>&#34;status&#34;</span>:{<span style=color:#ff79c6>&#34;phase&#34;</span>:<span style=color:#f1fa8c>&#34;Running&#34;</span>,<span style=color:#ff79c6>&#34;conditions&#34;</span>:[{<span style=color:#ff79c6>&#34;type&#34;</span>:<span style=color:#f1fa8c>&#34;Initialized&#34;</span>,<span style=color:#ff79c6>&#34;status&#34;</span>:<span style=color:#f1fa8c>&#34;True&#34;</span>,<span style=color:#ff79c6>&#34;lastProbeTime&#34;</span>:<span style=color:#ff79c6>null</span>,<span style=color:#ff79c6>&#34;lastTransitionTime&#34;</span>:<span style=color:#f1fa8c>&#34;2023-03-09T09:30:14Z&#34;</span>},{<span style=color:#ff79c6>&#34;type&#34;</span>:<span style=color:#f1fa8c>&#34;Ready&#34;</span>,<span style=color:#ff79c6>&#34;status&#34;</span>:<span style=color:#f1fa8c>&#34;True&#34;</span>,<span style=color:#ff79c6>&#34;lastProbeTime&#34;</span>:<span style=color:#ff79c6>null</span>,<span style=color:#ff79c6>&#34;lastTransitionTime&#34;</span>:<span style=color:#f1fa8c>&#34;2023-03-10T13:36:56Z&#34;</span>},{<span style=color:#ff79c6>&#34;type&#34;</span>:<span style=color:#f1fa8c>&#34;ContainersReady&#34;</span>,<span style=color:#ff79c6>&#34;status&#34;</span>:<span style=color:#f1fa8c>&#34;True&#34;</span>,<span style=color:#ff79c6>&#34;lastProbeTime&#34;</span>:<span style=color:#ff79c6>null</span>,<span style=color:#ff79c6>&#34;lastTransitionTime&#34;</span>:<span style=color:#f1fa8c>&#34;2023-03-10T13:36:56Z&#34;</span>},{<span style=color:#ff79c6>&#34;type&#34;</span>:<span style=color:#f1fa8c>&#34;PodScheduled&#34;</span>,<span style=color:#ff79c6>&#34;status&#34;</span>:<span style=color:#f1fa8c>&#34;True&#34;</span>,<span style=color:#ff79c6>&#34;lastProbeTime&#34;</span>:<span style=color:#ff79c6>null</span>,<span style=color:#ff79c6>&#34;lastTransitionTime&#34;</span>:<span style=color:#f1fa8c>&#34;2023-03-09T09:30:14Z&#34;</span>}],<span style=color:#ff79c6>&#34;hostIP&#34;</span>:<span style=color:#f1fa8c>&#34;172.20.0.2&#34;</span>,<span style=color:#ff79c6>&#34;podIP&#34;</span>:<span style=color:#f1fa8c>&#34;10.244.0.8&#34;</span>,<span style=color:#ff79c6>&#34;podIPs&#34;</span>:[{<span style=color:#ff79c6>&#34;ip&#34;</span>:<span style=color:#f1fa8c>&#34;10.244.0.8&#34;</span>}],<span style=color:#ff79c6>&#34;startTime&#34;</span>:<span style=color:#f1fa8c>&#34;2023-03-09T09:30:14Z&#34;</span>,<span style=color:#ff79c6>&#34;containerStatuses&#34;</span>:[{<span style=color:#ff79c6>&#34;name&#34;</span>:<span style=color:#f1fa8c>&#34;network-tool&#34;</span>,<span style=color:#ff79c6>&#34;state&#34;</span>:{<span style=color:#ff79c6>&#34;running&#34;</span>:{<span style=color:#ff79c6>&#34;startedAt&#34;</span>:<span style=color:#f1fa8c>&#34;2023-03-10T13:36:56Z&#34;</span>}},<span style=color:#ff79c6>&#34;lastState&#34;</span>:{<span style=color:#ff79c6>&#34;terminated&#34;</span>:{<span style=color:#ff79c6>&#34;exitCode&#34;</span>:<span style=color:#bd93f9>255</span>,<span style=color:#ff79c6>&#34;reason&#34;</span>:<span style=color:#f1fa8c>&#34;Unknown&#34;</span>,<span style=color:#ff79c6>&#34;startedAt&#34;</span>:<span style=color:#f1fa8c>&#34;2023-03-09T09:30:18Z&#34;</span>,<span style=color:#ff79c6>&#34;finishedAt&#34;</span>:<span style=color:#f1fa8c>&#34;2023-03-10T13:31:39Z&#34;</span>,<span style=color:#ff79c6>&#34;containerID&#34;</span>:<span style=color:#f1fa8c>&#34;containerd://b52804466bbe6ad9d233b8c080b8d33289c247dbcf1be4d2bd9c609099041a96&#34;</span>}},<span style=color:#ff79c6>&#34;ready&#34;</span>:<span style=color:#ff79c6>true</span>,<span style=color:#ff79c6>&#34;restartCount&#34;</span>:<span style=color:#bd93f9>1</span>,<span style=color:#ff79c6>&#34;image&#34;</span>:<span style=color:#f1fa8c>&#34;docker.io/zhaohuabing/network-tool:latest&#34;</span>,<span style=color:#ff79c6>&#34;imageID&#34;</span>:<span style=color:#f1fa8c>&#34;docker.io/zhaohuabing/network-tool@sha256:5843e4f12742f0e34932ba42205f177a62d930eadb419d99fa4881483ea46629&#34;</span>,<span style=color:#ff79c6>&#34;containerID&#34;</span>:<span style=color:#f1fa8c>&#34;containerd://020d9b471682786883498e220bc48f932973f64fff6c5629559da3dca9d2358e&#34;</span>,<span style=color:#ff79c6>&#34;started&#34;</span>:<span style=color:#ff79c6>true</span>}],<span style=color:#ff79c6>&#34;qosClass&#34;</span>:<span style=color:#f1fa8c>&#34;BestEffort&#34;</span>}}}
</span></span><span style=display:flex><span>{<span style=color:#ff79c6>&#34;type&#34;</span>:<span style=color:#f1fa8c>&#34;MODIFIED&#34;</span>,<span style=color:#ff79c6>&#34;object&#34;</span>:{<span style=color:#ff79c6>&#34;kind&#34;</span>:<span style=color:#f1fa8c>&#34;Pod&#34;</span>,<span style=color:#ff79c6>&#34;apiVersion&#34;</span>:<span style=color:#f1fa8c>&#34;v1&#34;</span>,<span style=color:#ff79c6>&#34;metadata&#34;</span>:{<span style=color:#ff79c6>&#34;name&#34;</span>:<span style=color:#f1fa8c>&#34;network-tool&#34;</span>,<span style=color:#ff79c6>&#34;namespace&#34;</span>:<span style=color:#f1fa8c>&#34;default&#34;</span>,<span style=color:#ff79c6>&#34;uid&#34;</span>:<span style=color:#f1fa8c>&#34;548a29a9-9359-4858-8a18-48633d29d394&#34;</span>,<span style=color:#ff79c6>&#34;resourceVersion&#34;</span>:<span style=color:#f1fa8c>&#34;760008&#34;</span>,<span style=color:#ff79c6>&#34;creationTimestamp&#34;</span>:<span style=color:#f1fa8c>&#34;2023-03-09T09:30:14Z&#34;</span>,<span style=color:#ff79c6>&#34;deletionTimestamp&#34;</span>:<span style=color:#f1fa8c>&#34;2023-03-10T15:59:10Z&#34;</span>,<span style=color:#ff79c6>&#34;deletionGracePeriodSeconds&#34;</span>:<span style=color:#bd93f9>30</span>,<span style=color:#ff79c6>&#34;annotations&#34;</span>:{<span style=color:#ff79c6>&#34;kubectl.kubernetes.io/last-applied-configuration&#34;</span>:<span style=color:#f1fa8c>&#34;{\&#34;apiVersion\&#34;:\&#34;v1\&#34;,\&#34;kind\&#34;:\&#34;Pod\&#34;,\&#34;metadata\&#34;:{\&#34;annotations\&#34;:{\&#34;sidecar.istio.io/inject\&#34;:\&#34;false\&#34;},\&#34;name\&#34;:\&#34;network-tool\&#34;,\&#34;namespace\&#34;:\&#34;default\&#34;},\&#34;spec\&#34;:{\&#34;containers\&#34;:[{\&#34;image\&#34;:\&#34;zhaohuabing/network-tool\&#34;,\&#34;name\&#34;:\&#34;network-tool\&#34;,\&#34;securityContext\&#34;:{\&#34;capabilities\&#34;:{\&#34;add\&#34;:[\&#34;NET_ADMIN\&#34;]}}}]}}\n&#34;</span>,<span style=color:#ff79c6>&#34;sidecar.istio.io/inject&#34;</span>:<span style=color:#f1fa8c>&#34;false&#34;</span>},<span style=color:#ff79c6>&#34;managedFields&#34;</span>:[{<span style=color:#ff79c6>&#34;manager&#34;</span>:<span style=color:#f1fa8c>&#34;kubectl-client-side-apply&#34;</span>,<span style=color:#ff79c6>&#34;operation&#34;</span>:<span style=color:#f1fa8c>&#34;Update&#34;</span>,<span style=color:#ff79c6>&#34;apiVersion&#34;</span>:<span style=color:#f1fa8c>&#34;v1&#34;</span>,<span style=color:#ff79c6>&#34;time&#34;</span>:<span style=color:#f1fa8c>&#34;2023-03-09T09:30:14Z&#34;</span>,<span style=color:#ff79c6>&#34;fieldsType&#34;</span>:<span style=color:#f1fa8c>&#34;FieldsV1&#34;</span>,<span style=color:#ff79c6>&#34;fieldsV1&#34;</span>:{<span style=color:#ff79c6>&#34;f:metadata&#34;</span>:{<span style=color:#ff79c6>&#34;f:annotations&#34;</span>:{<span style=color:#ff79c6>&#34;.&#34;</span>:{},<span style=color:#ff79c6>&#34;f:kubectl.kubernetes.io/last-applied-configuration&#34;</span>:{},<span style=color:#ff79c6>&#34;f:sidecar.istio.io/inject&#34;</span>:{}}},<span style=color:#ff79c6>&#34;f:spec&#34;</span>:{<span style=color:#ff79c6>&#34;f:containers&#34;</span>:{<span style=color:#ff79c6>&#34;k:{\&#34;name\&#34;:\&#34;network-tool\&#34;}&#34;</span>:{<span style=color:#ff79c6>&#34;.&#34;</span>:{},<span style=color:#ff79c6>&#34;f:image&#34;</span>:{},<span style=color:#ff79c6>&#34;f:imagePullPolicy&#34;</span>:{},<span style=color:#ff79c6>&#34;f:name&#34;</span>:{},<span style=color:#ff79c6>&#34;f:resources&#34;</span>:{},<span style=color:#ff79c6>&#34;f:securityContext&#34;</span>:{<span style=color:#ff79c6>&#34;.&#34;</span>:{},<span style=color:#ff79c6>&#34;f:capabilities&#34;</span>:{<span style=color:#ff79c6>&#34;.&#34;</span>:{},<span style=color:#ff79c6>&#34;f:add&#34;</span>:{}}},<span style=color:#ff79c6>&#34;f:terminationMessagePath&#34;</span>:{},<span style=color:#ff79c6>&#34;f:terminationMessagePolicy&#34;</span>:{}}},<span style=color:#ff79c6>&#34;f:dnsPolicy&#34;</span>:{},<span style=color:#ff79c6>&#34;f:enableServiceLinks&#34;</span>:{},<span style=color:#ff79c6>&#34;f:restartPolicy&#34;</span>:{},<span style=color:#ff79c6>&#34;f:schedulerName&#34;</span>:{},<span style=color:#ff79c6>&#34;f:securityContext&#34;</span>:{},<span style=color:#ff79c6>&#34;f:terminationGracePeriodSeconds&#34;</span>:{}}}},{<span style=color:#ff79c6>&#34;manager&#34;</span>:<span style=color:#f1fa8c>&#34;kubelet&#34;</span>,<span style=color:#ff79c6>&#34;operation&#34;</span>:<span style=color:#f1fa8c>&#34;Update&#34;</span>,<span style=color:#ff79c6>&#34;apiVersion&#34;</span>:<span style=color:#f1fa8c>&#34;v1&#34;</span>,<span style=color:#ff79c6>&#34;time&#34;</span>:<span style=color:#f1fa8c>&#34;2023-03-10T15:59:10Z&#34;</span>,<span style=color:#ff79c6>&#34;fieldsType&#34;</span>:<span style=color:#f1fa8c>&#34;FieldsV1&#34;</span>,<span style=color:#ff79c6>&#34;fieldsV1&#34;</span>:{<span style=color:#ff79c6>&#34;f:status&#34;</span>:{<span style=color:#ff79c6>&#34;f:conditions&#34;</span>:{<span style=color:#ff79c6>&#34;k:{\&#34;type\&#34;:\&#34;ContainersReady\&#34;}&#34;</span>:{<span style=color:#ff79c6>&#34;.&#34;</span>:{},<span style=color:#ff79c6>&#34;f:lastProbeTime&#34;</span>:{},<span style=color:#ff79c6>&#34;f:lastTransitionTime&#34;</span>:{},<span style=color:#ff79c6>&#34;f:message&#34;</span>:{},<span style=color:#ff79c6>&#34;f:reason&#34;</span>:{},<span style=color:#ff79c6>&#34;f:status&#34;</span>:{},<span style=color:#ff79c6>&#34;f:type&#34;</span>:{}},<span style=color:#ff79c6>&#34;k:{\&#34;type\&#34;:\&#34;Initialized\&#34;}&#34;</span>:{<span style=color:#ff79c6>&#34;.&#34;</span>:{},<span style=color:#ff79c6>&#34;f:lastProbeTime&#34;</span>:{},<span style=color:#ff79c6>&#34;f:lastTransitionTime&#34;</span>:{},<span style=color:#ff79c6>&#34;f:status&#34;</span>:{},<span style=color:#ff79c6>&#34;f:type&#34;</span>:{}},<span style=color:#ff79c6>&#34;k:{\&#34;type\&#34;:\&#34;Ready\&#34;}&#34;</span>:{<span style=color:#ff79c6>&#34;.&#34;</span>:{},<span style=color:#ff79c6>&#34;f:lastProbeTime&#34;</span>:{},<span style=color:#ff79c6>&#34;f:lastTransitionTime&#34;</span>:{},<span style=color:#ff79c6>&#34;f:message&#34;</span>:{},<span style=color:#ff79c6>&#34;f:reason&#34;</span>:{},<span style=color:#ff79c6>&#34;f:status&#34;</span>:{},<span style=color:#ff79c6>&#34;f:type&#34;</span>:{}}},<span style=color:#ff79c6>&#34;f:containerStatuses&#34;</span>:{},<span style=color:#ff79c6>&#34;f:hostIP&#34;</span>:{},<span style=color:#ff79c6>&#34;f:phase&#34;</span>:{},<span style=color:#ff79c6>&#34;f:podIP&#34;</span>:{},<span style=color:#ff79c6>&#34;f:podIPs&#34;</span>:{<span style=color:#ff79c6>&#34;.&#34;</span>:{},<span style=color:#ff79c6>&#34;k:{\&#34;ip\&#34;:\&#34;10.244.0.8\&#34;}&#34;</span>:{<span style=color:#ff79c6>&#34;.&#34;</span>:{},<span style=color:#ff79c6>&#34;f:ip&#34;</span>:{}}},<span style=color:#ff79c6>&#34;f:startTime&#34;</span>:{}}}}]},<span style=color:#ff79c6>&#34;spec&#34;</span>:{<span style=color:#ff79c6>&#34;volumes&#34;</span>:[{<span style=color:#ff79c6>&#34;name&#34;</span>:<span style=color:#f1fa8c>&#34;kube-api-access-cwjmv&#34;</span>,<span style=color:#ff79c6>&#34;projected&#34;</span>:{<span style=color:#ff79c6>&#34;sources&#34;</span>:[{<span style=color:#ff79c6>&#34;serviceAccountToken&#34;</span>:{<span style=color:#ff79c6>&#34;expirationSeconds&#34;</span>:<span style=color:#bd93f9>3607</span>,<span style=color:#ff79c6>&#34;path&#34;</span>:<span style=color:#f1fa8c>&#34;token&#34;</span>}},{<span style=color:#ff79c6>&#34;configMap&#34;</span>:{<span style=color:#ff79c6>&#34;name&#34;</span>:<span style=color:#f1fa8c>&#34;kube-root-ca.crt&#34;</span>,<span style=color:#ff79c6>&#34;items&#34;</span>:[{<span style=color:#ff79c6>&#34;key&#34;</span>:<span style=color:#f1fa8c>&#34;ca.crt&#34;</span>,<span style=color:#ff79c6>&#34;path&#34;</span>:<span style=color:#f1fa8c>&#34;ca.crt&#34;</span>}]}},{<span style=color:#ff79c6>&#34;downwardAPI&#34;</span>:{<span style=color:#ff79c6>&#34;items&#34;</span>:[{<span style=color:#ff79c6>&#34;path&#34;</span>:<span style=color:#f1fa8c>&#34;namespace&#34;</span>,<span style=color:#ff79c6>&#34;fieldRef&#34;</span>:{<span style=color:#ff79c6>&#34;apiVersion&#34;</span>:<span style=color:#f1fa8c>&#34;v1&#34;</span>,<span style=color:#ff79c6>&#34;fieldPath&#34;</span>:<span style=color:#f1fa8c>&#34;metadata.namespace&#34;</span>}}]}}],<span style=color:#ff79c6>&#34;defaultMode&#34;</span>:<span style=color:#bd93f9>420</span>}}],<span style=color:#ff79c6>&#34;containers&#34;</span>:[{<span style=color:#ff79c6>&#34;name&#34;</span>:<span style=color:#f1fa8c>&#34;network-tool&#34;</span>,<span style=color:#ff79c6>&#34;image&#34;</span>:<span style=color:#f1fa8c>&#34;zhaohuabing/network-tool&#34;</span>,<span style=color:#ff79c6>&#34;resources&#34;</span>:{},<span style=color:#ff79c6>&#34;volumeMounts&#34;</span>:[{<span style=color:#ff79c6>&#34;name&#34;</span>:<span style=color:#f1fa8c>&#34;kube-api-access-cwjmv&#34;</span>,<span style=color:#ff79c6>&#34;readOnly&#34;</span>:<span style=color:#ff79c6>true</span>,<span style=color:#ff79c6>&#34;mountPath&#34;</span>:<span style=color:#f1fa8c>&#34;/var/run/secrets/kubernetes.io/serviceaccount&#34;</span>}],<span style=color:#ff79c6>&#34;terminationMessagePath&#34;</span>:<span style=color:#f1fa8c>&#34;/dev/termination-log&#34;</span>,<span style=color:#ff79c6>&#34;terminationMessagePolicy&#34;</span>:<span style=color:#f1fa8c>&#34;File&#34;</span>,<span style=color:#ff79c6>&#34;imagePullPolicy&#34;</span>:<span style=color:#f1fa8c>&#34;Always&#34;</span>,<span style=color:#ff79c6>&#34;securityContext&#34;</span>:{<span style=color:#ff79c6>&#34;capabilities&#34;</span>:{<span style=color:#ff79c6>&#34;add&#34;</span>:[<span style=color:#f1fa8c>&#34;NET_ADMIN&#34;</span>]}}}],<span style=color:#ff79c6>&#34;restartPolicy&#34;</span>:<span style=color:#f1fa8c>&#34;Always&#34;</span>,<span style=color:#ff79c6>&#34;terminationGracePeriodSeconds&#34;</span>:<span style=color:#bd93f9>30</span>,<span style=color:#ff79c6>&#34;dnsPolicy&#34;</span>:<span style=color:#f1fa8c>&#34;ClusterFirst&#34;</span>,<span style=color:#ff79c6>&#34;serviceAccountName&#34;</span>:<span style=color:#f1fa8c>&#34;default&#34;</span>,<span style=color:#ff79c6>&#34;serviceAccount&#34;</span>:<span style=color:#f1fa8c>&#34;default&#34;</span>,<span style=color:#ff79c6>&#34;nodeName&#34;</span>:<span style=color:#f1fa8c>&#34;aeraki-control-plane&#34;</span>,<span style=color:#ff79c6>&#34;securityContext&#34;</span>:{},<span style=color:#ff79c6>&#34;schedulerName&#34;</span>:<span style=color:#f1fa8c>&#34;default-scheduler&#34;</span>,<span style=color:#ff79c6>&#34;tolerations&#34;</span>:[{<span style=color:#ff79c6>&#34;key&#34;</span>:<span style=color:#f1fa8c>&#34;node.kubernetes.io/not-ready&#34;</span>,<span style=color:#ff79c6>&#34;operator&#34;</span>:<span style=color:#f1fa8c>&#34;Exists&#34;</span>,<span style=color:#ff79c6>&#34;effect&#34;</span>:<span style=color:#f1fa8c>&#34;NoExecute&#34;</span>,<span style=color:#ff79c6>&#34;tolerationSeconds&#34;</span>:<span style=color:#bd93f9>300</span>},{<span style=color:#ff79c6>&#34;key&#34;</span>:<span style=color:#f1fa8c>&#34;node.kubernetes.io/unreachable&#34;</span>,<span style=color:#ff79c6>&#34;operator&#34;</span>:<span style=color:#f1fa8c>&#34;Exists&#34;</span>,<span style=color:#ff79c6>&#34;effect&#34;</span>:<span style=color:#f1fa8c>&#34;NoExecute&#34;</span>,<span style=color:#ff79c6>&#34;tolerationSeconds&#34;</span>:<span style=color:#bd93f9>300</span>}],<span style=color:#ff79c6>&#34;priority&#34;</span>:<span style=color:#bd93f9>0</span>,<span style=color:#ff79c6>&#34;enableServiceLinks&#34;</span>:<span style=color:#ff79c6>true</span>,<span style=color:#ff79c6>&#34;preemptionPolicy&#34;</span>:<span style=color:#f1fa8c>&#34;PreemptLowerPriority&#34;</span>},<span style=color:#ff79c6>&#34;status&#34;</span>:{<span style=color:#ff79c6>&#34;phase&#34;</span>:<span style=color:#f1fa8c>&#34;Running&#34;</span>,<span style=color:#ff79c6>&#34;conditions&#34;</span>:[{<span style=color:#ff79c6>&#34;type&#34;</span>:<span style=color:#f1fa8c>&#34;Initialized&#34;</span>,<span style=color:#ff79c6>&#34;status&#34;</span>:<span style=color:#f1fa8c>&#34;True&#34;</span>,<span style=color:#ff79c6>&#34;lastProbeTime&#34;</span>:<span style=color:#ff79c6>null</span>,<span style=color:#ff79c6>&#34;lastTransitionTime&#34;</span>:<span style=color:#f1fa8c>&#34;2023-03-09T09:30:14Z&#34;</span>},{<span style=color:#ff79c6>&#34;type&#34;</span>:<span style=color:#f1fa8c>&#34;Ready&#34;</span>,<span style=color:#ff79c6>&#34;status&#34;</span>:<span style=color:#f1fa8c>&#34;False&#34;</span>,<span style=color:#ff79c6>&#34;lastProbeTime&#34;</span>:<span style=color:#ff79c6>null</span>,<span style=color:#ff79c6>&#34;lastTransitionTime&#34;</span>:<span style=color:#f1fa8c>&#34;2023-03-10T15:59:10Z&#34;</span>,<span style=color:#ff79c6>&#34;reason&#34;</span>:<span style=color:#f1fa8c>&#34;ContainersNotReady&#34;</span>,<span style=color:#ff79c6>&#34;message&#34;</span>:<span style=color:#f1fa8c>&#34;containers with unready status: [network-tool]&#34;</span>},{<span style=color:#ff79c6>&#34;type&#34;</span>:<span style=color:#f1fa8c>&#34;ContainersReady&#34;</span>,<span style=color:#ff79c6>&#34;status&#34;</span>:<span style=color:#f1fa8c>&#34;False&#34;</span>,<span style=color:#ff79c6>&#34;lastProbeTime&#34;</span>:<span style=color:#ff79c6>null</span>,<span style=color:#ff79c6>&#34;lastTransitionTime&#34;</span>:<span style=color:#f1fa8c>&#34;2023-03-10T15:59:10Z&#34;</span>,<span style=color:#ff79c6>&#34;reason&#34;</span>:<span style=color:#f1fa8c>&#34;ContainersNotReady&#34;</span>,<span style=color:#ff79c6>&#34;message&#34;</span>:<span style=color:#f1fa8c>&#34;containers with unready status: [network-tool]&#34;</span>},{<span style=color:#ff79c6>&#34;type&#34;</span>:<span style=color:#f1fa8c>&#34;PodScheduled&#34;</span>,<span style=color:#ff79c6>&#34;status&#34;</span>:<span style=color:#f1fa8c>&#34;True&#34;</span>,<span style=color:#ff79c6>&#34;lastProbeTime&#34;</span>:<span style=color:#ff79c6>null</span>,<span style=color:#ff79c6>&#34;lastTransitionTime&#34;</span>:<span style=color:#f1fa8c>&#34;2023-03-09T09:30:14Z&#34;</span>}],<span style=color:#ff79c6>&#34;hostIP&#34;</span>:<span style=color:#f1fa8c>&#34;172.20.0.2&#34;</span>,<span style=color:#ff79c6>&#34;podIP&#34;</span>:<span style=color:#f1fa8c>&#34;10.244.0.8&#34;</span>,<span style=color:#ff79c6>&#34;podIPs&#34;</span>:[{<span style=color:#ff79c6>&#34;ip&#34;</span>:<span style=color:#f1fa8c>&#34;10.244.0.8&#34;</span>}],<span style=color:#ff79c6>&#34;startTime&#34;</span>:<span style=color:#f1fa8c>&#34;2023-03-09T09:30:14Z&#34;</span>,<span style=color:#ff79c6>&#34;containerStatuses&#34;</span>:[{<span style=color:#ff79c6>&#34;name&#34;</span>:<span style=color:#f1fa8c>&#34;network-tool&#34;</span>,<span style=color:#ff79c6>&#34;state&#34;</span>:{<span style=color:#ff79c6>&#34;terminated&#34;</span>:{<span style=color:#ff79c6>&#34;exitCode&#34;</span>:<span style=color:#bd93f9>137</span>,<span style=color:#ff79c6>&#34;reason&#34;</span>:<span style=color:#f1fa8c>&#34;Error&#34;</span>,<span style=color:#ff79c6>&#34;startedAt&#34;</span>:<span style=color:#f1fa8c>&#34;2023-03-10T13:36:56Z&#34;</span>,<span style=color:#ff79c6>&#34;finishedAt&#34;</span>:<span style=color:#f1fa8c>&#34;2023-03-10T15:59:10Z&#34;</span>,<span style=color:#ff79c6>&#34;containerID&#34;</span>:<span style=color:#f1fa8c>&#34;containerd://020d9b471682786883498e220bc48f932973f64fff6c5629559da3dca9d2358e&#34;</span>}},<span style=color:#ff79c6>&#34;lastState&#34;</span>:{<span style=color:#ff79c6>&#34;terminated&#34;</span>:{<span style=color:#ff79c6>&#34;exitCode&#34;</span>:<span style=color:#bd93f9>255</span>,<span style=color:#ff79c6>&#34;reason&#34;</span>:<span style=color:#f1fa8c>&#34;Unknown&#34;</span>,<span style=color:#ff79c6>&#34;startedAt&#34;</span>:<span style=color:#f1fa8c>&#34;2023-03-09T09:30:18Z&#34;</span>,<span style=color:#ff79c6>&#34;finishedAt&#34;</span>:<span style=color:#f1fa8c>&#34;2023-03-10T13:31:39Z&#34;</span>,<span style=color:#ff79c6>&#34;containerID&#34;</span>:<span style=color:#f1fa8c>&#34;containerd://b52804466bbe6ad9d233b8c080b8d33289c247dbcf1be4d2bd9c609099041a96&#34;</span>}},<span style=color:#ff79c6>&#34;ready&#34;</span>:<span style=color:#ff79c6>false</span>,<span style=color:#ff79c6>&#34;restartCount&#34;</span>:<span style=color:#bd93f9>1</span>,<span style=color:#ff79c6>&#34;image&#34;</span>:<span style=color:#f1fa8c>&#34;docker.io/zhaohuabing/network-tool:latest&#34;</span>,<span style=color:#ff79c6>&#34;imageID&#34;</span>:<span style=color:#f1fa8c>&#34;docker.io/zhaohuabing/network-tool@sha256:5843e4f12742f0e34932ba42205f177a62d930eadb419d99fa4881483ea46629&#34;</span>,<span style=color:#ff79c6>&#34;containerID&#34;</span>:<span style=color:#f1fa8c>&#34;containerd://020d9b471682786883498e220bc48f932973f64fff6c5629559da3dca9d2358e&#34;</span>,<span style=color:#ff79c6>&#34;started&#34;</span>:<span style=color:#ff79c6>false</span>}],<span style=color:#ff79c6>&#34;qosClass&#34;</span>:<span style=color:#f1fa8c>&#34;BestEffort&#34;</span>}}}
</span></span><span style=display:flex><span>{<span style=color:#ff79c6>&#34;type&#34;</span>:<span style=color:#f1fa8c>&#34;MODIFIED&#34;</span>,<span style=color:#ff79c6>&#34;object&#34;</span>:{<span style=color:#ff79c6>&#34;kind&#34;</span>:<span style=color:#f1fa8c>&#34;Pod&#34;</span>,<span style=color:#ff79c6>&#34;apiVersion&#34;</span>:<span style=color:#f1fa8c>&#34;v1&#34;</span>,<span style=color:#ff79c6>&#34;metadata&#34;</span>:{<span style=color:#ff79c6>&#34;name&#34;</span>:<span style=color:#f1fa8c>&#34;network-tool&#34;</span>,<span style=color:#ff79c6>&#34;namespace&#34;</span>:<span style=color:#f1fa8c>&#34;default&#34;</span>,<span style=color:#ff79c6>&#34;uid&#34;</span>:<span style=color:#f1fa8c>&#34;548a29a9-9359-4858-8a18-48633d29d394&#34;</span>,<span style=color:#ff79c6>&#34;resourceVersion&#34;</span>:<span style=color:#f1fa8c>&#34;760031&#34;</span>,<span style=color:#ff79c6>&#34;creationTimestamp&#34;</span>:<span style=color:#f1fa8c>&#34;2023-03-09T09:30:14Z&#34;</span>,<span style=color:#ff79c6>&#34;deletionTimestamp&#34;</span>:<span style=color:#f1fa8c>&#34;2023-03-10T15:58:40Z&#34;</span>,<span style=color:#ff79c6>&#34;deletionGracePeriodSeconds&#34;</span>:<span style=color:#bd93f9>0</span>,<span style=color:#ff79c6>&#34;annotations&#34;</span>:{<span style=color:#ff79c6>&#34;kubectl.kubernetes.io/last-applied-configuration&#34;</span>:<span style=color:#f1fa8c>&#34;{\&#34;apiVersion\&#34;:\&#34;v1\&#34;,\&#34;kind\&#34;:\&#34;Pod\&#34;,\&#34;metadata\&#34;:{\&#34;annotations\&#34;:{\&#34;sidecar.istio.io/inject\&#34;:\&#34;false\&#34;},\&#34;name\&#34;:\&#34;network-tool\&#34;,\&#34;namespace\&#34;:\&#34;default\&#34;},\&#34;spec\&#34;:{\&#34;containers\&#34;:[{\&#34;image\&#34;:\&#34;zhaohuabing/network-tool\&#34;,\&#34;name\&#34;:\&#34;network-tool\&#34;,\&#34;securityContext\&#34;:{\&#34;capabilities\&#34;:{\&#34;add\&#34;:[\&#34;NET_ADMIN\&#34;]}}}]}}\n&#34;</span>,<span style=color:#ff79c6>&#34;sidecar.istio.io/inject&#34;</span>:<span style=color:#f1fa8c>&#34;false&#34;</span>},<span style=color:#ff79c6>&#34;managedFields&#34;</span>:[{<span style=color:#ff79c6>&#34;manager&#34;</span>:<span style=color:#f1fa8c>&#34;kubectl-client-side-apply&#34;</span>,<span style=color:#ff79c6>&#34;operation&#34;</span>:<span style=color:#f1fa8c>&#34;Update&#34;</span>,<span style=color:#ff79c6>&#34;apiVersion&#34;</span>:<span style=color:#f1fa8c>&#34;v1&#34;</span>,<span style=color:#ff79c6>&#34;time&#34;</span>:<span style=color:#f1fa8c>&#34;2023-03-09T09:30:14Z&#34;</span>,<span style=color:#ff79c6>&#34;fieldsType&#34;</span>:<span style=color:#f1fa8c>&#34;FieldsV1&#34;</span>,<span style=color:#ff79c6>&#34;fieldsV1&#34;</span>:{<span style=color:#ff79c6>&#34;f:metadata&#34;</span>:{<span style=color:#ff79c6>&#34;f:annotations&#34;</span>:{<span style=color:#ff79c6>&#34;.&#34;</span>:{},<span style=color:#ff79c6>&#34;f:kubectl.kubernetes.io/last-applied-configuration&#34;</span>:{},<span style=color:#ff79c6>&#34;f:sidecar.istio.io/inject&#34;</span>:{}}},<span style=color:#ff79c6>&#34;f:spec&#34;</span>:{<span style=color:#ff79c6>&#34;f:containers&#34;</span>:{<span style=color:#ff79c6>&#34;k:{\&#34;name\&#34;:\&#34;network-tool\&#34;}&#34;</span>:{<span style=color:#ff79c6>&#34;.&#34;</span>:{},<span style=color:#ff79c6>&#34;f:image&#34;</span>:{},<span style=color:#ff79c6>&#34;f:imagePullPolicy&#34;</span>:{},<span style=color:#ff79c6>&#34;f:name&#34;</span>:{},<span style=color:#ff79c6>&#34;f:resources&#34;</span>:{},<span style=color:#ff79c6>&#34;f:securityContext&#34;</span>:{<span style=color:#ff79c6>&#34;.&#34;</span>:{},<span style=color:#ff79c6>&#34;f:capabilities&#34;</span>:{<span style=color:#ff79c6>&#34;.&#34;</span>:{},<span style=color:#ff79c6>&#34;f:add&#34;</span>:{}}},<span style=color:#ff79c6>&#34;f:terminationMessagePath&#34;</span>:{},<span style=color:#ff79c6>&#34;f:terminationMessagePolicy&#34;</span>:{}}},<span style=color:#ff79c6>&#34;f:dnsPolicy&#34;</span>:{},<span style=color:#ff79c6>&#34;f:enableServiceLinks&#34;</span>:{},<span style=color:#ff79c6>&#34;f:restartPolicy&#34;</span>:{},<span style=color:#ff79c6>&#34;f:schedulerName&#34;</span>:{},<span style=color:#ff79c6>&#34;f:securityContext&#34;</span>:{},<span style=color:#ff79c6>&#34;f:terminationGracePeriodSeconds&#34;</span>:{}}}},{<span style=color:#ff79c6>&#34;manager&#34;</span>:<span style=color:#f1fa8c>&#34;kubelet&#34;</span>,<span style=color:#ff79c6>&#34;operation&#34;</span>:<span style=color:#f1fa8c>&#34;Update&#34;</span>,<span style=color:#ff79c6>&#34;apiVersion&#34;</span>:<span style=color:#f1fa8c>&#34;v1&#34;</span>,<span style=color:#ff79c6>&#34;time&#34;</span>:<span style=color:#f1fa8c>&#34;2023-03-10T15:59:10Z&#34;</span>,<span style=color:#ff79c6>&#34;fieldsType&#34;</span>:<span style=color:#f1fa8c>&#34;FieldsV1&#34;</span>,<span style=color:#ff79c6>&#34;fieldsV1&#34;</span>:{<span style=color:#ff79c6>&#34;f:status&#34;</span>:{<span style=color:#ff79c6>&#34;f:conditions&#34;</span>:{<span style=color:#ff79c6>&#34;k:{\&#34;type\&#34;:\&#34;ContainersReady\&#34;}&#34;</span>:{<span style=color:#ff79c6>&#34;.&#34;</span>:{},<span style=color:#ff79c6>&#34;f:lastProbeTime&#34;</span>:{},<span style=color:#ff79c6>&#34;f:lastTransitionTime&#34;</span>:{},<span style=color:#ff79c6>&#34;f:message&#34;</span>:{},<span style=color:#ff79c6>&#34;f:reason&#34;</span>:{},<span style=color:#ff79c6>&#34;f:status&#34;</span>:{},<span style=color:#ff79c6>&#34;f:type&#34;</span>:{}},<span style=color:#ff79c6>&#34;k:{\&#34;type\&#34;:\&#34;Initialized\&#34;}&#34;</span>:{<span style=color:#ff79c6>&#34;.&#34;</span>:{},<span style=color:#ff79c6>&#34;f:lastProbeTime&#34;</span>:{},<span style=color:#ff79c6>&#34;f:lastTransitionTime&#34;</span>:{},<span style=color:#ff79c6>&#34;f:status&#34;</span>:{},<span style=color:#ff79c6>&#34;f:type&#34;</span>:{}},<span style=color:#ff79c6>&#34;k:{\&#34;type\&#34;:\&#34;Ready\&#34;}&#34;</span>:{<span style=color:#ff79c6>&#34;.&#34;</span>:{},<span style=color:#ff79c6>&#34;f:lastProbeTime&#34;</span>:{},<span style=color:#ff79c6>&#34;f:lastTransitionTime&#34;</span>:{},<span style=color:#ff79c6>&#34;f:message&#34;</span>:{},<span style=color:#ff79c6>&#34;f:reason&#34;</span>:{},<span style=color:#ff79c6>&#34;f:status&#34;</span>:{},<span style=color:#ff79c6>&#34;f:type&#34;</span>:{}}},<span style=color:#ff79c6>&#34;f:containerStatuses&#34;</span>:{},<span style=color:#ff79c6>&#34;f:hostIP&#34;</span>:{},<span style=color:#ff79c6>&#34;f:phase&#34;</span>:{},<span style=color:#ff79c6>&#34;f:podIP&#34;</span>:{},<span style=color:#ff79c6>&#34;f:podIPs&#34;</span>:{<span style=color:#ff79c6>&#34;.&#34;</span>:{},<span style=color:#ff79c6>&#34;k:{\&#34;ip\&#34;:\&#34;10.244.0.8\&#34;}&#34;</span>:{<span style=color:#ff79c6>&#34;.&#34;</span>:{},<span style=color:#ff79c6>&#34;f:ip&#34;</span>:{}}},<span style=color:#ff79c6>&#34;f:startTime&#34;</span>:{}}}}]},<span style=color:#ff79c6>&#34;spec&#34;</span>:{<span style=color:#ff79c6>&#34;volumes&#34;</span>:[{<span style=color:#ff79c6>&#34;name&#34;</span>:<span style=color:#f1fa8c>&#34;kube-api-access-cwjmv&#34;</span>,<span style=color:#ff79c6>&#34;projected&#34;</span>:{<span style=color:#ff79c6>&#34;sources&#34;</span>:[{<span style=color:#ff79c6>&#34;serviceAccountToken&#34;</span>:{<span style=color:#ff79c6>&#34;expirationSeconds&#34;</span>:<span style=color:#bd93f9>3607</span>,<span style=color:#ff79c6>&#34;path&#34;</span>:<span style=color:#f1fa8c>&#34;token&#34;</span>}},{<span style=color:#ff79c6>&#34;configMap&#34;</span>:{<span style=color:#ff79c6>&#34;name&#34;</span>:<span style=color:#f1fa8c>&#34;kube-root-ca.crt&#34;</span>,<span style=color:#ff79c6>&#34;items&#34;</span>:[{<span style=color:#ff79c6>&#34;key&#34;</span>:<span style=color:#f1fa8c>&#34;ca.crt&#34;</span>,<span style=color:#ff79c6>&#34;path&#34;</span>:<span style=color:#f1fa8c>&#34;ca.crt&#34;</span>}]}},{<span style=color:#ff79c6>&#34;downwardAPI&#34;</span>:{<span style=color:#ff79c6>&#34;items&#34;</span>:[{<span style=color:#ff79c6>&#34;path&#34;</span>:<span style=color:#f1fa8c>&#34;namespace&#34;</span>,<span style=color:#ff79c6>&#34;fieldRef&#34;</span>:{<span style=color:#ff79c6>&#34;apiVersion&#34;</span>:<span style=color:#f1fa8c>&#34;v1&#34;</span>,<span style=color:#ff79c6>&#34;fieldPath&#34;</span>:<span style=color:#f1fa8c>&#34;metadata.namespace&#34;</span>}}]}}],<span style=color:#ff79c6>&#34;defaultMode&#34;</span>:<span style=color:#bd93f9>420</span>}}],<span style=color:#ff79c6>&#34;containers&#34;</span>:[{<span style=color:#ff79c6>&#34;name&#34;</span>:<span style=color:#f1fa8c>&#34;network-tool&#34;</span>,<span style=color:#ff79c6>&#34;image&#34;</span>:<span style=color:#f1fa8c>&#34;zhaohuabing/network-tool&#34;</span>,<span style=color:#ff79c6>&#34;resources&#34;</span>:{},<span style=color:#ff79c6>&#34;volumeMounts&#34;</span>:[{<span style=color:#ff79c6>&#34;name&#34;</span>:<span style=color:#f1fa8c>&#34;kube-api-access-cwjmv&#34;</span>,<span style=color:#ff79c6>&#34;readOnly&#34;</span>:<span style=color:#ff79c6>true</span>,<span style=color:#ff79c6>&#34;mountPath&#34;</span>:<span style=color:#f1fa8c>&#34;/var/run/secrets/kubernetes.io/serviceaccount&#34;</span>}],<span style=color:#ff79c6>&#34;terminationMessagePath&#34;</span>:<span style=color:#f1fa8c>&#34;/dev/termination-log&#34;</span>,<span style=color:#ff79c6>&#34;terminationMessagePolicy&#34;</span>:<span style=color:#f1fa8c>&#34;File&#34;</span>,<span style=color:#ff79c6>&#34;imagePullPolicy&#34;</span>:<span style=color:#f1fa8c>&#34;Always&#34;</span>,<span style=color:#ff79c6>&#34;securityContext&#34;</span>:{<span style=color:#ff79c6>&#34;capabilities&#34;</span>:{<span style=color:#ff79c6>&#34;add&#34;</span>:[<span style=color:#f1fa8c>&#34;NET_ADMIN&#34;</span>]}}}],<span style=color:#ff79c6>&#34;restartPolicy&#34;</span>:<span style=color:#f1fa8c>&#34;Always&#34;</span>,<span style=color:#ff79c6>&#34;terminationGracePeriodSeconds&#34;</span>:<span style=color:#bd93f9>30</span>,<span style=color:#ff79c6>&#34;dnsPolicy&#34;</span>:<span style=color:#f1fa8c>&#34;ClusterFirst&#34;</span>,<span style=color:#ff79c6>&#34;serviceAccountName&#34;</span>:<span style=color:#f1fa8c>&#34;default&#34;</span>,<span style=color:#ff79c6>&#34;serviceAccount&#34;</span>:<span style=color:#f1fa8c>&#34;default&#34;</span>,<span style=color:#ff79c6>&#34;nodeName&#34;</span>:<span style=color:#f1fa8c>&#34;aeraki-control-plane&#34;</span>,<span style=color:#ff79c6>&#34;securityContext&#34;</span>:{},<span style=color:#ff79c6>&#34;schedulerName&#34;</span>:<span style=color:#f1fa8c>&#34;default-scheduler&#34;</span>,<span style=color:#ff79c6>&#34;tolerations&#34;</span>:[{<span style=color:#ff79c6>&#34;key&#34;</span>:<span style=color:#f1fa8c>&#34;node.kubernetes.io/not-ready&#34;</span>,<span style=color:#ff79c6>&#34;operator&#34;</span>:<span style=color:#f1fa8c>&#34;Exists&#34;</span>,<span style=color:#ff79c6>&#34;effect&#34;</span>:<span style=color:#f1fa8c>&#34;NoExecute&#34;</span>,<span style=color:#ff79c6>&#34;tolerationSeconds&#34;</span>:<span style=color:#bd93f9>300</span>},{<span style=color:#ff79c6>&#34;key&#34;</span>:<span style=color:#f1fa8c>&#34;node.kubernetes.io/unreachable&#34;</span>,<span style=color:#ff79c6>&#34;operator&#34;</span>:<span style=color:#f1fa8c>&#34;Exists&#34;</span>,<span style=color:#ff79c6>&#34;effect&#34;</span>:<span style=color:#f1fa8c>&#34;NoExecute&#34;</span>,<span style=color:#ff79c6>&#34;tolerationSeconds&#34;</span>:<span style=color:#bd93f9>300</span>}],<span style=color:#ff79c6>&#34;priority&#34;</span>:<span style=color:#bd93f9>0</span>,<span style=color:#ff79c6>&#34;enableServiceLinks&#34;</span>:<span style=color:#ff79c6>true</span>,<span style=color:#ff79c6>&#34;preemptionPolicy&#34;</span>:<span style=color:#f1fa8c>&#34;PreemptLowerPriority&#34;</span>},<span style=color:#ff79c6>&#34;status&#34;</span>:{<span style=color:#ff79c6>&#34;phase&#34;</span>:<span style=color:#f1fa8c>&#34;Running&#34;</span>,<span style=color:#ff79c6>&#34;conditions&#34;</span>:[{<span style=color:#ff79c6>&#34;type&#34;</span>:<span style=color:#f1fa8c>&#34;Initialized&#34;</span>,<span style=color:#ff79c6>&#34;status&#34;</span>:<span style=color:#f1fa8c>&#34;True&#34;</span>,<span style=color:#ff79c6>&#34;lastProbeTime&#34;</span>:<span style=color:#ff79c6>null</span>,<span style=color:#ff79c6>&#34;lastTransitionTime&#34;</span>:<span style=color:#f1fa8c>&#34;2023-03-09T09:30:14Z&#34;</span>},{<span style=color:#ff79c6>&#34;type&#34;</span>:<span style=color:#f1fa8c>&#34;Ready&#34;</span>,<span style=color:#ff79c6>&#34;status&#34;</span>:<span style=color:#f1fa8c>&#34;False&#34;</span>,<span style=color:#ff79c6>&#34;lastProbeTime&#34;</span>:<span style=color:#ff79c6>null</span>,<span style=color:#ff79c6>&#34;lastTransitionTime&#34;</span>:<span style=color:#f1fa8c>&#34;2023-03-10T15:59:10Z&#34;</span>,<span style=color:#ff79c6>&#34;reason&#34;</span>:<span style=color:#f1fa8c>&#34;ContainersNotReady&#34;</span>,<span style=color:#ff79c6>&#34;message&#34;</span>:<span style=color:#f1fa8c>&#34;containers with unready status: [network-tool]&#34;</span>},{<span style=color:#ff79c6>&#34;type&#34;</span>:<span style=color:#f1fa8c>&#34;ContainersReady&#34;</span>,<span style=color:#ff79c6>&#34;status&#34;</span>:<span style=color:#f1fa8c>&#34;False&#34;</span>,<span style=color:#ff79c6>&#34;lastProbeTime&#34;</span>:<span style=color:#ff79c6>null</span>,<span style=color:#ff79c6>&#34;lastTransitionTime&#34;</span>:<span style=color:#f1fa8c>&#34;2023-03-10T15:59:10Z&#34;</span>,<span style=color:#ff79c6>&#34;reason&#34;</span>:<span style=color:#f1fa8c>&#34;ContainersNotReady&#34;</span>,<span style=color:#ff79c6>&#34;message&#34;</span>:<span style=color:#f1fa8c>&#34;containers with unready status: [network-tool]&#34;</span>},{<span style=color:#ff79c6>&#34;type&#34;</span>:<span style=color:#f1fa8c>&#34;PodScheduled&#34;</span>,<span style=color:#ff79c6>&#34;status&#34;</span>:<span style=color:#f1fa8c>&#34;True&#34;</span>,<span style=color:#ff79c6>&#34;lastProbeTime&#34;</span>:<span style=color:#ff79c6>null</span>,<span style=color:#ff79c6>&#34;lastTransitionTime&#34;</span>:<span style=color:#f1fa8c>&#34;2023-03-09T09:30:14Z&#34;</span>}],<span style=color:#ff79c6>&#34;hostIP&#34;</span>:<span style=color:#f1fa8c>&#34;172.20.0.2&#34;</span>,<span style=color:#ff79c6>&#34;podIP&#34;</span>:<span style=color:#f1fa8c>&#34;10.244.0.8&#34;</span>,<span style=color:#ff79c6>&#34;podIPs&#34;</span>:[{<span style=color:#ff79c6>&#34;ip&#34;</span>:<span style=color:#f1fa8c>&#34;10.244.0.8&#34;</span>}],<span style=color:#ff79c6>&#34;startTime&#34;</span>:<span style=color:#f1fa8c>&#34;2023-03-09T09:30:14Z&#34;</span>,<span style=color:#ff79c6>&#34;containerStatuses&#34;</span>:[{<span style=color:#ff79c6>&#34;name&#34;</span>:<span style=color:#f1fa8c>&#34;network-tool&#34;</span>,<span style=color:#ff79c6>&#34;state&#34;</span>:{<span style=color:#ff79c6>&#34;terminated&#34;</span>:{<span style=color:#ff79c6>&#34;exitCode&#34;</span>:<span style=color:#bd93f9>137</span>,<span style=color:#ff79c6>&#34;reason&#34;</span>:<span style=color:#f1fa8c>&#34;Error&#34;</span>,<span style=color:#ff79c6>&#34;startedAt&#34;</span>:<span style=color:#f1fa8c>&#34;2023-03-10T13:36:56Z&#34;</span>,<span style=color:#ff79c6>&#34;finishedAt&#34;</span>:<span style=color:#f1fa8c>&#34;2023-03-10T15:59:10Z&#34;</span>,<span style=color:#ff79c6>&#34;containerID&#34;</span>:<span style=color:#f1fa8c>&#34;containerd://020d9b471682786883498e220bc48f932973f64fff6c5629559da3dca9d2358e&#34;</span>}},<span style=color:#ff79c6>&#34;lastState&#34;</span>:{<span style=color:#ff79c6>&#34;terminated&#34;</span>:{<span style=color:#ff79c6>&#34;exitCode&#34;</span>:<span style=color:#bd93f9>255</span>,<span style=color:#ff79c6>&#34;reason&#34;</span>:<span style=color:#f1fa8c>&#34;Unknown&#34;</span>,<span style=color:#ff79c6>&#34;startedAt&#34;</span>:<span style=color:#f1fa8c>&#34;2023-03-09T09:30:18Z&#34;</span>,<span style=color:#ff79c6>&#34;finishedAt&#34;</span>:<span style=color:#f1fa8c>&#34;2023-03-10T13:31:39Z&#34;</span>,<span style=color:#ff79c6>&#34;containerID&#34;</span>:<span style=color:#f1fa8c>&#34;containerd://b52804466bbe6ad9d233b8c080b8d33289c247dbcf1be4d2bd9c609099041a96&#34;</span>}},<span style=color:#ff79c6>&#34;ready&#34;</span>:<span style=color:#ff79c6>false</span>,<span style=color:#ff79c6>&#34;restartCount&#34;</span>:<span style=color:#bd93f9>1</span>,<span style=color:#ff79c6>&#34;image&#34;</span>:<span style=color:#f1fa8c>&#34;docker.io/zhaohuabing/network-tool:latest&#34;</span>,<span style=color:#ff79c6>&#34;imageID&#34;</span>:<span style=color:#f1fa8c>&#34;docker.io/zhaohuabing/network-tool@sha256:5843e4f12742f0e34932ba42205f177a62d930eadb419d99fa4881483ea46629&#34;</span>,<span style=color:#ff79c6>&#34;containerID&#34;</span>:<span style=color:#f1fa8c>&#34;containerd://020d9b471682786883498e220bc48f932973f64fff6c5629559da3dca9d2358e&#34;</span>,<span style=color:#ff79c6>&#34;started&#34;</span>:<span style=color:#ff79c6>false</span>}],<span style=color:#ff79c6>&#34;qosClass&#34;</span>:<span style=color:#f1fa8c>&#34;BestEffort&#34;</span>}}}
</span></span><span style=display:flex><span>{<span style=color:#ff79c6>&#34;type&#34;</span>:<span style=color:#f1fa8c>&#34;DELETED&#34;</span>,<span style=color:#ff79c6>&#34;object&#34;</span>:{<span style=color:#ff79c6>&#34;kind&#34;</span>:<span style=color:#f1fa8c>&#34;Pod&#34;</span>,<span style=color:#ff79c6>&#34;apiVersion&#34;</span>:<span style=color:#f1fa8c>&#34;v1&#34;</span>,<span style=color:#ff79c6>&#34;metadata&#34;</span>:{<span style=color:#ff79c6>&#34;name&#34;</span>:<span style=color:#f1fa8c>&#34;network-tool&#34;</span>,<span style=color:#ff79c6>&#34;namespace&#34;</span>:<span style=color:#f1fa8c>&#34;default&#34;</span>,<span style=color:#ff79c6>&#34;uid&#34;</span>:<span style=color:#f1fa8c>&#34;548a29a9-9359-4858-8a18-48633d29d394&#34;</span>,<span style=color:#ff79c6>&#34;resourceVersion&#34;</span>:<span style=color:#f1fa8c>&#34;760032&#34;</span>,<span style=color:#ff79c6>&#34;creationTimestamp&#34;</span>:<span style=color:#f1fa8c>&#34;2023-03-09T09:30:14Z&#34;</span>,<span style=color:#ff79c6>&#34;deletionTimestamp&#34;</span>:<span style=color:#f1fa8c>&#34;2023-03-10T15:58:40Z&#34;</span>,<span style=color:#ff79c6>&#34;deletionGracePeriodSeconds&#34;</span>:<span style=color:#bd93f9>0</span>,<span style=color:#ff79c6>&#34;annotations&#34;</span>:{<span style=color:#ff79c6>&#34;kubectl.kubernetes.io/last-applied-configuration&#34;</span>:<span style=color:#f1fa8c>&#34;{\&#34;apiVersion\&#34;:\&#34;v1\&#34;,\&#34;kind\&#34;:\&#34;Pod\&#34;,\&#34;metadata\&#34;:{\&#34;annotations\&#34;:{\&#34;sidecar.istio.io/inject\&#34;:\&#34;false\&#34;},\&#34;name\&#34;:\&#34;network-tool\&#34;,\&#34;namespace\&#34;:\&#34;default\&#34;},\&#34;spec\&#34;:{\&#34;containers\&#34;:[{\&#34;image\&#34;:\&#34;zhaohuabing/network-tool\&#34;,\&#34;name\&#34;:\&#34;network-tool\&#34;,\&#34;securityContext\&#34;:{\&#34;capabilities\&#34;:{\&#34;add\&#34;:[\&#34;NET_ADMIN\&#34;]}}}]}}\n&#34;</span>,<span style=color:#ff79c6>&#34;sidecar.istio.io/inject&#34;</span>:<span style=color:#f1fa8c>&#34;false&#34;</span>},<span style=color:#ff79c6>&#34;managedFields&#34;</span>:[{<span style=color:#ff79c6>&#34;manager&#34;</span>:<span style=color:#f1fa8c>&#34;kubectl-client-side-apply&#34;</span>,<span style=color:#ff79c6>&#34;operation&#34;</span>:<span style=color:#f1fa8c>&#34;Update&#34;</span>,<span style=color:#ff79c6>&#34;apiVersion&#34;</span>:<span style=color:#f1fa8c>&#34;v1&#34;</span>,<span style=color:#ff79c6>&#34;time&#34;</span>:<span style=color:#f1fa8c>&#34;2023-03-09T09:30:14Z&#34;</span>,<span style=color:#ff79c6>&#34;fieldsType&#34;</span>:<span style=color:#f1fa8c>&#34;FieldsV1&#34;</span>,<span style=color:#ff79c6>&#34;fieldsV1&#34;</span>:{<span style=color:#ff79c6>&#34;f:metadata&#34;</span>:{<span style=color:#ff79c6>&#34;f:annotations&#34;</span>:{<span style=color:#ff79c6>&#34;.&#34;</span>:{},<span style=color:#ff79c6>&#34;f:kubectl.kubernetes.io/last-applied-configuration&#34;</span>:{},<span style=color:#ff79c6>&#34;f:sidecar.istio.io/inject&#34;</span>:{}}},<span style=color:#ff79c6>&#34;f:spec&#34;</span>:{<span style=color:#ff79c6>&#34;f:containers&#34;</span>:{<span style=color:#ff79c6>&#34;k:{\&#34;name\&#34;:\&#34;network-tool\&#34;}&#34;</span>:{<span style=color:#ff79c6>&#34;.&#34;</span>:{},<span style=color:#ff79c6>&#34;f:image&#34;</span>:{},<span style=color:#ff79c6>&#34;f:imagePullPolicy&#34;</span>:{},<span style=color:#ff79c6>&#34;f:name&#34;</span>:{},<span style=color:#ff79c6>&#34;f:resources&#34;</span>:{},<span style=color:#ff79c6>&#34;f:securityContext&#34;</span>:{<span style=color:#ff79c6>&#34;.&#34;</span>:{},<span style=color:#ff79c6>&#34;f:capabilities&#34;</span>:{<span style=color:#ff79c6>&#34;.&#34;</span>:{},<span style=color:#ff79c6>&#34;f:add&#34;</span>:{}}},<span style=color:#ff79c6>&#34;f:terminationMessagePath&#34;</span>:{},<span style=color:#ff79c6>&#34;f:terminationMessagePolicy&#34;</span>:{}}},<span style=color:#ff79c6>&#34;f:dnsPolicy&#34;</span>:{},<span style=color:#ff79c6>&#34;f:enableServiceLinks&#34;</span>:{},<span style=color:#ff79c6>&#34;f:restartPolicy&#34;</span>:{},<span style=color:#ff79c6>&#34;f:schedulerName&#34;</span>:{},<span style=color:#ff79c6>&#34;f:securityContext&#34;</span>:{},<span style=color:#ff79c6>&#34;f:terminationGracePeriodSeconds&#34;</span>:{}}}},{<span style=color:#ff79c6>&#34;manager&#34;</span>:<span style=color:#f1fa8c>&#34;kubelet&#34;</span>,<span style=color:#ff79c6>&#34;operation&#34;</span>:<span style=color:#f1fa8c>&#34;Update&#34;</span>,<span style=color:#ff79c6>&#34;apiVersion&#34;</span>:<span style=color:#f1fa8c>&#34;v1&#34;</span>,<span style=color:#ff79c6>&#34;time&#34;</span>:<span style=color:#f1fa8c>&#34;2023-03-10T15:59:10Z&#34;</span>,<span style=color:#ff79c6>&#34;fieldsType&#34;</span>:<span style=color:#f1fa8c>&#34;FieldsV1&#34;</span>,<span style=color:#ff79c6>&#34;fieldsV1&#34;</span>:{<span style=color:#ff79c6>&#34;f:status&#34;</span>:{<span style=color:#ff79c6>&#34;f:conditions&#34;</span>:{<span style=color:#ff79c6>&#34;k:{\&#34;type\&#34;:\&#34;ContainersReady\&#34;}&#34;</span>:{<span style=color:#ff79c6>&#34;.&#34;</span>:{},<span style=color:#ff79c6>&#34;f:lastProbeTime&#34;</span>:{},<span style=color:#ff79c6>&#34;f:lastTransitionTime&#34;</span>:{},<span style=color:#ff79c6>&#34;f:message&#34;</span>:{},<span style=color:#ff79c6>&#34;f:reason&#34;</span>:{},<span style=color:#ff79c6>&#34;f:status&#34;</span>:{},<span style=color:#ff79c6>&#34;f:type&#34;</span>:{}},<span style=color:#ff79c6>&#34;k:{\&#34;type\&#34;:\&#34;Initialized\&#34;}&#34;</span>:{<span style=color:#ff79c6>&#34;.&#34;</span>:{},<span style=color:#ff79c6>&#34;f:lastProbeTime&#34;</span>:{},<span style=color:#ff79c6>&#34;f:lastTransitionTime&#34;</span>:{},<span style=color:#ff79c6>&#34;f:status&#34;</span>:{},<span style=color:#ff79c6>&#34;f:type&#34;</span>:{}},<span style=color:#ff79c6>&#34;k:{\&#34;type\&#34;:\&#34;Ready\&#34;}&#34;</span>:{<span style=color:#ff79c6>&#34;.&#34;</span>:{},<span style=color:#ff79c6>&#34;f:lastProbeTime&#34;</span>:{},<span style=color:#ff79c6>&#34;f:lastTransitionTime&#34;</span>:{},<span style=color:#ff79c6>&#34;f:message&#34;</span>:{},<span style=color:#ff79c6>&#34;f:reason&#34;</span>:{},<span style=color:#ff79c6>&#34;f:status&#34;</span>:{},<span style=color:#ff79c6>&#34;f:type&#34;</span>:{}}},<span style=color:#ff79c6>&#34;f:containerStatuses&#34;</span>:{},<span style=color:#ff79c6>&#34;f:hostIP&#34;</span>:{},<span style=color:#ff79c6>&#34;f:phase&#34;</span>:{},<span style=color:#ff79c6>&#34;f:podIP&#34;</span>:{},<span style=color:#ff79c6>&#34;f:podIPs&#34;</span>:{<span style=color:#ff79c6>&#34;.&#34;</span>:{},<span style=color:#ff79c6>&#34;k:{\&#34;ip\&#34;:\&#34;10.244.0.8\&#34;}&#34;</span>:{<span style=color:#ff79c6>&#34;.&#34;</span>:{},<span style=color:#ff79c6>&#34;f:ip&#34;</span>:{}}},<span style=color:#ff79c6>&#34;f:startTime&#34;</span>:{}}}}]},<span style=color:#ff79c6>&#34;spec&#34;</span>:{<span style=color:#ff79c6>&#34;volumes&#34;</span>:[{<span style=color:#ff79c6>&#34;name&#34;</span>:<span style=color:#f1fa8c>&#34;kube-api-access-cwjmv&#34;</span>,<span style=color:#ff79c6>&#34;projected&#34;</span>:{<span style=color:#ff79c6>&#34;sources&#34;</span>:[{<span style=color:#ff79c6>&#34;serviceAccountToken&#34;</span>:{<span style=color:#ff79c6>&#34;expirationSeconds&#34;</span>:<span style=color:#bd93f9>3607</span>,<span style=color:#ff79c6>&#34;path&#34;</span>:<span style=color:#f1fa8c>&#34;token&#34;</span>}},{<span style=color:#ff79c6>&#34;configMap&#34;</span>:{<span style=color:#ff79c6>&#34;name&#34;</span>:<span style=color:#f1fa8c>&#34;kube-root-ca.crt&#34;</span>,<span style=color:#ff79c6>&#34;items&#34;</span>:[{<span style=color:#ff79c6>&#34;key&#34;</span>:<span style=color:#f1fa8c>&#34;ca.crt&#34;</span>,<span style=color:#ff79c6>&#34;path&#34;</span>:<span style=color:#f1fa8c>&#34;ca.crt&#34;</span>}]}},{<span style=color:#ff79c6>&#34;downwardAPI&#34;</span>:{<span style=color:#ff79c6>&#34;items&#34;</span>:[{<span style=color:#ff79c6>&#34;path&#34;</span>:<span style=color:#f1fa8c>&#34;namespace&#34;</span>,<span style=color:#ff79c6>&#34;fieldRef&#34;</span>:{<span style=color:#ff79c6>&#34;apiVersion&#34;</span>:<span style=color:#f1fa8c>&#34;v1&#34;</span>,<span style=color:#ff79c6>&#34;fieldPath&#34;</span>:<span style=color:#f1fa8c>&#34;metadata.namespace&#34;</span>}}]}}],<span style=color:#ff79c6>&#34;defaultMode&#34;</span>:<span style=color:#bd93f9>420</span>}}],<span style=color:#ff79c6>&#34;containers&#34;</span>:[{<span style=color:#ff79c6>&#34;name&#34;</span>:<span style=color:#f1fa8c>&#34;network-tool&#34;</span>,<span style=color:#ff79c6>&#34;image&#34;</span>:<span style=color:#f1fa8c>&#34;zhaohuabing/network-tool&#34;</span>,<span style=color:#ff79c6>&#34;resources&#34;</span>:{},<span style=color:#ff79c6>&#34;volumeMounts&#34;</span>:[{<span style=color:#ff79c6>&#34;name&#34;</span>:<span style=color:#f1fa8c>&#34;kube-api-access-cwjmv&#34;</span>,<span style=color:#ff79c6>&#34;readOnly&#34;</span>:<span style=color:#ff79c6>true</span>,<span style=color:#ff79c6>&#34;mountPath&#34;</span>:<span style=color:#f1fa8c>&#34;/var/run/secrets/kubernetes.io/serviceaccount&#34;</span>}],<span style=color:#ff79c6>&#34;terminationMessagePath&#34;</span>:<span style=color:#f1fa8c>&#34;/dev/termination-log&#34;</span>,<span style=color:#ff79c6>&#34;terminationMessagePolicy&#34;</span>:<span style=color:#f1fa8c>&#34;File&#34;</span>,<span style=color:#ff79c6>&#34;imagePullPolicy&#34;</span>:<span style=color:#f1fa8c>&#34;Always&#34;</span>,<span style=color:#ff79c6>&#34;securityContext&#34;</span>:{<span style=color:#ff79c6>&#34;capabilities&#34;</span>:{<span style=color:#ff79c6>&#34;add&#34;</span>:[<span style=color:#f1fa8c>&#34;NET_ADMIN&#34;</span>]}}}],<span style=color:#ff79c6>&#34;restartPolicy&#34;</span>:<span style=color:#f1fa8c>&#34;Always&#34;</span>,<span style=color:#ff79c6>&#34;terminationGracePeriodSeconds&#34;</span>:<span style=color:#bd93f9>30</span>,<span style=color:#ff79c6>&#34;dnsPolicy&#34;</span>:<span style=color:#f1fa8c>&#34;ClusterFirst&#34;</span>,<span style=color:#ff79c6>&#34;serviceAccountName&#34;</span>:<span style=color:#f1fa8c>&#34;default&#34;</span>,<span style=color:#ff79c6>&#34;serviceAccount&#34;</span>:<span style=color:#f1fa8c>&#34;default&#34;</span>,<span style=color:#ff79c6>&#34;nodeName&#34;</span>:<span style=color:#f1fa8c>&#34;aeraki-control-plane&#34;</span>,<span style=color:#ff79c6>&#34;securityContext&#34;</span>:{},<span style=color:#ff79c6>&#34;schedulerName&#34;</span>:<span style=color:#f1fa8c>&#34;default-scheduler&#34;</span>,<span style=color:#ff79c6>&#34;tolerations&#34;</span>:[{<span style=color:#ff79c6>&#34;key&#34;</span>:<span style=color:#f1fa8c>&#34;node.kubernetes.io/not-ready&#34;</span>,<span style=color:#ff79c6>&#34;operator&#34;</span>:<span style=color:#f1fa8c>&#34;Exists&#34;</span>,<span style=color:#ff79c6>&#34;effect&#34;</span>:<span style=color:#f1fa8c>&#34;NoExecute&#34;</span>,<span style=color:#ff79c6>&#34;tolerationSeconds&#34;</span>:<span style=color:#bd93f9>300</span>},{<span style=color:#ff79c6>&#34;key&#34;</span>:<span style=color:#f1fa8c>&#34;node.kubernetes.io/unreachable&#34;</span>,<span style=color:#ff79c6>&#34;operator&#34;</span>:<span style=color:#f1fa8c>&#34;Exists&#34;</span>,<span style=color:#ff79c6>&#34;effect&#34;</span>:<span style=color:#f1fa8c>&#34;NoExecute&#34;</span>,<span style=color:#ff79c6>&#34;tolerationSeconds&#34;</span>:<span style=color:#bd93f9>300</span>}],<span style=color:#ff79c6>&#34;priority&#34;</span>:<span style=color:#bd93f9>0</span>,<span style=color:#ff79c6>&#34;enableServiceLinks&#34;</span>:<span style=color:#ff79c6>true</span>,<span style=color:#ff79c6>&#34;preemptionPolicy&#34;</span>:<span style=color:#f1fa8c>&#34;PreemptLowerPriority&#34;</span>},<span style=color:#ff79c6>&#34;status&#34;</span>:{<span style=color:#ff79c6>&#34;phase&#34;</span>:<span style=color:#f1fa8c>&#34;Running&#34;</span>,<span style=color:#ff79c6>&#34;conditions&#34;</span>:[{<span style=color:#ff79c6>&#34;type&#34;</span>:<span style=color:#f1fa8c>&#34;Initialized&#34;</span>,<span style=color:#ff79c6>&#34;status&#34;</span>:<span style=color:#f1fa8c>&#34;True&#34;</span>,<span style=color:#ff79c6>&#34;lastProbeTime&#34;</span>:<span style=color:#ff79c6>null</span>,<span style=color:#ff79c6>&#34;lastTransitionTime&#34;</span>:<span style=color:#f1fa8c>&#34;2023-03-09T09:30:14Z&#34;</span>},{<span style=color:#ff79c6>&#34;type&#34;</span>:<span style=color:#f1fa8c>&#34;Ready&#34;</span>,<span style=color:#ff79c6>&#34;status&#34;</span>:<span style=color:#f1fa8c>&#34;False&#34;</span>,<span style=color:#ff79c6>&#34;lastProbeTime&#34;</span>:<span style=color:#ff79c6>null</span>,<span style=color:#ff79c6>&#34;lastTransitionTime&#34;</span>:<span style=color:#f1fa8c>&#34;2023-03-10T15:59:10Z&#34;</span>,<span style=color:#ff79c6>&#34;reason&#34;</span>:<span style=color:#f1fa8c>&#34;ContainersNotReady&#34;</span>,<span style=color:#ff79c6>&#34;message&#34;</span>:<span style=color:#f1fa8c>&#34;containers with unready status: [network-tool]&#34;</span>},{<span style=color:#ff79c6>&#34;type&#34;</span>:<span style=color:#f1fa8c>&#34;ContainersReady&#34;</span>,<span style=color:#ff79c6>&#34;status&#34;</span>:<span style=color:#f1fa8c>&#34;False&#34;</span>,<span style=color:#ff79c6>&#34;lastProbeTime&#34;</span>:<span style=color:#ff79c6>null</span>,<span style=color:#ff79c6>&#34;lastTransitionTime&#34;</span>:<span style=color:#f1fa8c>&#34;2023-03-10T15:59:10Z&#34;</span>,<span style=color:#ff79c6>&#34;reason&#34;</span>:<span style=color:#f1fa8c>&#34;ContainersNotReady&#34;</span>,<span style=color:#ff79c6>&#34;message&#34;</span>:<span style=color:#f1fa8c>&#34;containers with unready status: [network-tool]&#34;</span>},{<span style=color:#ff79c6>&#34;type&#34;</span>:<span style=color:#f1fa8c>&#34;PodScheduled&#34;</span>,<span style=color:#ff79c6>&#34;status&#34;</span>:<span style=color:#f1fa8c>&#34;True&#34;</span>,<span style=color:#ff79c6>&#34;lastProbeTime&#34;</span>:<span style=color:#ff79c6>null</span>,<span style=color:#ff79c6>&#34;lastTransitionTime&#34;</span>:<span style=color:#f1fa8c>&#34;2023-03-09T09:30:14Z&#34;</span>}],<span style=color:#ff79c6>&#34;hostIP&#34;</span>:<span style=color:#f1fa8c>&#34;172.20.0.2&#34;</span>,<span style=color:#ff79c6>&#34;podIP&#34;</span>:<span style=color:#f1fa8c>&#34;10.244.0.8&#34;</span>,<span style=color:#ff79c6>&#34;podIPs&#34;</span>:[{<span style=color:#ff79c6>&#34;ip&#34;</span>:<span style=color:#f1fa8c>&#34;10.244.0.8&#34;</span>}],<span style=color:#ff79c6>&#34;startTime&#34;</span>:<span style=color:#f1fa8c>&#34;2023-03-09T09:30:14Z&#34;</span>,<span style=color:#ff79c6>&#34;containerStatuses&#34;</span>:[{<span style=color:#ff79c6>&#34;name&#34;</span>:<span style=color:#f1fa8c>&#34;network-tool&#34;</span>,<span style=color:#ff79c6>&#34;state&#34;</span>:{<span style=color:#ff79c6>&#34;terminated&#34;</span>:{<span style=color:#ff79c6>&#34;exitCode&#34;</span>:<span style=color:#bd93f9>137</span>,<span style=color:#ff79c6>&#34;reason&#34;</span>:<span style=color:#f1fa8c>&#34;Error&#34;</span>,<span style=color:#ff79c6>&#34;startedAt&#34;</span>:<span style=color:#f1fa8c>&#34;2023-03-10T13:36:56Z&#34;</span>,<span style=color:#ff79c6>&#34;finishedAt&#34;</span>:<span style=color:#f1fa8c>&#34;2023-03-10T15:59:10Z&#34;</span>,<span style=color:#ff79c6>&#34;containerID&#34;</span>:<span style=color:#f1fa8c>&#34;containerd://020d9b471682786883498e220bc48f932973f64fff6c5629559da3dca9d2358e&#34;</span>}},<span style=color:#ff79c6>&#34;lastState&#34;</span>:{<span style=color:#ff79c6>&#34;terminated&#34;</span>:{<span style=color:#ff79c6>&#34;exitCode&#34;</span>:<span style=color:#bd93f9>255</span>,<span style=color:#ff79c6>&#34;reason&#34;</span>:<span style=color:#f1fa8c>&#34;Unknown&#34;</span>,<span style=color:#ff79c6>&#34;startedAt&#34;</span>:<span style=color:#f1fa8c>&#34;2023-03-09T09:30:18Z&#34;</span>,<span style=color:#ff79c6>&#34;finishedAt&#34;</span>:<span style=color:#f1fa8c>&#34;2023-03-10T13:31:39Z&#34;</span>,<span style=color:#ff79c6>&#34;containerID&#34;</span>:<span style=color:#f1fa8c>&#34;containerd://b52804466bbe6ad9d233b8c080b8d33289c247dbcf1be4d2bd9c609099041a96&#34;</span>}},<span style=color:#ff79c6>&#34;ready&#34;</span>:<span style=color:#ff79c6>false</span>,<span style=color:#ff79c6>&#34;restartCount&#34;</span>:<span style=color:#bd93f9>1</span>,<span style=color:#ff79c6>&#34;image&#34;</span>:<span style=color:#f1fa8c>&#34;docker.io/zhaohuabing/network-tool:latest&#34;</span>,<span style=color:#ff79c6>&#34;imageID&#34;</span>:<span style=color:#f1fa8c>&#34;docker.io/zhaohuabing/network-tool@sha256:5843e4f12742f0e34932ba42205f177a62d930eadb419d99fa4881483ea46629&#34;</span>,<span style=color:#ff79c6>&#34;containerID&#34;</span>:<span style=color:#f1fa8c>&#34;containerd://020d9b471682786883498e220bc48f932973f64fff6c5629559da3dca9d2358e&#34;</span>,<span style=color:#ff79c6>&#34;started&#34;</span>:<span style=color:#ff79c6>false</span>}],<span style=color:#ff79c6>&#34;qosClass&#34;</span>:<span style=color:#f1fa8c>&#34;BestEffort&#34;</span>}}}
</span></span></code></pre></div><p>从上面 HTTP Watch 返回的 Response 中，可以看到有三种类型的事件：ADDED，MODIFIED 和 DELETED。ADDED 表示创建了新的 Pod，Pod 的状态变化会产生 MODIFIED 类型的事件，DELETED 则表示 Pod 被删除。</p><p>利用 K8s 的 HTTP API，我们可以编写一个最简化版本的 “Controller”。例如下面的程序，该程序的实现逻辑和前面的 curl 请求是相同的，也是通过 HTTP GET 请求来 watch pod 资源。这个 “Controller” 只是用于展示 HTTP API 的 Watch 机制，其中并没有调谐的业务逻辑，只是将 HTTP Response 中收到的事件打印出来。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#ff79c6>package</span> main
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>import</span> (
</span></span><span style=display:flex><span>	<span style=color:#f1fa8c>&#34;crypto/tls&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#f1fa8c>&#34;encoding/json&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#f1fa8c>&#34;fmt&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#f1fa8c>&#34;net/http&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#f1fa8c>&#34;time&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>const</span> token = <span style=color:#f1fa8c>&#34;eyJhbGciOiJSUzI1NiIsImtpZCI6ImFRM2J0Z3NmUk1hR2VhV2VRbE5vbkVHbGRSMUIwdEdTU3ZPb21TSXEtMkUifQ.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJkZWZhdWx0Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9zZWNyZXQubmFtZSI6ImFwaS1leHBsb3Jlci10b2tlbi02enMycSIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VydmljZS1hY2NvdW50Lm5hbWUiOiJhcGktZXhwbG9yZXIiLCJrdWJlcm5ldGVzLmlvL3NlcnZpY2VhY2NvdW50L3NlcnZpY2UtYWNjb3VudC51aWQiOiJmNzMwNDZhYS1jYTcyLTQ0ZjAtODMzNy0zYzk4NWY1NjJkNmYiLCJzdWIiOiJzeXN0ZW06c2VydmljZWFjY291bnQ6ZGVmYXVsdDphcGktZXhwbG9yZXIifQ.ZK6O4ss4qn2qwvw315jjnyvva8EnUszfXDH6vpxa-R5nxbD3t1pDN5us0AYZEkLfTPgDYc9DsKFUmkWCum7AIpAqB79bM8p7NNNDiU5V-DphwT9BAAJqSG2UKhzHtxyY4rzwdKs5n2gVIWGYytmgUYffbkltAMWMJcT7sVUQRMDS3m4we_GS8MDl1mNLzghmPqfcBQKRKJNS0JCjLpdexYZaqw79e4HSa_sMh02P_azWiJWxhDvT-VZPJELmkiwpV6named87SMijBd6EIIu3IOFAa7mqCKzNtp8AJQSc-Ey53AkQlH_7BGRuyfNqx16lhE3ioBbk0NVQkKwVwONkw&#34;</span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>const</span> apiServer = <span style=color:#f1fa8c>&#34;https://127.0.0.1:55429&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>type</span> Pod <span style=color:#8be9fd;font-style:italic>struct</span> {
</span></span><span style=display:flex><span>	Metadata <span style=color:#8be9fd;font-style:italic>struct</span> {
</span></span><span style=display:flex><span>		Name              <span style=color:#8be9fd>string</span>    <span style=color:#f1fa8c>`json:&#34;name&#34;`</span>
</span></span><span style=display:flex><span>		Namespace         <span style=color:#8be9fd>string</span>    <span style=color:#f1fa8c>`json:&#34;namespace&#34;`</span>
</span></span><span style=display:flex><span>		CreationTimestamp time.Time <span style=color:#f1fa8c>`json:&#34;creationTimestamp&#34;`</span>
</span></span><span style=display:flex><span>	} <span style=color:#f1fa8c>`json:&#34;metadata&#34;`</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>type</span> Event <span style=color:#8be9fd;font-style:italic>struct</span> {
</span></span><span style=display:flex><span>	EventType <span style=color:#8be9fd>string</span> <span style=color:#f1fa8c>`json:&#34;type&#34;`</span>
</span></span><span style=display:flex><span>	Object    Pod    <span style=color:#f1fa8c>`json:&#34;object&#34;`</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>func</span> <span style=color:#50fa7b>main</span>() {
</span></span><span style=display:flex><span>	<span style=color:#6272a4>// create an HTTP client with authorization token or certificate
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>	client <span style=color:#ff79c6>:=</span> <span style=color:#ff79c6>&amp;</span>http.Client{
</span></span><span style=display:flex><span>		Transport: <span style=color:#ff79c6>&amp;</span>http.Transport{
</span></span><span style=display:flex><span>			TLSClientConfig: <span style=color:#ff79c6>&amp;</span>tls.Config{
</span></span><span style=display:flex><span>				InsecureSkipVerify: <span style=color:#ff79c6>true</span>, <span style=color:#6272a4>// only use this for testing purposes
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>			},
</span></span><span style=display:flex><span>		},
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	req, err <span style=color:#ff79c6>:=</span> http.<span style=color:#50fa7b>NewRequest</span>(<span style=color:#f1fa8c>&#34;GET&#34;</span>, apiServer<span style=color:#ff79c6>+</span><span style=color:#f1fa8c>&#34;/api/v1/namespaces/default/pods?watch=true&#34;</span>,
</span></span><span style=display:flex><span>		<span style=color:#ff79c6>nil</span>)
</span></span><span style=display:flex><span>	<span style=color:#ff79c6>if</span> err <span style=color:#ff79c6>!=</span> <span style=color:#ff79c6>nil</span> {
</span></span><span style=display:flex><span>		<span style=color:#8be9fd;font-style:italic>panic</span>(err)
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	req.Header.<span style=color:#50fa7b>Set</span>(<span style=color:#f1fa8c>&#34;Authorization&#34;</span>, <span style=color:#f1fa8c>&#34;Bearer &#34;</span><span style=color:#ff79c6>+</span>token)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#6272a4>// send the initial request to list all pods
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>	resp, err <span style=color:#ff79c6>:=</span> client.<span style=color:#50fa7b>Do</span>(req)
</span></span><span style=display:flex><span>	<span style=color:#ff79c6>if</span> err <span style=color:#ff79c6>!=</span> <span style=color:#ff79c6>nil</span> {
</span></span><span style=display:flex><span>		<span style=color:#8be9fd;font-style:italic>panic</span>(err)
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#ff79c6>defer</span> resp.Body.<span style=color:#50fa7b>Close</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#8be9fd;font-style:italic>var</span> event Event
</span></span><span style=display:flex><span>	decoder <span style=color:#ff79c6>:=</span> json.<span style=color:#50fa7b>NewDecoder</span>(resp.Body)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#6272a4>// read the response and parse event
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>	<span style=color:#ff79c6>for</span> {
</span></span><span style=display:flex><span>		<span style=color:#ff79c6>if</span> err <span style=color:#ff79c6>:=</span> decoder.<span style=color:#50fa7b>Decode</span>(<span style=color:#ff79c6>&amp;</span>event); err <span style=color:#ff79c6>!=</span> <span style=color:#ff79c6>nil</span> {
</span></span><span style=display:flex><span>			<span style=color:#8be9fd;font-style:italic>panic</span>(err)
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>		fmt.<span style=color:#50fa7b>Printf</span>(<span style=color:#f1fa8c>&#34;%s Pod %s \n&#34;</span>, event.EventType, event.Object.Metadata.Name)
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>为了方便开发者使用，k8s 提供了对封装了 HTTP watch 机制的 go client。如果使用 k8s go client，几十行代码就可以实现一个简单的 Controller，如下所示：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#6272a4>// Example Kubernetes controller using Go and the Kubernetes API client libraries
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>package</span> main
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>import</span> (
</span></span><span style=display:flex><span>	<span style=color:#f1fa8c>&#34;context&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#f1fa8c>&#34;fmt&#34;</span>
</span></span><span style=display:flex><span>	corev1 <span style=color:#f1fa8c>&#34;k8s.io/api/core/v1&#34;</span>
</span></span><span style=display:flex><span>	metav1 <span style=color:#f1fa8c>&#34;k8s.io/apimachinery/pkg/apis/meta/v1&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#f1fa8c>&#34;k8s.io/apimachinery/pkg/watch&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#f1fa8c>&#34;k8s.io/client-go/kubernetes&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#f1fa8c>&#34;k8s.io/client-go/rest&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>func</span> <span style=color:#50fa7b>main</span>() {
</span></span><span style=display:flex><span>	<span style=color:#6272a4>// create a Kubernetes API client
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>	config, err <span style=color:#ff79c6>:=</span> rest.<span style=color:#50fa7b>InClusterConfig</span>()
</span></span><span style=display:flex><span>	<span style=color:#ff79c6>if</span> err <span style=color:#ff79c6>!=</span> <span style=color:#ff79c6>nil</span> {
</span></span><span style=display:flex><span>		<span style=color:#8be9fd;font-style:italic>panic</span>(err.<span style=color:#50fa7b>Error</span>())
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	clientset, err <span style=color:#ff79c6>:=</span> kubernetes.<span style=color:#50fa7b>NewForConfig</span>(config)
</span></span><span style=display:flex><span>	<span style=color:#ff79c6>if</span> err <span style=color:#ff79c6>!=</span> <span style=color:#ff79c6>nil</span> {
</span></span><span style=display:flex><span>		<span style=color:#8be9fd;font-style:italic>panic</span>(err.<span style=color:#50fa7b>Error</span>())
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#6272a4>// watch for changes to pods
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>	watcher, err <span style=color:#ff79c6>:=</span> clientset.<span style=color:#50fa7b>CoreV1</span>().<span style=color:#50fa7b>Pods</span>(<span style=color:#f1fa8c>&#34;&#34;</span>).<span style=color:#50fa7b>Watch</span>(context.<span style=color:#50fa7b>Background</span>(), metav1.ListOptions{})
</span></span><span style=display:flex><span>	<span style=color:#ff79c6>if</span> err <span style=color:#ff79c6>!=</span> <span style=color:#ff79c6>nil</span> {
</span></span><span style=display:flex><span>		<span style=color:#8be9fd;font-style:italic>panic</span>(err.<span style=color:#50fa7b>Error</span>())
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#6272a4>// loop through events from the watcher
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>	<span style=color:#ff79c6>for</span> event <span style=color:#ff79c6>:=</span> <span style=color:#ff79c6>range</span> watcher.<span style=color:#50fa7b>ResultChan</span>() {
</span></span><span style=display:flex><span>		pod <span style=color:#ff79c6>:=</span> event.Object.(<span style=color:#ff79c6>*</span>corev1.Pod)
</span></span><span style=display:flex><span>		<span style=color:#ff79c6>switch</span> event.Type {
</span></span><span style=display:flex><span>		<span style=color:#ff79c6>case</span> watch.Added:
</span></span><span style=display:flex><span>			fmt.<span style=color:#50fa7b>Printf</span>(<span style=color:#f1fa8c>&#34;Pod %s added\n&#34;</span>, pod.Name)
</span></span><span style=display:flex><span>			<span style=color:#6272a4>// todo: reconcile logic goes here
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>		<span style=color:#ff79c6>case</span> watch.Modified:
</span></span><span style=display:flex><span>			fmt.<span style=color:#50fa7b>Printf</span>(<span style=color:#f1fa8c>&#34;Pod %s modified\n&#34;</span>, pod.Name)
</span></span><span style=display:flex><span>			<span style=color:#6272a4>// todo: reconcile logic goes here
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>		<span style=color:#ff79c6>case</span> watch.Deleted:
</span></span><span style=display:flex><span>			fmt.<span style=color:#50fa7b>Printf</span>(<span style=color:#f1fa8c>&#34;Pod %s deleted\n&#34;</span>, pod.Name)
</span></span><span style=display:flex><span>			<span style=color:#6272a4>// todo: reconcile logic goes here
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>		}
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h1 id=informer-机制>Informer 机制</h1><p>采用 k8s HTTP API 可以查询 K8s API 资源对象并 Watch 其变化，但大量的 HTTP 调用会对 API Server 造成较大的负荷，而且网络调用可能存在较大的延迟。除此之外，开发者还需要在程序中处理资源的缓存，HTTP 链接出问题后的重连等。为了解决这些问题并简化 Controller 的开发工作，K8s 在 client go 中提供了一个 informer 客户端库。</p><p>在 Kubernetes 中，Informer 是一个客户端库，用于监视 Kubernetes API 服务器中的资源并将它们的当前状态缓存到本地。Informer 提供了一种方法，让客户端应用程序可以高效地监视资源的更改，而无需不断地向 API 服务器发出请求。</p><p>相比直接采用 HTTP Watch，使用 Kubernetes Informer 有以下优势：</p><ul><li><p>减少 API 服务器的负载：通过在本地缓存资源信息，Informer 减少了需要向 API 服务器发出的请求数量。这可以防止由于 API 服务器过载而影响整个集群的性能。</p></li><li><p>提高应用程序性能：使用缓存的数据，客户端应用程序可以快速访问资源信息，而无需等待 API 服务器响应。这可以提高应用程序性能并减少延迟。</p></li><li><p>简化代码：Informer 提供了一种更简单、更流畅的方式来监视 Kubernetes 中的资源更改。客户端应用程序可以使用现有的 Informer 库来处理这些任务，而无需编写复杂的代码来管理与 API 服务器的连接并处理更新。</p></li><li><p>更高的可靠性：由于 Informer 在本地缓存数据，因此即使 API 服务器不可用或存在问题，它们也可以继续工作。这可以确保客户端应用程序即使在底层 Kubernetes 基础结构出现问题时也能保持功能。</p></li></ul><p>采用 Informer 库编写的 Controller 的架构如下图所示：</p><p><img src=https://zhaohuabing.com/static/img/2023-03-09-how-to-create-a-k8s-controller/client-go-controller-interaction.jpeg alt></p><p>图中间的虚线将图分为上下两部分，其中上半部分是 Informer 库中的组件，下半部分则是使用 Informer 库编写的自定义 Controller 中的组件，这两部分一起组成了一个完整的 Controller。</p><p>采用 Informer 机制编写的 Controller 中的主要流程如下：</p><ol><li><p>Reflector 采用 K8s HTTP API List/Watch API Server 中指定的资源。</p><p>Reflector 会先 List 资源，然后使用 List 接口返回的 resourceVersion 来 watch 后续的资源变化。对应的源码：<a href=https://github.com/kubernetes/client-go/blob/6df09021f998a3b005b8612d21c254b1b4d3d48b/tools/cache/reflector.go#L322>Reflector ListAndWatch</a>。</p></li><li><p>Reflector 将 List 得到的资源列表和后续的资源变化放到一个 FIFO（先进先出）队列中。</p><p>对应的源码：</p><ul><li><a href=https://github.com/kubernetes/client-go/blob/6df09021f998a3b005b8612d21c254b1b4d3d48b/tools/cache/reflector.go#L563>使用 List 的结果刷新 FIFO 队列</a></li><li><a href=https://github.com/kubernetes/client-go/blob/6df09021f998a3b005b8612d21c254b1b4d3d48b/tools/cache/reflector.go#L742>将 Watch 收到的事件加入到 FIFO 队列</a></li></ul></li><li><p>Informer 在一个循环中从 FIFO 队列中拿出资源对象进行处理。对应源码：<a href=https://github.com/kubernetes/client-go/blob/012954e4d5d6e5d0923a00a5a49f76a8a3f11438/tools/cache/controller.go#L192>processLoop</a>。</p></li><li><p>Informer 将从 FIFO 队列中拿出的资源对象放到 Indexer 中。对应的源码：<a href=https://github.com/kubernetes/client-go/blob/012954e4d5d6e5d0923a00a5a49f76a8a3f11438/tools/cache/controller.go#L473>processDeltas</a>。</p><p>Indexer 是 Informer 中的一个本地缓存，该缓存提供了索引功能（这是该组件取名为 Indexer 的原因），允许基于特定条件（如标签、注释或字段选择器）快速有效地查找资源。此处代码中的 clientState 就是 Indexer，来自于<a href=https://github.com/kubernetes/client-go/blob/012954e4d5d6e5d0923a00a5a49f76a8a3f11438/tools/cache/controller.go#L392>NewIndexerInformer</a>方法中构建的 Indexer，该 Indexer 作为 clientState 参数传递给了 newInformer 方法。</p></li><li><p>Indexer 将收到的资源对象放入其内部的缓存 <a href=https://github.com/kubernetes/client-go/blob/012954e4d5d6e5d0923a00a5a49f76a8a3f11438/tools/cache/thread_safe_store.go#L41>ThreadSafeStore</a> 中。</p></li><li><p>回调 Controller 的 ResourceEventHandler，将资源对象变化通知到应用逻辑。对应的源码：<a href=https://github.com/kubernetes/client-go/blob/012954e4d5d6e5d0923a00a5a49f76a8a3f11438/tools/cache/controller.go#L476>processDeltas</a>。</p></li><li><p>在 ResourceEventHandler 对资源对象的变化进行处理。</p><p>ResourceEventHandler 处于用户的 Controller 代码中，k8s 推荐的编程范式是将收到的消息放入到一个队列中，然后在一个循环中处理该队列中的消息，执行调谐逻辑。推荐该模式的原因是采用队列可以解耦消息生产者（Informer）和消费者（Controller 调谐逻辑），避免消费者阻塞生产者。在用户代码中需要注意几点：</p><ul><li>前面我们已经讲到，Reflector 会使用 List 的结果刷新 FIFO 队列，因此 ResourceEventHandler 收到的资源变化消息其实包含了 Informer 启动时获取的完整资源列表，Informer 会采用 ADDED 事件将列表的资源通知到用户 Controller。该机制屏蔽了 List 和 Watch 的细节，保证用户的 ResourceEventHandler 代码中会接收到 Controller 监控的资源的完整数据，包括启动 Controller 前已有的资源数据，以及之后的资源变化。</li><li>ResourceEventHandler 中收到的消息中只有资源对象的 key，用户在 Controller 中可以使用该 key 为关键字，通过 Indexer 查询本地缓存中的完整资源对象。</li></ul></li></ol><p>下面是采用 Informer 机制来创建 Controller 的例子。该示例代码来自于 <a href=https://github.com/kubernetes/client-go/blob/master/examples/workqueue/main.go>Kubernetes Client Go Repository</a>，为方便阅读去掉了部分非关键代码。</p><p>该示例 Controller 监控了 default namespace 中的 Pod 资源，在 syncToStdout 方法中打印了 pod 名称。可以看到该 Controller 的代码结构和上图是一致的。除此之外，我们在编码时需要注意下面几点：</p><ul><li>在启动 Controller 时需要调用 <code>informer.Run(stopCh)</code> 方法（参见 107 行）。该方法会调用 Reflector 的 <a href=https://github.com/kubernetes/client-go/blob/6df09021f998a3b005b8612d21c254b1b4d3d48b/tools/cache/reflector.go#L322>ListAndWatch</a> 方法。ListAndWatch 首先采用 HTTP List API 从 K8s API Server 获取当前的资源列表，然后调用 HTTP Watch API 对资源变化进行监控，并把 List 和 Watch 的收到的资源通过 ResourceEventHandlerFuncs 的 AddFunc UpdateFunc DeleteFunc 三个回调接口分发给 Controller。</li><li>在开始对队列中的资源事件进行处理之前，先调用 <code>cache.WaitForCacheSync(stopCh, c.informer.HasSynced)</code> （参见 110 行）。正如其方法名所示，该方法确保 Informer 的本地缓存已经和 K8s API Server 的资源数据进行了同步。当 Reflector 成功调用 ListAndWatch 方法从 K8s API Server 获取到需要监控的资源数据并保存到本地缓存后，会将 <code>c.informer.HasSynced</code> 设置为 true。在开始业务处理前调用该方法可以确保在本地缓存中的资源数据是和 K8s API Server 中的数据一致的。</li><li>在对事件进行处理之后，需要调用 <code>queue.Done(key)</code> 方法将事件从队列中删除，以避免重复处理。</li><li>如果处理时发生异常，可以通过 <code>c.queue.AddRateLimited(key)</code> 将出错事件的 key 重新加入到队列中。该方法会对重新加入队列的错误消息进行限流，缺省的限流规则是 10 qps。这意味着当 1 秒内出错的消息大于 10 条时，10 条后的错误消息就会在等待一段时间后才会被重新加入到队列中（参见 74 行的 handleErr 方法）。</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  1</span><span><span style=color:#ff79c6>package</span> main
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  2</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  3</span><span><span style=color:#ff79c6>import</span> (
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  4</span><span>	<span style=color:#f1fa8c>&#34;flag&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  5</span><span>	<span style=color:#f1fa8c>&#34;fmt&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  6</span><span>	<span style=color:#f1fa8c>&#34;time&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  7</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  8</span><span>	<span style=color:#f1fa8c>&#34;k8s.io/klog/v2&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  9</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 10</span><span>	v1 <span style=color:#f1fa8c>&#34;k8s.io/api/core/v1&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 11</span><span>	<span style=color:#f1fa8c>&#34;k8s.io/apimachinery/pkg/fields&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 12</span><span>	<span style=color:#f1fa8c>&#34;k8s.io/apimachinery/pkg/util/runtime&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 13</span><span>	<span style=color:#f1fa8c>&#34;k8s.io/apimachinery/pkg/util/wait&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 14</span><span>	<span style=color:#f1fa8c>&#34;k8s.io/client-go/kubernetes&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 15</span><span>	<span style=color:#f1fa8c>&#34;k8s.io/client-go/tools/cache&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 16</span><span>	<span style=color:#f1fa8c>&#34;k8s.io/client-go/tools/clientcmd&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 17</span><span>	<span style=color:#f1fa8c>&#34;k8s.io/client-go/util/workqueue&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 18</span><span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 19</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 20</span><span><span style=color:#6272a4>// Controller demonstrates how to implement a controller with client-go.
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 21</span><span><span style=color:#6272a4></span><span style=color:#8be9fd;font-style:italic>type</span> Controller <span style=color:#8be9fd;font-style:italic>struct</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 22</span><span>	indexer  cache.Indexer
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 23</span><span>	queue    workqueue.RateLimitingInterface
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 24</span><span>	informer cache.Controller
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 25</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 26</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 27</span><span><span style=color:#6272a4>// NewController creates a new Controller.
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 28</span><span><span style=color:#6272a4></span><span style=color:#8be9fd;font-style:italic>func</span> <span style=color:#50fa7b>NewController</span>(queue workqueue.RateLimitingInterface, indexer cache.Indexer, informer cache.Controller) <span style=color:#ff79c6>*</span>Controller {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 29</span><span>	<span style=color:#ff79c6>return</span> <span style=color:#ff79c6>&amp;</span>Controller{
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 30</span><span>		informer: informer,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 31</span><span>		indexer:  indexer,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 32</span><span>		queue:    queue,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 33</span><span>	}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 34</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 35</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 36</span><span><span style=color:#8be9fd;font-style:italic>func</span> (c <span style=color:#ff79c6>*</span>Controller) <span style=color:#50fa7b>processNextItem</span>() <span style=color:#8be9fd>bool</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 37</span><span>	<span style=color:#6272a4>// Wait until there is a new item in the working queue
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 38</span><span><span style=color:#6272a4></span>	key, quit <span style=color:#ff79c6>:=</span> c.queue.<span style=color:#50fa7b>Get</span>()
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 39</span><span>	<span style=color:#ff79c6>if</span> quit {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 40</span><span>		<span style=color:#ff79c6>return</span> <span style=color:#ff79c6>false</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 41</span><span>	}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 42</span><span>	<span style=color:#6272a4>// Tell the queue that we are done with processing this key. 
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 43</span><span><span style=color:#6272a4></span>	<span style=color:#ff79c6>defer</span> c.queue.<span style=color:#50fa7b>Done</span>(key)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 44</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 45</span><span>	<span style=color:#6272a4>// Invoke the method containing the business logic
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 46</span><span><span style=color:#6272a4></span>	err <span style=color:#ff79c6>:=</span> c.<span style=color:#50fa7b>syncToStdout</span>(key.(<span style=color:#8be9fd>string</span>))
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 47</span><span>	<span style=color:#6272a4>// Handle the error if something went wrong during the execution of the business logic
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 48</span><span><span style=color:#6272a4></span>	c.<span style=color:#50fa7b>handleErr</span>(err, key)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 49</span><span>	<span style=color:#ff79c6>return</span> <span style=color:#ff79c6>true</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 50</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 51</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 52</span><span><span style=color:#6272a4>// syncToStdout is the business logic of the controller. In this controller it simply prints
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 53</span><span><span style=color:#6272a4>// information about the pod to stdout. In case an error happened, it has to simply return the error.
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 54</span><span><span style=color:#6272a4>// The retry logic should not be part of the business logic.
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 55</span><span><span style=color:#6272a4></span><span style=color:#8be9fd;font-style:italic>func</span> (c <span style=color:#ff79c6>*</span>Controller) <span style=color:#50fa7b>syncToStdout</span>(key <span style=color:#8be9fd>string</span>) <span style=color:#8be9fd>error</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 56</span><span>	obj, exists, err <span style=color:#ff79c6>:=</span> c.indexer.<span style=color:#50fa7b>GetByKey</span>(key)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 57</span><span>	<span style=color:#ff79c6>if</span> err <span style=color:#ff79c6>!=</span> <span style=color:#ff79c6>nil</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 58</span><span>		klog.<span style=color:#50fa7b>Errorf</span>(<span style=color:#f1fa8c>&#34;Fetching object with key %s from store failed with %v&#34;</span>, key, err)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 59</span><span>		<span style=color:#ff79c6>return</span> err
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 60</span><span>	}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 61</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 62</span><span>	<span style=color:#ff79c6>if</span> !exists {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 63</span><span>		<span style=color:#6272a4>// Below we will warm up our cache with a Pod, so that we will see a delete for one pod
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 64</span><span><span style=color:#6272a4></span>		fmt.<span style=color:#50fa7b>Printf</span>(<span style=color:#f1fa8c>&#34;Pod %s does not exist anymore\n&#34;</span>, key)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 65</span><span>	} <span style=color:#ff79c6>else</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 66</span><span>		<span style=color:#6272a4>// Note that you also have to check the uid if you have a local controlled resource, which
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 67</span><span><span style=color:#6272a4></span>		<span style=color:#6272a4>// is dependent on the actual instance, to detect that a Pod was recreated with the same name
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 68</span><span><span style=color:#6272a4></span>		fmt.<span style=color:#50fa7b>Printf</span>(<span style=color:#f1fa8c>&#34;Sync/Add/Update for Pod %s\n&#34;</span>, obj.(<span style=color:#ff79c6>*</span>v1.Pod).<span style=color:#50fa7b>GetName</span>())
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 69</span><span>	}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 70</span><span>	<span style=color:#ff79c6>return</span> <span style=color:#ff79c6>nil</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 71</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 72</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 73</span><span><span style=color:#6272a4>// handleErr checks if an error happened and makes sure we will retry later.
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 74</span><span><span style=color:#6272a4></span><span style=color:#8be9fd;font-style:italic>func</span> (c <span style=color:#ff79c6>*</span>Controller) <span style=color:#50fa7b>handleErr</span>(err <span style=color:#8be9fd>error</span>, key <span style=color:#8be9fd;font-style:italic>interface</span>{}) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 75</span><span>	<span style=color:#ff79c6>if</span> err <span style=color:#ff79c6>==</span> <span style=color:#ff79c6>nil</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 76</span><span>		<span style=color:#6272a4>// Forget about the #AddRateLimited history of the key on every successful synchronization.
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 77</span><span><span style=color:#6272a4></span>		<span style=color:#6272a4>// This ensures that future processing of updates for this key is not delayed because of
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 78</span><span><span style=color:#6272a4></span>		<span style=color:#6272a4>// an outdated error history.
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 79</span><span><span style=color:#6272a4></span>		c.queue.<span style=color:#50fa7b>Forget</span>(key)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 80</span><span>		<span style=color:#ff79c6>return</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 81</span><span>	}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 82</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 83</span><span>	<span style=color:#6272a4>// This controller retries 5 times if something goes wrong. After that, it stops trying.
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 84</span><span><span style=color:#6272a4></span>	<span style=color:#ff79c6>if</span> c.queue.<span style=color:#50fa7b>NumRequeues</span>(key) &lt; <span style=color:#bd93f9>5</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 85</span><span>		klog.<span style=color:#50fa7b>Infof</span>(<span style=color:#f1fa8c>&#34;Error syncing pod %v: %v&#34;</span>, key, err)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 86</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 87</span><span>		<span style=color:#6272a4>// Re-enqueue the key rate limited. Based on the rate limiter on the
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 88</span><span><span style=color:#6272a4></span>		<span style=color:#6272a4>// queue and the re-enqueue history, the key will be processed later again.
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 89</span><span><span style=color:#6272a4></span>		c.queue.<span style=color:#50fa7b>AddRateLimited</span>(key)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 90</span><span>		<span style=color:#ff79c6>return</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 91</span><span>	}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 92</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 93</span><span>	c.queue.<span style=color:#50fa7b>Forget</span>(key)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 94</span><span>	<span style=color:#6272a4>// Report to an external entity that, even after several retries, we could not successfully process this key
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 95</span><span><span style=color:#6272a4></span>	runtime.<span style=color:#50fa7b>HandleError</span>(err)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 96</span><span>	klog.<span style=color:#50fa7b>Infof</span>(<span style=color:#f1fa8c>&#34;Dropping pod %q out of the queue: %v&#34;</span>, key, err)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 97</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 98</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 99</span><span><span style=color:#6272a4>// Run begins watching and syncing.
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">100</span><span><span style=color:#6272a4></span><span style=color:#8be9fd;font-style:italic>func</span> (c <span style=color:#ff79c6>*</span>Controller) <span style=color:#50fa7b>Run</span>(workers <span style=color:#8be9fd>int</span>, stopCh <span style=color:#8be9fd;font-style:italic>chan</span> <span style=color:#8be9fd;font-style:italic>struct</span>{}) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">101</span><span>	<span style=color:#ff79c6>defer</span> runtime.<span style=color:#50fa7b>HandleCrash</span>()
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">102</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">103</span><span>	<span style=color:#6272a4>// Let the workers stop when we are done
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">104</span><span><span style=color:#6272a4></span>	<span style=color:#ff79c6>defer</span> c.queue.<span style=color:#50fa7b>ShutDown</span>()
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">105</span><span>	klog.<span style=color:#50fa7b>Info</span>(<span style=color:#f1fa8c>&#34;Starting Pod controller&#34;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">106</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">107</span><span>	<span style=color:#ff79c6>go</span> c.informer.<span style=color:#50fa7b>Run</span>(stopCh)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">108</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">109</span><span>	<span style=color:#6272a4>// Wait for all involved caches to be synced, before processing items from the queue is started
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">110</span><span><span style=color:#6272a4></span>	<span style=color:#ff79c6>if</span> !cache.<span style=color:#50fa7b>WaitForCacheSync</span>(stopCh, c.informer.HasSynced) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">111</span><span>		runtime.<span style=color:#50fa7b>HandleError</span>(fmt.<span style=color:#50fa7b>Errorf</span>(<span style=color:#f1fa8c>&#34;Timed out waiting for caches to sync&#34;</span>))
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">112</span><span>		<span style=color:#ff79c6>return</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">113</span><span>	}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">114</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">115</span><span>	<span style=color:#ff79c6>for</span> i <span style=color:#ff79c6>:=</span> <span style=color:#bd93f9>0</span>; i &lt; workers; i<span style=color:#ff79c6>++</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">116</span><span>		<span style=color:#ff79c6>go</span> wait.<span style=color:#50fa7b>Until</span>(c.runWorker, time.Second, stopCh)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">117</span><span>	}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">118</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">119</span><span>	<span style=color:#ff79c6>&lt;-</span>stopCh
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">120</span><span>	klog.<span style=color:#50fa7b>Info</span>(<span style=color:#f1fa8c>&#34;Stopping Pod controller&#34;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">121</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">122</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">123</span><span><span style=color:#8be9fd;font-style:italic>func</span> (c <span style=color:#ff79c6>*</span>Controller) <span style=color:#50fa7b>runWorker</span>() {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">124</span><span>	<span style=color:#ff79c6>for</span> c.<span style=color:#50fa7b>processNextItem</span>() {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">125</span><span>	}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">126</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">127</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">128</span><span><span style=color:#8be9fd;font-style:italic>func</span> <span style=color:#50fa7b>main</span>() {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">129</span><span>	<span style=color:#8be9fd;font-style:italic>var</span> kubeconfig <span style=color:#8be9fd>string</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">130</span><span>	<span style=color:#8be9fd;font-style:italic>var</span> master <span style=color:#8be9fd>string</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">131</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">132</span><span>	flag.<span style=color:#50fa7b>StringVar</span>(<span style=color:#ff79c6>&amp;</span>kubeconfig, <span style=color:#f1fa8c>&#34;kubeconfig&#34;</span>, <span style=color:#f1fa8c>&#34;&#34;</span>, <span style=color:#f1fa8c>&#34;absolute path to the kubeconfig file&#34;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">133</span><span>	flag.<span style=color:#50fa7b>StringVar</span>(<span style=color:#ff79c6>&amp;</span>master, <span style=color:#f1fa8c>&#34;master&#34;</span>, <span style=color:#f1fa8c>&#34;&#34;</span>, <span style=color:#f1fa8c>&#34;master url&#34;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">134</span><span>	flag.<span style=color:#50fa7b>Parse</span>()
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">135</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">136</span><span>	<span style=color:#6272a4>// creates the connection
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">137</span><span><span style=color:#6272a4></span>	config, err <span style=color:#ff79c6>:=</span> clientcmd.<span style=color:#50fa7b>BuildConfigFromFlags</span>(master, kubeconfig)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">138</span><span>	<span style=color:#ff79c6>if</span> err <span style=color:#ff79c6>!=</span> <span style=color:#ff79c6>nil</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">139</span><span>		klog.<span style=color:#50fa7b>Fatal</span>(err)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">140</span><span>	}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">141</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">142</span><span>	<span style=color:#6272a4>// creates the clientset
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">143</span><span><span style=color:#6272a4></span>	clientset, err <span style=color:#ff79c6>:=</span> kubernetes.<span style=color:#50fa7b>NewForConfig</span>(config)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">144</span><span>	<span style=color:#ff79c6>if</span> err <span style=color:#ff79c6>!=</span> <span style=color:#ff79c6>nil</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">145</span><span>		klog.<span style=color:#50fa7b>Fatal</span>(err)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">146</span><span>	}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">147</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">148</span><span>	<span style=color:#6272a4>// create the pod watcher
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">149</span><span><span style=color:#6272a4></span>	podListWatcher <span style=color:#ff79c6>:=</span> cache.<span style=color:#50fa7b>NewListWatchFromClient</span>(clientset.<span style=color:#50fa7b>CoreV1</span>().<span style=color:#50fa7b>RESTClient</span>(), <span style=color:#f1fa8c>&#34;pods&#34;</span>, v1.NamespaceDefault, fields.<span style=color:#50fa7b>Everything</span>())
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">150</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">151</span><span>	<span style=color:#6272a4>// create the workqueue
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">152</span><span><span style=color:#6272a4></span>	queue <span style=color:#ff79c6>:=</span> workqueue.<span style=color:#50fa7b>NewRateLimitingQueue</span>(workqueue.<span style=color:#50fa7b>DefaultControllerRateLimiter</span>())
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">153</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">154</span><span>	<span style=color:#6272a4>// Bind the workqueue to a cache with the help of an informer. This way we make sure that
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">155</span><span><span style=color:#6272a4></span>	<span style=color:#6272a4>// whenever the cache is updated, the pod key is added to the workqueue.
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">156</span><span><span style=color:#6272a4></span>	<span style=color:#6272a4>// Note that when we finally process the item from the workqueue, we might see a newer version
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">157</span><span><span style=color:#6272a4></span>	<span style=color:#6272a4>// of the Pod than the version which was responsible for triggering the update.
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">158</span><span><span style=color:#6272a4></span>	indexer, informer <span style=color:#ff79c6>:=</span> cache.<span style=color:#50fa7b>NewIndexerInformer</span>(podListWatcher, <span style=color:#ff79c6>&amp;</span>v1.Pod{}, <span style=color:#bd93f9>0</span>, cache.ResourceEventHandlerFuncs{
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">159</span><span>		AddFunc: <span style=color:#8be9fd;font-style:italic>func</span>(obj <span style=color:#8be9fd;font-style:italic>interface</span>{}) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">160</span><span>			key, err <span style=color:#ff79c6>:=</span> cache.<span style=color:#50fa7b>MetaNamespaceKeyFunc</span>(obj)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">161</span><span>			<span style=color:#ff79c6>if</span> err <span style=color:#ff79c6>==</span> <span style=color:#ff79c6>nil</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">162</span><span>				queue.<span style=color:#50fa7b>Add</span>(key)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">163</span><span>			}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">164</span><span>		},
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">165</span><span>		UpdateFunc: <span style=color:#8be9fd;font-style:italic>func</span>(old <span style=color:#8be9fd;font-style:italic>interface</span>{}, new <span style=color:#8be9fd;font-style:italic>interface</span>{}) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">166</span><span>			key, err <span style=color:#ff79c6>:=</span> cache.<span style=color:#50fa7b>MetaNamespaceKeyFunc</span>(new)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">167</span><span>			<span style=color:#ff79c6>if</span> err <span style=color:#ff79c6>==</span> <span style=color:#ff79c6>nil</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">168</span><span>				queue.<span style=color:#50fa7b>Add</span>(key)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">169</span><span>			}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">170</span><span>		},
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">171</span><span>		DeleteFunc: <span style=color:#8be9fd;font-style:italic>func</span>(obj <span style=color:#8be9fd;font-style:italic>interface</span>{}) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">172</span><span>			<span style=color:#6272a4>// IndexerInformer uses a delta queue, therefore for deletes we have to use this
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">173</span><span><span style=color:#6272a4></span>			<span style=color:#6272a4>// key function.
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">174</span><span><span style=color:#6272a4></span>			key, err <span style=color:#ff79c6>:=</span> cache.<span style=color:#50fa7b>DeletionHandlingMetaNamespaceKeyFunc</span>(obj)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">175</span><span>			<span style=color:#ff79c6>if</span> err <span style=color:#ff79c6>==</span> <span style=color:#ff79c6>nil</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">176</span><span>				queue.<span style=color:#50fa7b>Add</span>(key)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">177</span><span>			}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">178</span><span>		},
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">179</span><span>	}, cache.Indexers{})
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">180</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">181</span><span>	controller <span style=color:#ff79c6>:=</span> <span style=color:#50fa7b>NewController</span>(queue, indexer, informer)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">182</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">183</span><span>	<span style=color:#6272a4>// Now let&#39;s start the controller
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">184</span><span><span style=color:#6272a4></span>	stop <span style=color:#ff79c6>:=</span> <span style=color:#8be9fd;font-style:italic>make</span>(<span style=color:#8be9fd;font-style:italic>chan</span> <span style=color:#8be9fd;font-style:italic>struct</span>{})
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">185</span><span>	<span style=color:#ff79c6>defer</span> <span style=color:#8be9fd;font-style:italic>close</span>(stop)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">186</span><span>	<span style=color:#ff79c6>go</span> controller.<span style=color:#50fa7b>Run</span>(<span style=color:#bd93f9>1</span>, stop)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">187</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">188</span><span>	<span style=color:#6272a4>// Wait forever
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">189</span><span><span style=color:#6272a4></span>	<span style=color:#ff79c6>select</span> {}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">190</span><span>}</span></span></code></pre></div><h1 id=sharedinformer>SharedInformer</h1><p>如果在一个应用中有多处相互独立的业务逻辑都需要监控同一种资源对象，用户会编写多个 Informer 来进行处理。这会导致应用中发起对 K8s API Server 同一资源的多次 ListAndWatch 调用，并且每一个 Informer 中都有一份单独的本地缓存，增加了内存占用。</p><p>K8s 在 client go 中基于 Informer 之上再做了一层封装，提供了 SharedInformer 机制。采用 SharedInformer 后，客户端对同一种资源对象只会有一个对 API Server 的 ListAndWatch 调用，多个 Informer 也会共用同一份缓存，减少了对 API Server 的请求，提高了性能。</p><p>SharedInformerFactory 中有一个 Informer Map。当应用代码调用 InformerFactory 获取某一资源类型的 Informer 时， SharedInformer 会判断该类型的 Informer 是否存在，如果不存在就新建一个 Informer 并保存到该 Map 中，如果已存在则直接返回该 Informer（参见 SharedInformerFactory 的 <a href=https://github.com/kubernetes/client-go/blob/471f66fb1055201dc7975d416d5889f8e617a4c0/informers/factory.go#L189>InformerFor</a> 方法）。因此应用中所有从 InformerFactory 中取出的同一类型的 Informer 都是同一个实例。</p><p>下面的代码是使用了 SharedInformer 的 Controller 示例。该示例的代码和上一节使用 Informer 的代码大部分是一样的，主要的差别是采用了 <code>NewSharedInformerFactory</code> 来创建 Informer（参见 158 行）。
我们在使用 SharedInformer 来构建 Controller 时，需要注意下面几点：</p><ul><li>为了能够共用缓存，同一个 SharedInformerFactory 生成的所有 Informer 只能使用相同的查询过滤条件。</li><li>在启动 Controller 前需要调用 <code>informerFactory.Start(stop)</code> 方法（参见 195 行）。该方法会调用 factory 中所有 Informer 的 Run 方法。 Informer 会发起向 k8s API Server 的 ListAndWatch 调用，并开始资源事件的监控和消息分发。</li><li>和直接使用 Informer 相同，在开始对队列中的资源事件进行处理之前，先调用 <code>cache.WaitForCacheSync(stopCh, c.informer.HasSynced)</code> （参见 121 行），以确保在开始业务处理前，Informer 本地缓存中的资源数据已经和 K8s API Server 进行了同步，数据是一致的。</li><li>和直接使用 Informer 相同，在对事件进行处理之后，需要调用 <code>queue.Done(key)</code> 方法将事件从队列中删除，以避免重复处理。</li><li>和直接使用 Informer 相同， 如果处理时发生异常，可以通过 <code>c.queue.AddRateLimited(key)</code> 将出错事件的 key 重新加入到队列中。</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  1</span><span><span style=color:#ff79c6>package</span> main
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  2</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  3</span><span><span style=color:#ff79c6>import</span> (
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  4</span><span>	<span style=color:#f1fa8c>&#34;flag&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  5</span><span>	<span style=color:#f1fa8c>&#34;fmt&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  6</span><span>	<span style=color:#f1fa8c>&#34;k8s.io/apimachinery/pkg/api/errors&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  7</span><span>	<span style=color:#f1fa8c>&#34;k8s.io/client-go/informers&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  8</span><span>	<span style=color:#f1fa8c>&#34;time&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  9</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 10</span><span>	<span style=color:#f1fa8c>&#34;k8s.io/klog/v2&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 11</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 12</span><span>	<span style=color:#f1fa8c>&#34;k8s.io/apimachinery/pkg/util/runtime&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 13</span><span>	utilruntime <span style=color:#f1fa8c>&#34;k8s.io/apimachinery/pkg/util/runtime&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 14</span><span>	<span style=color:#f1fa8c>&#34;k8s.io/apimachinery/pkg/util/wait&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 15</span><span>	<span style=color:#f1fa8c>&#34;k8s.io/client-go/kubernetes&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 16</span><span>	clientv1 <span style=color:#f1fa8c>&#34;k8s.io/client-go/listers/core/v1&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 17</span><span>	<span style=color:#f1fa8c>&#34;k8s.io/client-go/tools/cache&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 18</span><span>	<span style=color:#f1fa8c>&#34;k8s.io/client-go/tools/clientcmd&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 19</span><span>	<span style=color:#f1fa8c>&#34;k8s.io/client-go/util/workqueue&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 20</span><span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 21</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 22</span><span><span style=color:#6272a4>// Controller demonstrates how to implement a controller with client-go.
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 23</span><span><span style=color:#6272a4></span><span style=color:#8be9fd;font-style:italic>type</span> Controller <span style=color:#8be9fd;font-style:italic>struct</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 24</span><span>	lister   clientv1.PodLister
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 25</span><span>	queue    workqueue.RateLimitingInterface
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 26</span><span>	informer cache.Controller
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 27</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 28</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 29</span><span><span style=color:#6272a4>// NewController creates a new Controller.
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 30</span><span><span style=color:#6272a4></span><span style=color:#8be9fd;font-style:italic>func</span> <span style=color:#50fa7b>NewController</span>(queue workqueue.RateLimitingInterface, lister clientv1.PodLister, informer cache.Controller) <span style=color:#ff79c6>*</span>Controller {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 31</span><span>	<span style=color:#ff79c6>return</span> <span style=color:#ff79c6>&amp;</span>Controller{
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 32</span><span>		informer: informer,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 33</span><span>		lister:   lister,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 34</span><span>		queue:    queue,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 35</span><span>	}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 36</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 37</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 38</span><span><span style=color:#8be9fd;font-style:italic>func</span> (c <span style=color:#ff79c6>*</span>Controller) <span style=color:#50fa7b>processNextItem</span>() <span style=color:#8be9fd>bool</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 39</span><span>	<span style=color:#6272a4>// Wait until there is a new item in the working queue
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 40</span><span><span style=color:#6272a4></span>	key, quit <span style=color:#ff79c6>:=</span> c.queue.<span style=color:#50fa7b>Get</span>()
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 41</span><span>	<span style=color:#ff79c6>if</span> quit {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 42</span><span>		<span style=color:#ff79c6>return</span> <span style=color:#ff79c6>false</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 43</span><span>	}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 44</span><span>	<span style=color:#6272a4>// Tell the queue that we are done with processing this key.
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 45</span><span><span style=color:#6272a4></span>	<span style=color:#ff79c6>defer</span> c.queue.<span style=color:#50fa7b>Done</span>(key)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 46</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 47</span><span>	<span style=color:#6272a4>// Invoke the method containing the business logic
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 48</span><span><span style=color:#6272a4></span>	err <span style=color:#ff79c6>:=</span> c.<span style=color:#50fa7b>syncToStdout</span>(key.(<span style=color:#8be9fd>string</span>))
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 49</span><span>	<span style=color:#6272a4>// Handle the error if something went wrong during the execution of the business logic
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 50</span><span><span style=color:#6272a4></span>	c.<span style=color:#50fa7b>handleErr</span>(err, key)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 51</span><span>	<span style=color:#ff79c6>return</span> <span style=color:#ff79c6>true</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 52</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 53</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 54</span><span><span style=color:#6272a4>// syncToStdout is the business logic of the controller. In this controller it simply prints
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 55</span><span><span style=color:#6272a4>// information about the pod to stdout. In case an error happened, it has to simply return the error.
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 56</span><span><span style=color:#6272a4>// The retry logic should not be part of the business logic.
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 57</span><span><span style=color:#6272a4></span><span style=color:#8be9fd;font-style:italic>func</span> (c <span style=color:#ff79c6>*</span>Controller) <span style=color:#50fa7b>syncToStdout</span>(key <span style=color:#8be9fd>string</span>) <span style=color:#8be9fd>error</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 58</span><span>	namespace, name, err <span style=color:#ff79c6>:=</span> cache.<span style=color:#50fa7b>SplitMetaNamespaceKey</span>(key)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 59</span><span>	<span style=color:#ff79c6>if</span> err <span style=color:#ff79c6>!=</span> <span style=color:#ff79c6>nil</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 60</span><span>		utilruntime.<span style=color:#50fa7b>HandleError</span>(fmt.<span style=color:#50fa7b>Errorf</span>(<span style=color:#f1fa8c>&#34;invalid resource key: %s&#34;</span>, key))
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 61</span><span>		<span style=color:#ff79c6>return</span> <span style=color:#ff79c6>nil</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 62</span><span>	}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 63</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 64</span><span>	<span style=color:#6272a4>// Get the Foo resource with this namespace/name
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 65</span><span><span style=color:#6272a4></span>	pod, err <span style=color:#ff79c6>:=</span> c.lister.<span style=color:#50fa7b>Pods</span>(namespace).<span style=color:#50fa7b>Get</span>(name)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 66</span><span>	<span style=color:#ff79c6>if</span> err <span style=color:#ff79c6>!=</span> <span style=color:#ff79c6>nil</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 67</span><span>		<span style=color:#ff79c6>if</span> errors.<span style=color:#50fa7b>IsNotFound</span>(err) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 68</span><span>			utilruntime.<span style=color:#50fa7b>HandleError</span>(fmt.<span style=color:#50fa7b>Errorf</span>(<span style=color:#f1fa8c>&#34;pod &#39;%s&#39; in work queue no longer exists&#34;</span>, key))
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 69</span><span>			<span style=color:#ff79c6>return</span> <span style=color:#ff79c6>nil</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 70</span><span>		}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 71</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 72</span><span>		<span style=color:#ff79c6>return</span> err
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 73</span><span>	}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 74</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 75</span><span>	<span style=color:#6272a4>// Note that you also have to check the uid if you have a local controlled resource, which
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 76</span><span><span style=color:#6272a4></span>	<span style=color:#6272a4>// is dependent on the actual instance, to detect that a Pod was recreated with the same name
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 77</span><span><span style=color:#6272a4></span>	fmt.<span style=color:#50fa7b>Printf</span>(<span style=color:#f1fa8c>&#34;Sync/Add/Update for Pod %s\n&#34;</span>, pod.<span style=color:#50fa7b>GetName</span>())
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 78</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 79</span><span>	<span style=color:#ff79c6>return</span> <span style=color:#ff79c6>nil</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 80</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 81</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 82</span><span><span style=color:#6272a4>// handleErr checks if an error happened and makes sure we will retry later.
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 83</span><span><span style=color:#6272a4></span><span style=color:#8be9fd;font-style:italic>func</span> (c <span style=color:#ff79c6>*</span>Controller) <span style=color:#50fa7b>handleErr</span>(err <span style=color:#8be9fd>error</span>, key <span style=color:#8be9fd;font-style:italic>interface</span>{}) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 84</span><span>	<span style=color:#ff79c6>if</span> err <span style=color:#ff79c6>==</span> <span style=color:#ff79c6>nil</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 85</span><span>		<span style=color:#6272a4>// Forget about the #AddRateLimited history of the key on every successful synchronization.
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 86</span><span><span style=color:#6272a4></span>		<span style=color:#6272a4>// This ensures that future processing of updates for this key is not delayed because of
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 87</span><span><span style=color:#6272a4></span>		<span style=color:#6272a4>// an outdated error history.
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 88</span><span><span style=color:#6272a4></span>		c.queue.<span style=color:#50fa7b>Forget</span>(key)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 89</span><span>		<span style=color:#ff79c6>return</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 90</span><span>	}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 91</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 92</span><span>	<span style=color:#6272a4>// This controller retries 5 times if something goes wrong. After that, it stops trying.
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 93</span><span><span style=color:#6272a4></span>	<span style=color:#ff79c6>if</span> c.queue.<span style=color:#50fa7b>NumRequeues</span>(key) &lt; <span style=color:#bd93f9>5</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 94</span><span>		klog.<span style=color:#50fa7b>Infof</span>(<span style=color:#f1fa8c>&#34;Error syncing pod %v: %v&#34;</span>, key, err)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 95</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 96</span><span>		<span style=color:#6272a4>// Re-enqueue the key rate limited. Based on the rate limiter on the
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 97</span><span><span style=color:#6272a4></span>		<span style=color:#6272a4>// queue and the re-enqueue history, the key will be processed later again.
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 98</span><span><span style=color:#6272a4></span>		c.queue.<span style=color:#50fa7b>AddRateLimited</span>(key)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 99</span><span>		<span style=color:#ff79c6>return</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">100</span><span>	}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">101</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">102</span><span>	c.queue.<span style=color:#50fa7b>Forget</span>(key)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">103</span><span>	<span style=color:#6272a4>// Report to an external entity that, even after several retries, we could not successfully process this key
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">104</span><span><span style=color:#6272a4></span>	runtime.<span style=color:#50fa7b>HandleError</span>(err)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">105</span><span>	klog.<span style=color:#50fa7b>Infof</span>(<span style=color:#f1fa8c>&#34;Dropping pod %q out of the queue: %v&#34;</span>, key, err)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">106</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">107</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">108</span><span><span style=color:#6272a4>// Run begins watching and syncing.
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">109</span><span><span style=color:#6272a4></span><span style=color:#8be9fd;font-style:italic>func</span> (c <span style=color:#ff79c6>*</span>Controller) <span style=color:#50fa7b>Run</span>(workers <span style=color:#8be9fd>int</span>, stopCh <span style=color:#8be9fd;font-style:italic>chan</span> <span style=color:#8be9fd;font-style:italic>struct</span>{}) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">110</span><span>	<span style=color:#ff79c6>defer</span> runtime.<span style=color:#50fa7b>HandleCrash</span>()
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">111</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">112</span><span>	<span style=color:#6272a4>// Let the workers stop when we are done
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">113</span><span><span style=color:#6272a4></span>	<span style=color:#ff79c6>defer</span> c.queue.<span style=color:#50fa7b>ShutDown</span>()
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">114</span><span>	klog.<span style=color:#50fa7b>Info</span>(<span style=color:#f1fa8c>&#34;Starting Pod controller&#34;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">115</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">116</span><span>	<span style=color:#ff79c6>go</span> c.informer.<span style=color:#50fa7b>Run</span>(stopCh)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">117</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">118</span><span>	<span style=color:#6272a4>// Wait for all involved caches to be synced, before processing items from the queue is started
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">119</span><span><span style=color:#6272a4></span>	<span style=color:#ff79c6>if</span> !cache.<span style=color:#50fa7b>WaitForCacheSync</span>(stopCh, c.informer.HasSynced) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">120</span><span>		runtime.<span style=color:#50fa7b>HandleError</span>(fmt.<span style=color:#50fa7b>Errorf</span>(<span style=color:#f1fa8c>&#34;Timed out waiting for caches to sync&#34;</span>))
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">121</span><span>		<span style=color:#ff79c6>return</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">122</span><span>	}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">123</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">124</span><span>	<span style=color:#ff79c6>for</span> i <span style=color:#ff79c6>:=</span> <span style=color:#bd93f9>0</span>; i &lt; workers; i<span style=color:#ff79c6>++</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">125</span><span>		<span style=color:#ff79c6>go</span> wait.<span style=color:#50fa7b>Until</span>(c.runWorker, time.Second, stopCh)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">126</span><span>	}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">127</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">128</span><span>	<span style=color:#ff79c6>&lt;-</span>stopCh
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">129</span><span>	klog.<span style=color:#50fa7b>Info</span>(<span style=color:#f1fa8c>&#34;Stopping Pod controller&#34;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">130</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">131</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">132</span><span><span style=color:#8be9fd;font-style:italic>func</span> (c <span style=color:#ff79c6>*</span>Controller) <span style=color:#50fa7b>runWorker</span>() {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">133</span><span>	<span style=color:#ff79c6>for</span> c.<span style=color:#50fa7b>processNextItem</span>() {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">134</span><span>	}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">135</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">136</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">137</span><span><span style=color:#8be9fd;font-style:italic>func</span> <span style=color:#50fa7b>main</span>() {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">138</span><span>	<span style=color:#8be9fd;font-style:italic>var</span> kubeconfig <span style=color:#8be9fd>string</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">139</span><span>	<span style=color:#8be9fd;font-style:italic>var</span> master <span style=color:#8be9fd>string</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">140</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">141</span><span>	flag.<span style=color:#50fa7b>StringVar</span>(<span style=color:#ff79c6>&amp;</span>kubeconfig, <span style=color:#f1fa8c>&#34;kubeconfig&#34;</span>, <span style=color:#f1fa8c>&#34;&#34;</span>, <span style=color:#f1fa8c>&#34;absolute path to the kubeconfig file&#34;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">142</span><span>	flag.<span style=color:#50fa7b>StringVar</span>(<span style=color:#ff79c6>&amp;</span>master, <span style=color:#f1fa8c>&#34;master&#34;</span>, <span style=color:#f1fa8c>&#34;&#34;</span>, <span style=color:#f1fa8c>&#34;master url&#34;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">143</span><span>	flag.<span style=color:#50fa7b>Parse</span>()
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">144</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">145</span><span>	<span style=color:#6272a4>// creates the connection
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">146</span><span><span style=color:#6272a4></span>	config, err <span style=color:#ff79c6>:=</span> clientcmd.<span style=color:#50fa7b>BuildConfigFromFlags</span>(master, kubeconfig)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">147</span><span>	<span style=color:#ff79c6>if</span> err <span style=color:#ff79c6>!=</span> <span style=color:#ff79c6>nil</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">148</span><span>		klog.<span style=color:#50fa7b>Fatal</span>(err)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">149</span><span>	}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">150</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">151</span><span>	<span style=color:#6272a4>// creates the clientset
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">152</span><span><span style=color:#6272a4></span>	clientset, err <span style=color:#ff79c6>:=</span> kubernetes.<span style=color:#50fa7b>NewForConfig</span>(config)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">153</span><span>	<span style=color:#ff79c6>if</span> err <span style=color:#ff79c6>!=</span> <span style=color:#ff79c6>nil</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">154</span><span>		klog.<span style=color:#50fa7b>Fatal</span>(err)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">155</span><span>	}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">156</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">157</span><span>	<span style=color:#6272a4>// create an informer factory
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">158</span><span><span style=color:#6272a4></span>	informerFactory <span style=color:#ff79c6>:=</span> informers.<span style=color:#50fa7b>NewSharedInformerFactory</span>(clientset, time.Second<span style=color:#ff79c6>*</span><span style=color:#bd93f9>30</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">159</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">160</span><span>	<span style=color:#6272a4>// create an informer and lister for pods
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">161</span><span><span style=color:#6272a4></span>	informer <span style=color:#ff79c6>:=</span> informerFactory.<span style=color:#50fa7b>Core</span>().<span style=color:#50fa7b>V1</span>().<span style=color:#50fa7b>Pods</span>()
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">162</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">163</span><span>	<span style=color:#6272a4>// create the workqueue
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">164</span><span><span style=color:#6272a4></span>	queue <span style=color:#ff79c6>:=</span> workqueue.<span style=color:#50fa7b>NewRateLimitingQueue</span>(workqueue.<span style=color:#50fa7b>DefaultControllerRateLimiter</span>())
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">165</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">166</span><span>	<span style=color:#6272a4>// register the event handler with the informer
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">167</span><span><span style=color:#6272a4></span>	informer.<span style=color:#50fa7b>Informer</span>().<span style=color:#50fa7b>AddEventHandler</span>(cache.ResourceEventHandlerFuncs{
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">168</span><span>		AddFunc: <span style=color:#8be9fd;font-style:italic>func</span>(obj <span style=color:#8be9fd;font-style:italic>interface</span>{}) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">169</span><span>			key, err <span style=color:#ff79c6>:=</span> cache.<span style=color:#50fa7b>MetaNamespaceKeyFunc</span>(obj)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">170</span><span>			<span style=color:#ff79c6>if</span> err <span style=color:#ff79c6>==</span> <span style=color:#ff79c6>nil</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">171</span><span>				queue.<span style=color:#50fa7b>Add</span>(key)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">172</span><span>			}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">173</span><span>		},
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">174</span><span>		UpdateFunc: <span style=color:#8be9fd;font-style:italic>func</span>(old <span style=color:#8be9fd;font-style:italic>interface</span>{}, new <span style=color:#8be9fd;font-style:italic>interface</span>{}) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">175</span><span>			key, err <span style=color:#ff79c6>:=</span> cache.<span style=color:#50fa7b>MetaNamespaceKeyFunc</span>(new)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">176</span><span>			<span style=color:#ff79c6>if</span> err <span style=color:#ff79c6>==</span> <span style=color:#ff79c6>nil</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">177</span><span>				queue.<span style=color:#50fa7b>Add</span>(key)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">178</span><span>			}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">179</span><span>		},
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">180</span><span>		DeleteFunc: <span style=color:#8be9fd;font-style:italic>func</span>(obj <span style=color:#8be9fd;font-style:italic>interface</span>{}) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">181</span><span>			<span style=color:#6272a4>// IndexerInformer uses a delta queue, therefore for deletes we have to use this
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">182</span><span><span style=color:#6272a4></span>			<span style=color:#6272a4>// key function.
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">183</span><span><span style=color:#6272a4></span>			key, err <span style=color:#ff79c6>:=</span> cache.<span style=color:#50fa7b>DeletionHandlingMetaNamespaceKeyFunc</span>(obj)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">184</span><span>			<span style=color:#ff79c6>if</span> err <span style=color:#ff79c6>==</span> <span style=color:#ff79c6>nil</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">185</span><span>				queue.<span style=color:#50fa7b>Add</span>(key)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">186</span><span>			}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">187</span><span>		},
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">188</span><span>	})
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">189</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">190</span><span>	controller <span style=color:#ff79c6>:=</span> <span style=color:#50fa7b>NewController</span>(queue, informer.<span style=color:#50fa7b>Lister</span>(), informer.<span style=color:#50fa7b>Informer</span>())
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">191</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">192</span><span>	<span style=color:#6272a4>// Now let&#39;s start the controller
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">193</span><span><span style=color:#6272a4></span>	stop <span style=color:#ff79c6>:=</span> <span style=color:#8be9fd;font-style:italic>make</span>(<span style=color:#8be9fd;font-style:italic>chan</span> <span style=color:#8be9fd;font-style:italic>struct</span>{})
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">194</span><span>	<span style=color:#ff79c6>defer</span> <span style=color:#8be9fd;font-style:italic>close</span>(stop)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">195</span><span>	informerFactory.<span style=color:#50fa7b>Start</span>(stop)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">196</span><span>	<span style=color:#ff79c6>go</span> controller.<span style=color:#50fa7b>Run</span>(<span style=color:#bd93f9>1</span>, stop)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">197</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">198</span><span>	<span style=color:#6272a4>// Wait forever
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">199</span><span><span style=color:#6272a4></span>	<span style=color:#ff79c6>select</span> {}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">200</span><span>}</span></span></code></pre></div><h1 id=采用-controller-来处理自定义-crd>采用 Controller 来处理自定义 CRD</h1><p>在之前的章节中，我们了解到了如何编写一个 Controller 来监控和处理 Kubernetes 中内置的 Pod 资源对象。采用同样的方法，我们也可以编写一个 Controller 来处理自定义的 CRD 资源对象。</p><p>我们首先使用下面的 yaml 片段来在 Kubernetes 中创建一个自定义 CRD。该 yaml 文件中定义了名为 Foo 的自定义资源，该资源的 Spec 中有 deployment 和 replica 两个属性，可以看出是对 Deployment 的一个简单封装，即将一个 Deployment 的副本数设置为指定的数量。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>kubectl apply -f - &lt;&lt;EOF
</span></span><span style=display:flex><span><span style=color:#ff79c6>apiVersion</span>: apiextensions.k8s.io/v1
</span></span><span style=display:flex><span><span style=color:#ff79c6>kind</span>: CustomResourceDefinition
</span></span><span style=display:flex><span><span style=color:#ff79c6>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>name</span>: foos.samplecontroller.k8s.io
</span></span><span style=display:flex><span>  <span style=color:#6272a4># for more information on the below annotation, please see</span>
</span></span><span style=display:flex><span>  <span style=color:#6272a4># https://github.com/kubernetes/enhancements/blob/master/keps/sig-api-machinery/2337-k8s.io-group-protection/README.md</span>
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>annotations</span>:
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>&#34;api-approved.kubernetes.io&#34;: </span><span style=color:#f1fa8c>&#34;unapproved, experimental-only; please get an approval from Kubernetes API reviewers if you&#39;re trying to develop a CRD in the *.k8s.io or *.kubernetes.io groups&#34;</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>group</span>: samplecontroller.k8s.io
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>versions</span>:
</span></span><span style=display:flex><span>    - <span style=color:#ff79c6>name</span>: v1alpha1
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>served</span>: <span style=color:#ff79c6>true</span>
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>storage</span>: <span style=color:#ff79c6>true</span>
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>schema</span>:
</span></span><span style=display:flex><span>        <span style=color:#6272a4># schema used for validation</span>
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>openAPIV3Schema</span>:
</span></span><span style=display:flex><span>          <span style=color:#ff79c6>type</span>: object
</span></span><span style=display:flex><span>          <span style=color:#ff79c6>properties</span>:
</span></span><span style=display:flex><span>            <span style=color:#ff79c6>spec</span>:
</span></span><span style=display:flex><span>              <span style=color:#ff79c6>type</span>: object
</span></span><span style=display:flex><span>              <span style=color:#ff79c6>properties</span>:
</span></span><span style=display:flex><span>                <span style=color:#ff79c6>deploymentName</span>:
</span></span><span style=display:flex><span>                  <span style=color:#ff79c6>type</span>: string
</span></span><span style=display:flex><span>                <span style=color:#ff79c6>replicas</span>:
</span></span><span style=display:flex><span>                  <span style=color:#ff79c6>type</span>: integer
</span></span><span style=display:flex><span>                  <span style=color:#ff79c6>minimum</span>: <span style=color:#bd93f9>1</span>
</span></span><span style=display:flex><span>                  <span style=color:#ff79c6>maximum</span>: <span style=color:#bd93f9>10</span>
</span></span><span style=display:flex><span>            <span style=color:#ff79c6>status</span>:
</span></span><span style=display:flex><span>              <span style=color:#ff79c6>type</span>: object
</span></span><span style=display:flex><span>              <span style=color:#ff79c6>properties</span>:
</span></span><span style=display:flex><span>                <span style=color:#ff79c6>availableReplicas</span>:
</span></span><span style=display:flex><span>                  <span style=color:#ff79c6>type</span>: integer
</span></span><span style=display:flex><span>      <span style=color:#6272a4># subresources for the custom resource</span>
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>subresources</span>:
</span></span><span style=display:flex><span>        <span style=color:#6272a4># enables the status subresource</span>
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>status</span>: {}
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>names</span>:
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>kind</span>: Foo
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>plural</span>: foos
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>scope</span>: Namespaced
</span></span><span style=display:flex><span>EOF
</span></span></code></pre></div><p>在 Kubernetes 中创建了 Foo 这个 CRD 之后，我们可以采用 kubectl 命令行工具创建/删除/修改该 CRD 对应的资源。例如下面的代码片段将创建一个 名为 <code>example-foo</code> 的 Foo 资源。该资源要求将 example-foo 这个 Deployment 的副本数设置为5个。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>apply -f - &lt;&lt;EOF
</span></span><span style=display:flex><span><span style=color:#ff79c6>heredoc&gt; apiVersion</span>: samplecontroller.k8s.io/v1alpha1
</span></span><span style=display:flex><span><span style=color:#ff79c6>kind</span>: Foo
</span></span><span style=display:flex><span><span style=color:#ff79c6>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>name</span>: example-foo
</span></span><span style=display:flex><span><span style=color:#ff79c6>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>deploymentName</span>: example-foo
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>replicas</span>: <span style=color:#bd93f9>5</span>
</span></span><span style=display:flex><span>heredoc&gt; EOF
</span></span></code></pre></div><p>在前面章节的示例中，我们采用 <a href=#informer-%E6%9C%BA%E5%88%B6>Inoformer</a> 机制来对 Pod 进行监控和调谐；类似地，我们也希望采用类似的方式对新建的该自定义 CRD Foo 进行处理。但是 Kubernetes client go 中只有 Kubernetes 原生的 API 对象相关的接口，并不能处理自定义 CRD。为了对自定义 CRD 进行访问，Kubernetes 提供了 <a href=https://github.com/kubernetes/code-generator>k8s.io/code-generator</a> 代码生成工具，我们可以使用该工具来生成创建 Informer 需要的相关框架代码，包括 clientset，informers，listers 和 API 对象中相关数据结构的 DeepCopy 方法。</p><p>为了使用 go-generator 工具来生成我们需要的 go-client 代码，我们先采用 go 来编写和该 CRD 对应的数据结构。如下面的代码片段所示，CRD 的结构中主要包含下列的内容：</p><ul><li>TypeMeta - CRD 的 Group，Version 和 Kind</li><li>ObjectMeta - 标准的 k8s metadata 字段，包括 name 和 namespace</li><li>Spec - CRD 中的自定义字段</li><li>Status - Spec 对应的状态</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#6272a4>/* source code from https://github.com/kubernetes/sample-controller/blob/master/pkg/apis/samplecontroller/v1alpha1/types.go */</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>package</span> v1alpha1
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>import</span> (
</span></span><span style=display:flex><span>  metav1 <span style=color:#f1fa8c>&#34;k8s.io/apimachinery/pkg/apis/meta/v1&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4>// +genclient
</span></span></span><span style=display:flex><span><span style=color:#6272a4>// +k8s:deepcopy-gen:interfaces=k8s.io/apimachinery/pkg/runtime.Object
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>type</span> Foo <span style=color:#8be9fd;font-style:italic>struct</span> {
</span></span><span style=display:flex><span>  metav1.TypeMeta   <span style=color:#f1fa8c>`json:&#34;,inline&#34;`</span>
</span></span><span style=display:flex><span>  metav1.ObjectMeta <span style=color:#f1fa8c>`json:&#34;metadata,omitempty&#34;`</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  Spec   FooSpec   <span style=color:#f1fa8c>`json:&#34;spec&#34;`</span>
</span></span><span style=display:flex><span>  Status FooStatus <span style=color:#f1fa8c>`json:&#34;status&#34;`</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>type</span> FooSpec <span style=color:#8be9fd;font-style:italic>struct</span> {
</span></span><span style=display:flex><span>  DeploymentName <span style=color:#8be9fd>string</span> <span style=color:#f1fa8c>`json:&#34;deploymentName&#34;`</span>
</span></span><span style=display:flex><span>  Replicas       <span style=color:#ff79c6>*</span><span style=color:#8be9fd>int32</span> <span style=color:#f1fa8c>`json:&#34;replicas&#34;`</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>type</span> FooStatus <span style=color:#8be9fd;font-style:italic>struct</span> {
</span></span><span style=display:flex><span>  AvailableReplicas <span style=color:#8be9fd>int32</span> <span style=color:#f1fa8c>`json:&#34;availableReplicas&#34;`</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4>// +k8s:deepcopy-gen:interfaces=k8s.io/apimachinery/pkg/runtime.Object
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>
</span></span><span style=display:flex><span><span style=color:#6272a4>// FooList is a list of Foo resources
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span><span style=color:#8be9fd;font-style:italic>type</span> FooList <span style=color:#8be9fd;font-style:italic>struct</span> {
</span></span><span style=display:flex><span>  metav1.TypeMeta <span style=color:#f1fa8c>`json:&#34;,inline&#34;`</span>
</span></span><span style=display:flex><span>  metav1.ListMeta <span style=color:#f1fa8c>`json:&#34;metadata&#34;`</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  Items []Foo <span style=color:#f1fa8c>`json:&#34;items&#34;`</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>可以看到，在定义 CRD 的 go 代码中有类似 <code>// +...</code> 的注释（称为 Tag），go-generator 会根据这些 Tag 来生成 k8s go client 框架代码。</p><p>我们需要在 doc.go 文件中使用一个全局 tag <code>+k8s:deepcopy-gen=package</code> ，来为整个 package 中的所有数据结构生成 DeepCopy 方法。 DeepCopy 方法对数据结构进行深拷贝，当你需要在代码中对该一个对象进行修改，而又不希望影响其他使用到该对象的代码时，可以先对对象进行一次 DeepCopy，拿到该对象的一个副本后再进行操作。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#6272a4>/* source code from https://github.com/kubernetes/sample-controller/blob/master/pkg/apis/samplecontroller/v1alpha1/doc.go */</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4>// +k8s:deepcopy-gen=package
</span></span></span><span style=display:flex><span><span style=color:#6272a4>// +groupName=samplecontroller.k8s.io
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>
</span></span><span style=display:flex><span><span style=color:#6272a4>// Package v1alpha1 is the v1alpha1 version of the API.
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span><span style=color:#ff79c6>package</span> v1alpha1
</span></span></code></pre></div><p>Kubernetes client 要求注册到 Scheme 中的 API 对象必须实现 <code>runtime.Object</code> 接口。因此除了该全局 Tag 之外，我们可以看到在上面代码片段的 <code>Foo</code> 和 <code>FooList</code> 数据结构中，还采用了 <code>+k8s:deepcopy-gen:interfaces=k8s.io/apimachinery/pkg/runtime.Object</code> 本地 Tag 来告诉 <code>deepcoy-gen</code> 工具为这两个数据结构生成返回 <code>runtime.Objec</code> 对象的附加的 <code>DeepCopyObject</code> 方法。</p><p><code>+genclient</code> 和 <code>+groupName=samplecontroller.k8s.io</code> 则被 <code>client-gen</code> 工具用于生成 clientsent。此外，我们还需要使用 <code>informer-gen</code> 和 <code>lister-gen</code> 为自定义 CRD 生成 <code>informer</code> 和 <code>lister</code> 代码。</p><p>为自定义 CRD 生成 go client 代码的脚本在 <a href=https://github.com/zhaohuabing/k8scontrollertutorial/tree/main/hack>hack/update-codegen.sh</a> 中，生成的代码在本文参考文档的<a href=https://github.com/zhaohuabing/k8scontrollertutorial/tree/main/pkg/custom>该链接</a>中。</p><p>还需要注意的是必须创建一个 <a href=https://github.com/zhaohuabing/k8scontrollertutorial/blob/main/pkg/custom/apis/foo/v1alpha1/register.go>register.go</a> 文件，在该文件中把自定义 CRD 对应的 golang type 注册到 Scheme 中，否则编译时会报错。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#ff79c6>package</span> v1alpha1
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>import</span> (
</span></span><span style=display:flex><span>	metav1 <span style=color:#f1fa8c>&#34;k8s.io/apimachinery/pkg/apis/meta/v1&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#f1fa8c>&#34;k8s.io/apimachinery/pkg/runtime&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#f1fa8c>&#34;k8s.io/apimachinery/pkg/runtime/schema&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4>// GroupName is the group name used in this package
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span><span style=color:#8be9fd;font-style:italic>const</span> (
</span></span><span style=display:flex><span>	GroupName = <span style=color:#f1fa8c>&#34;samplecontroller.k8s.io&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4>// SchemeGroupVersion is group version used to register these objects
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span><span style=color:#8be9fd;font-style:italic>var</span> SchemeGroupVersion = schema.GroupVersion{Group: GroupName, Version: <span style=color:#f1fa8c>&#34;v1alpha1&#34;</span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4>// Kind takes an unqualified kind and returns back a Group qualified GroupKind
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span><span style=color:#8be9fd;font-style:italic>func</span> <span style=color:#50fa7b>Kind</span>(kind <span style=color:#8be9fd>string</span>) schema.GroupKind {
</span></span><span style=display:flex><span>	<span style=color:#ff79c6>return</span> SchemeGroupVersion.<span style=color:#50fa7b>WithKind</span>(kind).<span style=color:#50fa7b>GroupKind</span>()
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4>// Resource takes an unqualified resource and returns a Group qualified GroupResource
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span><span style=color:#8be9fd;font-style:italic>func</span> <span style=color:#50fa7b>Resource</span>(resource <span style=color:#8be9fd>string</span>) schema.GroupResource {
</span></span><span style=display:flex><span>	<span style=color:#ff79c6>return</span> SchemeGroupVersion.<span style=color:#50fa7b>WithResource</span>(resource).<span style=color:#50fa7b>GroupResource</span>()
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>var</span> (
</span></span><span style=display:flex><span>	<span style=color:#6272a4>// SchemeBuilder initializes a scheme builder
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>	SchemeBuilder = runtime.<span style=color:#50fa7b>NewSchemeBuilder</span>(addKnownTypes)
</span></span><span style=display:flex><span>	<span style=color:#6272a4>// AddToScheme is a global function that registers this API group &amp; version to a scheme
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>	AddToScheme = SchemeBuilder.AddToScheme
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4>// Adds the list of known types to Scheme.
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span><span style=color:#8be9fd;font-style:italic>func</span> <span style=color:#50fa7b>addKnownTypes</span>(scheme <span style=color:#ff79c6>*</span>runtime.Scheme) <span style=color:#8be9fd>error</span> {
</span></span><span style=display:flex><span>	scheme.<span style=color:#50fa7b>AddKnownTypes</span>(SchemeGroupVersion,
</span></span><span style=display:flex><span>		<span style=color:#ff79c6>&amp;</span>Foo{},
</span></span><span style=display:flex><span>		<span style=color:#ff79c6>&amp;</span>FooList{},
</span></span><span style=display:flex><span>	)
</span></span><span style=display:flex><span>	metav1.<span style=color:#50fa7b>AddToGroupVersion</span>(scheme, SchemeGroupVersion)
</span></span><span style=display:flex><span>	<span style=color:#ff79c6>return</span> <span style=color:#ff79c6>nil</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>最后我们就可以用生成的代码来编写该自定义 CRD 的 Controller 了，如下面的代码所示。可以看到，该代码和前面章节中通过 Shared Informer 来监控 Pod 的代码几乎一模一样。主要的区别是采用了 go generator 生成的 Foo 这个自定义 CRD 的 clientset，lnformer 和 lister 的相关 package 来替换 Kubernetes go client 自带的 Pod 的相关 package。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#ff79c6>package</span> main
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>import</span> (
</span></span><span style=display:flex><span>	<span style=color:#f1fa8c>&#34;flag&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#f1fa8c>&#34;fmt&#34;</span>
</span></span><span style=display:flex><span>	customscheme <span style=color:#f1fa8c>&#34;github.com/zhaohuabing/k8scontrollertutorial/pkg/custom/client/clientset/versioned/scheme&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#f1fa8c>&#34;k8s.io/client-go/kubernetes/scheme&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#f1fa8c>&#34;time&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	customclient <span style=color:#f1fa8c>&#34;github.com/zhaohuabing/k8scontrollertutorial/pkg/custom/client/clientset/versioned&#34;</span>
</span></span><span style=display:flex><span>	custominformers <span style=color:#f1fa8c>&#34;github.com/zhaohuabing/k8scontrollertutorial/pkg/custom/client/informers/externalversions&#34;</span>
</span></span><span style=display:flex><span>	customlisters <span style=color:#f1fa8c>&#34;github.com/zhaohuabing/k8scontrollertutorial/pkg/custom/client/listers/foo/v1alpha1&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#f1fa8c>&#34;k8s.io/apimachinery/pkg/api/errors&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#f1fa8c>&#34;k8s.io/apimachinery/pkg/util/runtime&#34;</span>
</span></span><span style=display:flex><span>	utilruntime <span style=color:#f1fa8c>&#34;k8s.io/apimachinery/pkg/util/runtime&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#f1fa8c>&#34;k8s.io/apimachinery/pkg/util/wait&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#f1fa8c>&#34;k8s.io/client-go/tools/cache&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#f1fa8c>&#34;k8s.io/client-go/tools/clientcmd&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#f1fa8c>&#34;k8s.io/client-go/util/workqueue&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#f1fa8c>&#34;k8s.io/klog/v2&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4>// Controller samplenstrates how to implement a controller with client-go.
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span><span style=color:#8be9fd;font-style:italic>type</span> Controller <span style=color:#8be9fd;font-style:italic>struct</span> {
</span></span><span style=display:flex><span>	lister   customlisters.FooLister
</span></span><span style=display:flex><span>	queue    workqueue.RateLimitingInterface
</span></span><span style=display:flex><span>	informer cache.Controller
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4>// NewController creates a new Controller.
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span><span style=color:#8be9fd;font-style:italic>func</span> <span style=color:#50fa7b>NewController</span>(queue workqueue.RateLimitingInterface, lister customlisters.FooLister,
</span></span><span style=display:flex><span>	informer cache.Controller) <span style=color:#ff79c6>*</span>Controller {
</span></span><span style=display:flex><span>	<span style=color:#ff79c6>return</span> <span style=color:#ff79c6>&amp;</span>Controller{
</span></span><span style=display:flex><span>		informer: informer,
</span></span><span style=display:flex><span>		lister:   lister,
</span></span><span style=display:flex><span>		queue:    queue,
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>func</span> (c <span style=color:#ff79c6>*</span>Controller) <span style=color:#50fa7b>processNextItem</span>() <span style=color:#8be9fd>bool</span> {
</span></span><span style=display:flex><span>	<span style=color:#6272a4>// Wait until there is a new item in the working queue
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>	key, quit <span style=color:#ff79c6>:=</span> c.queue.<span style=color:#50fa7b>Get</span>()
</span></span><span style=display:flex><span>	<span style=color:#ff79c6>if</span> quit {
</span></span><span style=display:flex><span>		<span style=color:#ff79c6>return</span> <span style=color:#ff79c6>false</span>
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#6272a4>// Tell the queue that we are done with processing this key. This unblocks the key for other workers
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>	<span style=color:#6272a4>// This allows safe parallel processing because two pods with the same key are never processed in
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>	<span style=color:#6272a4>// parallel.
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>	<span style=color:#ff79c6>defer</span> c.queue.<span style=color:#50fa7b>Done</span>(key)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#6272a4>// Invoke the method containing the business logic
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>	err <span style=color:#ff79c6>:=</span> c.<span style=color:#50fa7b>syncToStdout</span>(key.(<span style=color:#8be9fd>string</span>))
</span></span><span style=display:flex><span>	<span style=color:#6272a4>// Handle the error if something went wrong during the execution of the business logic
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>	c.<span style=color:#50fa7b>handleErr</span>(err, key)
</span></span><span style=display:flex><span>	<span style=color:#ff79c6>return</span> <span style=color:#ff79c6>true</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4>// syncToStdout is the business logic of the controller. In this controller it simply prints
</span></span></span><span style=display:flex><span><span style=color:#6272a4>// information about the pod to stdout. In case an error happened, it has to simply return the error.
</span></span></span><span style=display:flex><span><span style=color:#6272a4>// The retry logic should not be part of the business logic.
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span><span style=color:#8be9fd;font-style:italic>func</span> (c <span style=color:#ff79c6>*</span>Controller) <span style=color:#50fa7b>syncToStdout</span>(key <span style=color:#8be9fd>string</span>) <span style=color:#8be9fd>error</span> {
</span></span><span style=display:flex><span>	namespace, name, err <span style=color:#ff79c6>:=</span> cache.<span style=color:#50fa7b>SplitMetaNamespaceKey</span>(key)
</span></span><span style=display:flex><span>	<span style=color:#ff79c6>if</span> err <span style=color:#ff79c6>!=</span> <span style=color:#ff79c6>nil</span> {
</span></span><span style=display:flex><span>		utilruntime.<span style=color:#50fa7b>HandleError</span>(fmt.<span style=color:#50fa7b>Errorf</span>(<span style=color:#f1fa8c>&#34;invalid resource key: %s&#34;</span>, key))
</span></span><span style=display:flex><span>		<span style=color:#ff79c6>return</span> <span style=color:#ff79c6>nil</span>
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#6272a4>// Get the Foo resource with this namespace/name
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>	foo, err <span style=color:#ff79c6>:=</span> c.lister.<span style=color:#50fa7b>Foos</span>(namespace).<span style=color:#50fa7b>Get</span>(name)
</span></span><span style=display:flex><span>	<span style=color:#ff79c6>if</span> err <span style=color:#ff79c6>!=</span> <span style=color:#ff79c6>nil</span> {
</span></span><span style=display:flex><span>		<span style=color:#ff79c6>if</span> errors.<span style=color:#50fa7b>IsNotFound</span>(err) {
</span></span><span style=display:flex><span>			utilruntime.<span style=color:#50fa7b>HandleError</span>(fmt.<span style=color:#50fa7b>Errorf</span>(<span style=color:#f1fa8c>&#34;foo &#39;%s&#39; in work queue no longer exists&#34;</span>, key))
</span></span><span style=display:flex><span>			<span style=color:#ff79c6>return</span> <span style=color:#ff79c6>nil</span>
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#ff79c6>return</span> err
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#6272a4>// Note that you also have to check the uid if you have a local controlled resource, which
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>	<span style=color:#6272a4>// is dependent on the actual instance, to detect that a foo was recreated with the same name
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>	fmt.<span style=color:#50fa7b>Printf</span>(<span style=color:#f1fa8c>&#34;Sync/Add/Update for foo %s\n&#34;</span>, foo.<span style=color:#50fa7b>GetName</span>())
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#ff79c6>return</span> <span style=color:#ff79c6>nil</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4>// handleErr checks if an error happened and makes sure we will retry later.
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span><span style=color:#8be9fd;font-style:italic>func</span> (c <span style=color:#ff79c6>*</span>Controller) <span style=color:#50fa7b>handleErr</span>(err <span style=color:#8be9fd>error</span>, key <span style=color:#8be9fd;font-style:italic>interface</span>{}) {
</span></span><span style=display:flex><span>	<span style=color:#ff79c6>if</span> err <span style=color:#ff79c6>==</span> <span style=color:#ff79c6>nil</span> {
</span></span><span style=display:flex><span>		<span style=color:#6272a4>// Forget about the #AddRateLimited history of the key on every successful synchronization.
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>		<span style=color:#6272a4>// This ensures that future processing of updates for this key is not delayed because of
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>		<span style=color:#6272a4>// an outdated error history.
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>		c.queue.<span style=color:#50fa7b>Forget</span>(key)
</span></span><span style=display:flex><span>		<span style=color:#ff79c6>return</span>
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#6272a4>// This controller retries 5 times if something goes wrong. After that, it stops trying.
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>	<span style=color:#ff79c6>if</span> c.queue.<span style=color:#50fa7b>NumRequeues</span>(key) &lt; <span style=color:#bd93f9>5</span> {
</span></span><span style=display:flex><span>		klog.<span style=color:#50fa7b>Infof</span>(<span style=color:#f1fa8c>&#34;Error syncing foo %v: %v&#34;</span>, key, err)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#6272a4>// Re-enqueue the key rate limited. Based on the rate limiter on the
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>		<span style=color:#6272a4>// queue and the re-enqueue history, the key will be processed later again.
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>		c.queue.<span style=color:#50fa7b>AddRateLimited</span>(key)
</span></span><span style=display:flex><span>		<span style=color:#ff79c6>return</span>
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	c.queue.<span style=color:#50fa7b>Forget</span>(key)
</span></span><span style=display:flex><span>	<span style=color:#6272a4>// Report to an external entity that, even after several retries, we could not successfully process this key
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>	runtime.<span style=color:#50fa7b>HandleError</span>(err)
</span></span><span style=display:flex><span>	klog.<span style=color:#50fa7b>Infof</span>(<span style=color:#f1fa8c>&#34;Dropping foo %q out of the queue: %v&#34;</span>, key, err)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4>// Run begins watching and syncing.
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span><span style=color:#8be9fd;font-style:italic>func</span> (c <span style=color:#ff79c6>*</span>Controller) <span style=color:#50fa7b>Run</span>(workers <span style=color:#8be9fd>int</span>, stopCh <span style=color:#8be9fd;font-style:italic>chan</span> <span style=color:#8be9fd;font-style:italic>struct</span>{}) {
</span></span><span style=display:flex><span>	<span style=color:#ff79c6>defer</span> runtime.<span style=color:#50fa7b>HandleCrash</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#6272a4>// Let the workers stop when we are done
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>	<span style=color:#ff79c6>defer</span> c.queue.<span style=color:#50fa7b>ShutDown</span>()
</span></span><span style=display:flex><span>	klog.<span style=color:#50fa7b>Info</span>(<span style=color:#f1fa8c>&#34;Starting foo controller&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#ff79c6>go</span> c.informer.<span style=color:#50fa7b>Run</span>(stopCh)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#6272a4>// Wait for all involved caches to be synced, before processing items from the queue is started
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>	<span style=color:#ff79c6>if</span> !cache.<span style=color:#50fa7b>WaitForCacheSync</span>(stopCh, c.informer.HasSynced) {
</span></span><span style=display:flex><span>		runtime.<span style=color:#50fa7b>HandleError</span>(fmt.<span style=color:#50fa7b>Errorf</span>(<span style=color:#f1fa8c>&#34;Timed out waiting for caches to sync&#34;</span>))
</span></span><span style=display:flex><span>		<span style=color:#ff79c6>return</span>
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#ff79c6>for</span> i <span style=color:#ff79c6>:=</span> <span style=color:#bd93f9>0</span>; i &lt; workers; i<span style=color:#ff79c6>++</span> {
</span></span><span style=display:flex><span>		<span style=color:#ff79c6>go</span> wait.<span style=color:#50fa7b>Until</span>(c.runWorker, time.Second, stopCh)
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#ff79c6>&lt;-</span>stopCh
</span></span><span style=display:flex><span>	klog.<span style=color:#50fa7b>Info</span>(<span style=color:#f1fa8c>&#34;Stopping foo controller&#34;</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>func</span> (c <span style=color:#ff79c6>*</span>Controller) <span style=color:#50fa7b>runWorker</span>() {
</span></span><span style=display:flex><span>	<span style=color:#ff79c6>for</span> c.<span style=color:#50fa7b>processNextItem</span>() {
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>func</span> <span style=color:#50fa7b>main</span>() {
</span></span><span style=display:flex><span>	<span style=color:#8be9fd;font-style:italic>var</span> kubeconfig <span style=color:#8be9fd>string</span>
</span></span><span style=display:flex><span>	<span style=color:#8be9fd;font-style:italic>var</span> master <span style=color:#8be9fd>string</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	flag.<span style=color:#50fa7b>StringVar</span>(<span style=color:#ff79c6>&amp;</span>kubeconfig, <span style=color:#f1fa8c>&#34;kubeconfig&#34;</span>, <span style=color:#f1fa8c>&#34;&#34;</span>, <span style=color:#f1fa8c>&#34;absolute path to the kubeconfig file&#34;</span>)
</span></span><span style=display:flex><span>	flag.<span style=color:#50fa7b>StringVar</span>(<span style=color:#ff79c6>&amp;</span>master, <span style=color:#f1fa8c>&#34;master&#34;</span>, <span style=color:#f1fa8c>&#34;&#34;</span>, <span style=color:#f1fa8c>&#34;master url&#34;</span>)
</span></span><span style=display:flex><span>	flag.<span style=color:#50fa7b>Parse</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#6272a4>// Add sample-controller types to the default Kubernetes Scheme so Events can be
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>	<span style=color:#6272a4>// logged for sample-controller types.
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>	utilruntime.<span style=color:#50fa7b>Must</span>(customscheme.<span style=color:#50fa7b>AddToScheme</span>(scheme.Scheme))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#6272a4>// creates the connection
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>	config, err <span style=color:#ff79c6>:=</span> clientcmd.<span style=color:#50fa7b>BuildConfigFromFlags</span>(master, kubeconfig)
</span></span><span style=display:flex><span>	<span style=color:#ff79c6>if</span> err <span style=color:#ff79c6>!=</span> <span style=color:#ff79c6>nil</span> {
</span></span><span style=display:flex><span>		klog.<span style=color:#50fa7b>Fatal</span>(err)
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#6272a4>// creates the clientset
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>	clientset, err <span style=color:#ff79c6>:=</span> customclient.<span style=color:#50fa7b>NewForConfig</span>(config)
</span></span><span style=display:flex><span>	<span style=color:#ff79c6>if</span> err <span style=color:#ff79c6>!=</span> <span style=color:#ff79c6>nil</span> {
</span></span><span style=display:flex><span>		klog.<span style=color:#50fa7b>Fatal</span>(err)
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#6272a4>// create an informer factory
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>	informerFactory <span style=color:#ff79c6>:=</span> custominformers.<span style=color:#50fa7b>NewSharedInformerFactory</span>(clientset, time.Second<span style=color:#ff79c6>*</span><span style=color:#bd93f9>30</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#6272a4>// create an informer and lister for foo
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>	informer <span style=color:#ff79c6>:=</span> informerFactory.<span style=color:#50fa7b>Samplecontroller</span>().<span style=color:#50fa7b>V1alpha1</span>().<span style=color:#50fa7b>Foos</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#6272a4>// create the workqueue
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>	queue <span style=color:#ff79c6>:=</span> workqueue.<span style=color:#50fa7b>NewRateLimitingQueue</span>(workqueue.<span style=color:#50fa7b>DefaultControllerRateLimiter</span>())
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#6272a4>// register the event handler with the informer
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>	informer.<span style=color:#50fa7b>Informer</span>().<span style=color:#50fa7b>AddEventHandler</span>(cache.ResourceEventHandlerFuncs{
</span></span><span style=display:flex><span>		AddFunc: <span style=color:#8be9fd;font-style:italic>func</span>(obj <span style=color:#8be9fd;font-style:italic>interface</span>{}) {
</span></span><span style=display:flex><span>			key, err <span style=color:#ff79c6>:=</span> cache.<span style=color:#50fa7b>MetaNamespaceKeyFunc</span>(obj)
</span></span><span style=display:flex><span>			<span style=color:#ff79c6>if</span> err <span style=color:#ff79c6>==</span> <span style=color:#ff79c6>nil</span> {
</span></span><span style=display:flex><span>				queue.<span style=color:#50fa7b>Add</span>(key)
</span></span><span style=display:flex><span>			}
</span></span><span style=display:flex><span>		},
</span></span><span style=display:flex><span>		UpdateFunc: <span style=color:#8be9fd;font-style:italic>func</span>(old <span style=color:#8be9fd;font-style:italic>interface</span>{}, new <span style=color:#8be9fd;font-style:italic>interface</span>{}) {
</span></span><span style=display:flex><span>			key, err <span style=color:#ff79c6>:=</span> cache.<span style=color:#50fa7b>MetaNamespaceKeyFunc</span>(new)
</span></span><span style=display:flex><span>			<span style=color:#ff79c6>if</span> err <span style=color:#ff79c6>==</span> <span style=color:#ff79c6>nil</span> {
</span></span><span style=display:flex><span>				queue.<span style=color:#50fa7b>Add</span>(key)
</span></span><span style=display:flex><span>			}
</span></span><span style=display:flex><span>		},
</span></span><span style=display:flex><span>		DeleteFunc: <span style=color:#8be9fd;font-style:italic>func</span>(obj <span style=color:#8be9fd;font-style:italic>interface</span>{}) {
</span></span><span style=display:flex><span>			<span style=color:#6272a4>// IndexerInformer uses a delta queue, therefore for deletes we have to use this
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>			<span style=color:#6272a4>// key function.
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>			key, err <span style=color:#ff79c6>:=</span> cache.<span style=color:#50fa7b>DeletionHandlingMetaNamespaceKeyFunc</span>(obj)
</span></span><span style=display:flex><span>			<span style=color:#ff79c6>if</span> err <span style=color:#ff79c6>==</span> <span style=color:#ff79c6>nil</span> {
</span></span><span style=display:flex><span>				queue.<span style=color:#50fa7b>Add</span>(key)
</span></span><span style=display:flex><span>			}
</span></span><span style=display:flex><span>		},
</span></span><span style=display:flex><span>	})
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	controller <span style=color:#ff79c6>:=</span> <span style=color:#50fa7b>NewController</span>(queue, informer.<span style=color:#50fa7b>Lister</span>(), informer.<span style=color:#50fa7b>Informer</span>())
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#6272a4>// Now let&#39;s start the controller
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>	stop <span style=color:#ff79c6>:=</span> <span style=color:#8be9fd;font-style:italic>make</span>(<span style=color:#8be9fd;font-style:italic>chan</span> <span style=color:#8be9fd;font-style:italic>struct</span>{})
</span></span><span style=display:flex><span>	<span style=color:#ff79c6>defer</span> <span style=color:#8be9fd;font-style:italic>close</span>(stop)
</span></span><span style=display:flex><span>	informerFactory.<span style=color:#50fa7b>Start</span>(stop)
</span></span><span style=display:flex><span>	<span style=color:#ff79c6>go</span> controller.<span style=color:#50fa7b>Run</span>(<span style=color:#bd93f9>1</span>, stop)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#6272a4>// Wait forever
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>	<span style=color:#ff79c6>select</span> {}
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h1 id=leader-election>Leader Election</h1><p>在实际部署时，为了保证 Controller 的高可用，我们常常同时运行多个 Controller 实例。在这种情况下，多个 Controller 实例之间需要进行 Leader Election。被选中成为 Leader 的 Controller 实例才执行 Watch 和 Reconcile 逻辑，其余 Controller 处于等待状态。当 Leader 出现问题后，另一个实例会被重新选为 Leader，接替原 Leader 继续执行。</p><p>要在应用程序中实现 Leader Election，我们可以部署一个共享 KV 存储系统如 ZooKeeper, etcd 或者 Consul，在其中创建一个用于选主的 kv 节点，KV 存储系统可以保证写操作的原子性，因此多个实例可以通过竞争设置节点的值来实现选主；也可以自己在应用程序中实现选主的算法。为了简化 Controller 的编写，Kubernetes client-go 中提供了 <a href=https://pkg.go.dev/k8s.io/client-go/tools/leaderelection>leaderelection</a> package。该 package 通过将 Kubernetes 的 lease 资源作为分布式锁来实现了选主逻辑。Kubernetes 为 Controller 的 Leader Election 创建一个 Lease 对象，该对象 spec 中的 holderIdentity 是当前的 Leader，一般会使用 Leader 的 pod name 作为 Identity。leaseDurationSeconds 是锁的租赁时间，renewTime 则是上一次的更新时间。参与选举的实例会判断当前是否存在该 Lease 对象，如果不存在，则会创建一个 Lease 对象，并将 holderIdentity 设为自己，成为 Leader 并执行调谐逻辑。其他实例则会定期检测该 Lease 对象，如果发现租赁过期，则会试图将 holderIdentity 设为自己，成为新的 Leader。</p><blockquote><p>备注：Kubernetes client go 曾使用 ConfigMap 和 Endpoint 资源对象来作为分布式锁，并通过资源对象上的 annotation 来记录 Leader Election 信息。不过相对于使用 annotation，lease 资源的 spec 更适用于表示分布式锁的语义。</p></blockquote><p>下面的 yaml 片段是一个 Lease 资源的例子：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#ff79c6>apiVersion</span>: coordination.k8s.io/v1
</span></span><span style=display:flex><span><span style=color:#ff79c6>kind</span>: Lease
</span></span><span style=display:flex><span><span style=color:#ff79c6>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>creationTimestamp</span>: <span style=color:#f1fa8c>&#34;2023-04-02T03:36:42Z&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>name</span>: sample-controller-lock
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>namespace</span>: kube-system
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>resourceVersion</span>: <span style=color:#f1fa8c>&#34;1156206&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>uid</span>: bb58f519-ec4b-4e1f-a2d1-923366c33926
</span></span><span style=display:flex><span><span style=color:#ff79c6>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>acquireTime</span>: <span style=color:#f1fa8c>&#34;2023-04-02T03:36:42.000000Z&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>holderIdentity</span>: sample-controller-5c4497489b-tcfjm
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>leaseDurationSeconds</span>: <span style=color:#bd93f9>60</span>
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>leaseTransitions</span>: <span style=color:#bd93f9>0</span>
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>renewTime</span>: <span style=color:#f1fa8c>&#34;2023-04-02T05:19:14.533852Z&#34;</span>
</span></span></code></pre></div><p>Kubernetes Client go 已经封装了上面描述的选举逻辑，我们可以直接使用封装后的代码，不必关心 Leader Election 的实现细节。下面是添加了 Leader Election 的代码片段，完整代码参见文后的链接。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>func</span> <span style=color:#50fa7b>main</span>() {
</span></span><span style=display:flex><span>	<span style=color:#ff79c6>...</span>. 略
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	controller <span style=color:#ff79c6>:=</span> <span style=color:#50fa7b>NewController</span>(queue, informer.<span style=color:#50fa7b>Lister</span>(), informer.<span style=color:#50fa7b>Informer</span>())
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#6272a4>// Now let&#39;s start the controller
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>	stop <span style=color:#ff79c6>:=</span> <span style=color:#8be9fd;font-style:italic>make</span>(<span style=color:#8be9fd;font-style:italic>chan</span> <span style=color:#8be9fd;font-style:italic>struct</span>{})
</span></span><span style=display:flex><span>	<span style=color:#ff79c6>defer</span> <span style=color:#8be9fd;font-style:italic>close</span>(stop)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	kubeclient, err <span style=color:#ff79c6>:=</span> kubernetes.<span style=color:#50fa7b>NewForConfig</span>(config)
</span></span><span style=display:flex><span>	<span style=color:#ff79c6>if</span> err <span style=color:#ff79c6>!=</span> <span style=color:#ff79c6>nil</span> {
</span></span><span style=display:flex><span>		klog.<span style=color:#50fa7b>Fatal</span>(err)
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	rl, err <span style=color:#ff79c6>:=</span> <span style=color:#50fa7b>getResourceLock</span>(kubeclient)
</span></span><span style=display:flex><span>	<span style=color:#ff79c6>if</span> err <span style=color:#ff79c6>!=</span> <span style=color:#ff79c6>nil</span> {
</span></span><span style=display:flex><span>		klog.<span style=color:#50fa7b>Fatal</span>(err)
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	leaderelection.<span style=color:#50fa7b>RunOrDie</span>(context.<span style=color:#50fa7b>TODO</span>(), leaderelection.LeaderElectionConfig{
</span></span><span style=display:flex><span>		Lock:          rl,
</span></span><span style=display:flex><span>		LeaseDuration: <span style=color:#bd93f9>60</span> <span style=color:#ff79c6>*</span> time.Second,
</span></span><span style=display:flex><span>		RenewDeadline: <span style=color:#bd93f9>15</span> <span style=color:#ff79c6>*</span> time.Second,
</span></span><span style=display:flex><span>		RetryPeriod:   <span style=color:#bd93f9>5</span> <span style=color:#ff79c6>*</span> time.Second,
</span></span><span style=display:flex><span>		Callbacks: leaderelection.LeaderCallbacks{
</span></span><span style=display:flex><span>			OnStartedLeading: <span style=color:#8be9fd;font-style:italic>func</span>(ctx context.Context) {
</span></span><span style=display:flex><span>				informerFactory.<span style=color:#50fa7b>Start</span>(stop)
</span></span><span style=display:flex><span>				<span style=color:#ff79c6>go</span> controller.<span style=color:#50fa7b>Run</span>(<span style=color:#bd93f9>1</span>, stop)
</span></span><span style=display:flex><span>			},
</span></span><span style=display:flex><span>			OnStoppedLeading: <span style=color:#8be9fd;font-style:italic>func</span>() {
</span></span><span style=display:flex><span>				klog.<span style=color:#50fa7b>Info</span>(<span style=color:#f1fa8c>&#34;leaderelection lost&#34;</span>)
</span></span><span style=display:flex><span>			},
</span></span><span style=display:flex><span>			OnNewLeader: <span style=color:#8be9fd;font-style:italic>func</span>(identity <span style=color:#8be9fd>string</span>) {
</span></span><span style=display:flex><span>				<span style=color:#ff79c6>if</span> identity <span style=color:#ff79c6>==</span> rl.<span style=color:#50fa7b>Identity</span>() {
</span></span><span style=display:flex><span>					klog.<span style=color:#50fa7b>Info</span>(<span style=color:#f1fa8c>&#34;leaderelection won&#34;</span>)
</span></span><span style=display:flex><span>				}
</span></span><span style=display:flex><span>			},
</span></span><span style=display:flex><span>		},
</span></span><span style=display:flex><span>	})
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#6272a4>// Wait forever
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>	<span style=color:#ff79c6>select</span> {}
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>func</span> <span style=color:#50fa7b>getResourceLock</span>(client <span style=color:#ff79c6>*</span>kubernetes.Clientset) (resourcelock.Interface, <span style=color:#8be9fd>error</span>) {
</span></span><span style=display:flex><span>	lockName <span style=color:#ff79c6>:=</span> <span style=color:#f1fa8c>&#34;sample-controller-lock&#34;</span>
</span></span><span style=display:flex><span>	lockNamespace <span style=color:#ff79c6>:=</span> <span style=color:#f1fa8c>&#34;kube-system&#34;</span>
</span></span><span style=display:flex><span>	identity, err <span style=color:#ff79c6>:=</span> os.<span style=color:#50fa7b>Hostname</span>()
</span></span><span style=display:flex><span>	<span style=color:#ff79c6>if</span> err <span style=color:#ff79c6>!=</span> <span style=color:#ff79c6>nil</span> {
</span></span><span style=display:flex><span>		<span style=color:#ff79c6>return</span> <span style=color:#ff79c6>nil</span>, err
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#ff79c6>return</span> resourcelock.<span style=color:#50fa7b>New</span>(
</span></span><span style=display:flex><span>		resourcelock.LeasesResourceLock,
</span></span><span style=display:flex><span>		lockNamespace,
</span></span><span style=display:flex><span>		lockName,
</span></span><span style=display:flex><span>		client.<span style=color:#50fa7b>CoreV1</span>(),
</span></span><span style=display:flex><span>		client.<span style=color:#50fa7b>CoordinationV1</span>(),
</span></span><span style=display:flex><span>		resourcelock.ResourceLockConfig{
</span></span><span style=display:flex><span>			Identity: identity,
</span></span><span style=display:flex><span>		},
</span></span><span style=display:flex><span>	)
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h1 id=使用-controller-runtime-和-kubebuilder>使用 Controller Runtime 和 Kubebuilder</h1><p>在本文 Pod 和 Foo 的 Controller 示例中，我们采用了 client-go 提供的 Informer 来编写 Controller。但其实我们还可以使用 Controller runtime 或者 kubebuilder 这两个框架来编写 Controller，这两个框架提供了比 Informer 更高层次的抽象，可以进一步简化我们的代码。</p><p>下面是采用 Informer，Controller runtime 和 Kubebuilder 来编写 Controller 的区别：</p><ul><li><p>直接使用 Informer：直接使用 Informer 编写 Controller 需要编写更多的代码，因为我们需要在代码处理更多的底层细节，例如如何在集群中监视资源，以及如何处理资源变化的通知。但是，使用 Informer 也可以更加自定义和灵活，因为我们可以更细粒度地控制 Controller 的行为。</p></li><li><p>Controller runtime：Controller runtime 是基于 Informer 实现的，在 Informer 之上为 Controller 编写提供了高级别的抽象和帮助类，包括 Leader Election、Event Handling 和 Reconcile Loop 等等。使用 Controller runtime，可以更容易地编写和测试 Controller，因为它已经处理了许多底层的细节。</p></li><li><p>Kubebuilder：和 Informer 及 Controller runtime 不同，Kubebuilder 并不是一个代码库，而是一个开发框架。Kubebuilder 底层使用了 controller-runtime。Kubebuilder 提供了 CRD 生成器和代码生成器等工具，可以帮助开发者自动生成一些重复性的代码和资源定义，提高开发效率。同时，Kubebuilder 还可以生成 Webhooks，以用于验证自定义资源。</p></li></ul><p>我们将在本系列的后续文章中继续介绍 Controller runtime 和 Kubebuilder 两种机制。</p><h1 id=参考文档>参考文档</h1><ul><li><a href=https://kubernetes.io/docs/reference/using-api/api-concepts/#efficient-detection-of-changes>Kubernetes API Concepts: Efficient detection of changes</a></li><li><a href=https://github.com/kubernetes/sample-controller/blob/master/docs/controller-client-go.md>client-go under the hood</a></li><li><a href=https://vivilearns2code.github.io/k8s/2021/03/11/writing-controllers-for-kubernetes-custom-resources.html>Writing Controllers For Kubernetes Resources</a></li><li><a href=https://github.com/kubernetes/sample-controller>Kubernetes sample controller</a></li><li><a href=https://github.com/kubernetes/code-generator>Kubernetes code generator</a></li><li><a href=https://book.kubebuilder.io/cronjob-tutorial/gvks.html#err-but-whats-that-scheme-thing>Groups and Versions and Kinds, oh my!</a></li><li><a href=https://pkg.go.dev/k8s.io/client-go/tools/leaderelection>Leader Election</a></li><li><a href=https://kubernetes.io/docs/concepts/architecture/leases/>Leases</a></li><li><a href=https://github.com/zhaohuabing/k8scontrollertutorial>本文中的示例源码</a></li></ul><div class="entry-shang text-center"><p>「真诚赞赏，手留余香」</p><button class="zs show-zs btn btn-bred">赞赏支持</button></div><div class=zs-modal-bg></div><div class=zs-modal-box><div class=zs-modal-head><button type=button class=close>×</button>
<span class=author><a href=https://lopins.github.io/hugo-template/><img src=/hugo-template/img/favicon.png>Huabing Blog</a></span><p class=tip><i></i><span>真诚赞赏，手留余香</span></p></div><div class=zs-modal-body><div class=zs-modal-btns><button class="btn btn-blink" data-num=2>2元</button>
<button class="btn btn-blink" data-num=5>5元</button>
<button class="btn btn-blink" data-num=10>10元</button>
<button class="btn btn-blink" data-num=50>50元</button>
<button class="btn btn-blink" data-num=100>100元</button>
<button class="btn btn-blink" data-num=1>任意金额</button></div><div class=zs-modal-pay><button class="btn btn-bred" id=pay-text>2元</button><p>使用<span id=pay-type>微信</span>扫描二维码完成支付</p><img src=/hugo-template/img/reward/wechat-2.png id=pay-image></div></div><div class=zs-modal-footer><label><input type=radio name=zs-type value=wechat class=zs-type checked><span><span class=zs-wechat><img src=/hugo-template/img/reward/wechat-btn.png></span></label>
<label><input type=radio name=zs-type value=alipay class=zs-type class=zs-alipay><img src=/hugo-template/img/reward/alipay-btn.png></span></label></div></div><script type=text/javascript src=/hugo-template/js/reward.js></script><hr><ul class=pager><li class=previous><a href=/hugo-template/post/2023-02-24-aeraki-mesh-community-meeting/ data-toggle=tooltip data-placement=top title="Aeraki Mesh Community Meeting - February 23rd, 2023">&larr;
Previous Post</a></li><li class=next><a href=/hugo-template/post/2023-04-04-how-to-create-a-k8s-controller-2/ data-toggle=tooltip data-placement=top title="Kubernetes Controller 机制详解（二）">Next
Post &rarr;</a></li></ul><link href=https://xxx.xxx.com/dist/Artalk.css rel=stylesheet><script src=https://xxx.xxx.com/dist/Artalk.js></script><div id=Comments></div><script>Artalk.init({el:"#Comments",pageKey:"https://lopins.github.io/hugo-template/post/2023-03-09-how-to-create-a-k8s-controller/",pageTitle:"Kubernetes Controller 机制详解（一）",server:"https://xxx.xxx.com",site:"xxx blog"})</script></div><div class="col-lg-2 col-lg-offset-0
visible-lg-block
sidebar-container
catalog-container"><div class=side-catalog><hr class="hidden-sm hidden-xs"><h5><a class=catalog-toggle href=#>CATALOG</a></h5><ul class=catalog-body></ul></div></div><div class="col-lg-8 col-lg-offset-2
col-md-10 col-md-offset-1
sidebar-container"><section><hr class="hidden-sm hidden-xs"><h5><a href=/tags/>FEATURED TAGS</a></h5><div class=tags><a href=/tags/aeraki title=aeraki>aeraki
</a><a href=/tags/aeraki-mesh title="aeraki mesh">aeraki mesh
</a><a href=/tags/ambient-mesh title="ambient mesh">ambient mesh
</a><a href=/tags/api-gateway title="api gateway">api gateway
</a><a href=/tags/bitcoin title=bitcoin>bitcoin
</a><a href=/tags/blockchain title=blockchain>blockchain
</a><a href=/tags/cka title=cka>cka
</a><a href=/tags/cncf title=cncf>cncf
</a><a href=/tags/cryptocurrency title=cryptocurrency>cryptocurrency
</a><a href=/tags/digital-signature title="digital signature">digital signature
</a><a href=/tags/docker title=docker>docker
</a><a href=/tags/dubbo title=dubbo>dubbo
</a><a href=/tags/envoy title=envoy>envoy
</a><a href=/tags/envoy-gateway title="envoy gateway">envoy gateway
</a><a href=/tags/ingress title=ingress>ingress
</a><a href=/tags/istio title=istio>istio
</a><a href=/tags/jaeger title=jaeger>jaeger
</a><a href=/tags/kafka title=kafka>kafka
</a><a href=/tags/knowledge-graph title="knowledge graph">knowledge graph
</a><a href=/tags/kubecon title=kubecon>kubecon
</a><a href=/tags/kubernetes title=kubernetes>kubernetes
</a><a href=/tags/linux title=linux>linux
</a><a href=/tags/loadbalancer title=loadbalancer>loadbalancer
</a><a href=/tags/metaprotocol title=metaprotocol>metaprotocol
</a><a href=/tags/microservice title=microservice>microservice
</a><a href=/tags/network title=network>network
</a><a href=/tags/network-service-mesh title="network service mesh">network service mesh
</a><a href=/tags/nfv title=nfv>nfv
</a><a href=/tags/nodeport title=nodeport>nodeport
</a><a href=/tags/onap title=onap>onap
</a><a href=/tags/opentracing title=opentracing>opentracing
</a><a href=/tags/pilot title=pilot>pilot
</a><a href=/tags/proxy-protocol title="proxy protocol">proxy protocol
</a><a href=/tags/redis title=redis>redis
</a><a href=/tags/sdn title=sdn>sdn
</a><a href=/tags/security title=security>security
</a><a href=/tags/service-mesh title="service mesh">service mesh
</a><a href=/tags/tencent title=tencent>tencent
</a><a href=/tags/x-forwarded-for title=x-forwarded-for>x-forwarded-for</a></div></section><section><hr><h5>FRIENDS</h5><ul class=list-inline><li><a target=_blank href=https://zhaozhihan.com>Linda的博客</a></li></ul></section></div></div></div></article><footer><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><ul class="list-inline text-center"><li><a href=mailto:youremail@gmail.com><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fas fa-envelope fa-stack-1x fa-inverse"></i></span></a></li><li><a target=_blank href=/hugo-template/your%20wechat%20qr%20code%20image><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-weixin fa-stack-1x fa-inverse"></i></span></a></li><li><a target=_blank href=https://github.com/yourgithub><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-github fa-stack-1x fa-inverse"></i></span></a></li><li><a target=_blank href=https://www.linkedin.com/in/yourlinkedinid><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-linkedin fa-stack-1x fa-inverse"></i></span></a></li><li><a target=_blank href=https://stackoverflow.com/users/yourstackoverflowid><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-stack-overflow fa-stack-1x fa-inverse"></i></span></a></li><li><a href rel=alternate type=application/rss+xml title="Huabing Blog"><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fas fa-rss fa-stack-1x fa-inverse"></i></span></a></li></ul><p class="copyright text-muted">Copyright &copy; Huabing Blog 2024<br><a href=https://themes.gohugo.io/hugo-theme-cleanwhite>CleanWhite Hugo Theme</a> by <a href=https://zhaohuabing.com>Huabing</a> |
<iframe style=margin-left:2px;margin-bottom:-5px frameborder=0 scrolling=0 width=100px height=20px src="https://ghbtns.com/github-btn.html?user=zhaohuabing&repo=hugo-theme-cleanwhite&type=star&count=true"></iframe></p></div></div></div></footer><script>function loadAsync(e,t){var s=document,o="script",n=s.createElement(o),i=s.getElementsByTagName(o)[0];n.src=e,t&&n.addEventListener("load",function(e){t(null,e)},!1),i.parentNode.insertBefore(n,i)}</script><script>$("#tag_cloud").length!==0&&loadAsync("/js/jquery.tagcloud.js",function(){$.fn.tagcloud.defaults={color:{start:"#bbbbee",end:"#0085a1"}},$("#tag_cloud a").tagcloud()})</script><script>loadAsync("https://cdn.jsdelivr.net/npm/fastclick@1.0.6/lib/fastclick.min.js",function(){var e=document.querySelector("nav");e&&FastClick.attach(e)})</script><script type=text/javascript>function generateCatalog(e){_containerSelector="div.post-container";var t,n,s,o,i,a=$(_containerSelector),r=a.find("h1,h2,h3,h4,h5,h6");return $(e).html(""),r.each(function(){t=$(this).prop("tagName").toLowerCase(),o="#"+$(this).prop("id"),n=$(this).text(),i=$('<a href="'+o+'" rel="nofollow">'+n+"</a>"),s=$('<li class="'+t+'_nav"></li>').append(i),$(e).append(s)}),!0}generateCatalog(".catalog-body"),$(".catalog-toggle").click(function(e){e.preventDefault(),$(".side-catalog").toggleClass("fold")}),loadAsync("/hugo-template/js/jquery.nav.js",function(){$(".catalog-body").onePageNav({currentClass:"active",changeHash:!1,easing:"swing",filter:"",scrollSpeed:700,scrollOffset:0,scrollThreshold:.2,begin:null,end:null,scrollChange:null,padding:80})})</script></body></html>