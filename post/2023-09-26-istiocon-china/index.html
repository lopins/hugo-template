<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta property="og:site_name" content="Huabing Blog"><meta property="og:type" content="article"><meta property="og:image" content="img/2023-09-26-istiocon-china/background.jpg"><meta property="twitter:image" content="img/2023-09-26-istiocon-china/background.jpg"><meta name=title content="IstioCon 2023 要点总结"><meta property="og:title" content="IstioCon 2023 要点总结"><meta property="twitter:title" content="IstioCon 2023 要点总结"><meta name=description content="赵化冰，程序员, 开源爱好者，生活探险家 | 这里是 赵化冰 的博客，与你一起发现更大的世界。"><meta property="og:description" content="赵化冰，程序员, 开源爱好者，生活探险家 | 这里是 赵化冰 的博客，与你一起发现更大的世界。"><meta property="twitter:description" content="赵化冰，程序员, 开源爱好者，生活探险家 | 这里是 赵化冰 的博客，与你一起发现更大的世界。"><meta property="twitter:card" content="summary"><meta name=keyword content="赵化冰, zhaohuabing, Zhaohuabing, , 赵化冰的网络日志, 赵化冰的博客, Zhaohuabing Blog, 博客, 个人网站, 互联网, Web, 云原生, PaaS, Istio, Kubernetes, 微服务, Microservice"><link rel="shortcut icon" href=/hugo-template/img/favicon.ico><title>IstioCon 2023 要点总结 | 赵化冰的博客 | Zhaohuabing Blog</title>
<link rel=canonical href=/hugo-template/post/2023-09-26-istiocon-china/><link rel=stylesheet href=/hugo-template/css/bootstrap.min.css><link rel=stylesheet href=/hugo-template/css/hugo-theme-cleanwhite.min.css><link rel=stylesheet href=/hugo-template/css/zanshang.css><link rel=stylesheet href=/hugo-template/css/font-awesome.all.min.css><script src=/hugo-template/js/jquery.min.js></script><script src=/hugo-template/js/bootstrap.min.js></script><script src=/hugo-template/js/hux-blog.min.js></script><script src=/hugo-template/js/lazysizes.min.js></script></head><nav class="navbar navbar-default navbar-custom navbar-fixed-top"><div class=container-fluid><div class="navbar-header page-scroll"><button type=button class=navbar-toggle>
<span class=sr-only>Toggle navigation</span>
<span class=icon-bar></span>
<span class=icon-bar></span>
<span class=icon-bar></span>
</button>
<a class=navbar-brand href=/>Huabing Blog</a></div><div id=huxblog_navbar><div class=navbar-collapse><ul class="nav navbar-nav navbar-right"><li><a href=/>All Posts</a></li><li><a href=/hugo-template/categories/books/>books</a></li><li><a href=/hugo-template/categories/open-source/>open source</a></li><li><a href=/hugo-template/categories/presentations/>presentations</a></li><li><a href=/hugo-template/categories/tech/>tech</a></li><li><a href=/archive//>ARCHIVE</a></li><li><a href=/notes//>NOTES</a></li><li><a href=/about//>ABOUT</a></li><li><a href=/hugo-template/search><i class="fa fa-search"></i></a></li></ul></div></div></div></nav><script>var $body=document.body,$toggle=document.querySelector(".navbar-toggle"),$navbar=document.querySelector("#huxblog_navbar"),$collapse=document.querySelector(".navbar-collapse");$toggle.addEventListener("click",handleMagic);function handleMagic(){$navbar.className.indexOf("in")>0?($navbar.className=" ",setTimeout(function(){$navbar.className.indexOf("in")<0&&($collapse.style.height="0px")},400)):($collapse.style.height="auto",$navbar.className+=" in")}</script><style type=text/css>header.intro-header{background-image:url(/hugo-template/img/2023-09-26-istiocon-china/background.jpg)}</style><header class=intro-header><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><div class=post-heading><div class=tags></div><h1>IstioCon 2023 要点总结</h1><h2 class=subheading>IstioCon 2023 Key Takeaways</h2><span class=meta>Posted by
赵化冰
on
Tuesday, September 26, 2023</span></div></div></div></div></header><article><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2
col-md-10 col-md-offset-1
post-container"><h2 id=istio-ambient-mesh-as-managed-infrastructure>Istio Ambient Mesh as Managed Infrastructure</h2><p>这个演讲是 Google 的 Sponsored Keynote，从中可以非常清晰地看到 Google 在 Istio 社区中推动 Ambient 模式的思路：<strong>通过在 Istio 中提供 Ambient 模式，可以使得数据面的组件也可以从用户工作负载中剥离出来，成为和 LB 类似的云上的托管服务。</strong> 这样 Istio 就可以真正成为一个基础设施，而不是和应用一起部署在用户集群。</p><p><strong>当 sidecar proxy 从容器 Pod 中剥离出来成为单独部署的 Ztunnel 和 WayPoint 后，这两个组件的部署已经和应用解耦，为云厂商将这两个组件进行托管扫清了障碍。</strong></p><p>数据面托管的具体思路是：目前独立部署的 Ztunnel 组件和集群 CNI 组件都会对集群节点网络进行配置，在两者没有很好配合的情况下很容易发生冲突，这也是目前 Ambient 模式遇到的一个困难之一。解决方案是将 Ztunnel 和集群 CNI 集成在一起，成为一个增强的 CNI，从而简化 Ambient 模式中的数据面部署。可以预见，后续会有很多 CNI 插件和云厂商提供的 CNI 会集成 Ztunnel 能力。除此以外，云厂商也可以提供托管的 Waypoint。由于 Istio 控制面托管已经是一个常见的模式，这样 Istio 的 控制面和数据面的全部组件都可以由云厂商进行托管，从而带来以下好处：</p><ul><li>服务网格真正下沉到基础设施层，完全对用户集群透明</li><li>用户无需关心服务网格的运维，包括安装、升级、管理等</li><li>云厂商可以更方便地提供服务网格的云服务</li></ul><p>该方案既解决了用户使用服务网格的运维问题，也解决了云厂商提供服务网格的商业模式问题，是一个非常好的思路。</p><p><img src=https://zhaohuabing.com/static/img/2023-09-26-istiocon-china/1.jpg alt></p><p><img src=https://zhaohuabing.com/static/img/2023-09-26-istiocon-china/2.jpg alt></p><p><img src=https://zhaohuabing.com/static/img/2023-09-26-istiocon-china/3.jpg alt></p><h2 id=istio数据平面的新选择架构创新带来的全新性能体验>Istio数据平面的新选择：架构创新带来的全新性能体验</h2><p>华为基于 ebpf 实现的一个新的 Istio 数据面，意图将 L4 和 L7 的能力都基于 ebpf 在内核中实现，以避免内核态和用户态切换，减少数据面的延迟。</p><p><img src=https://zhaohuabing.com/static/img/2023-09-26-istiocon-china/kmesh-1.png alt></p><p>kmesh 采用了一个其称为 “伪建链” 的技术，在收到 downstream 的 TCP 请求时， ebpf 程序先和 downstream 创建一个 “伪 TCP 链接”，而并不会和 upstream 服务真正创建链接。当 ebpf 程序拿到 downstream 发出的 HTTP 消息后，根据 HTTP 消息进行七层路由处理，找到其目的服务，然后再和 upstream 创建链接。通过这种方式，kmesh 将 L7 的处理下沉到了内核中。</p><p><img src=https://zhaohuabing.com/static/img/2023-09-26-istiocon-china/kmesh-2.png alt></p><p>当然，由于内核 ebpf vm 的一些限制，可以推测 kmesh 实现的七层路由能力应该有限，不能和用户态模式的数据面完全对齐。kmesh 应该是 Istio 其他数据面模式的一种补充，而不是替代。主要用于对于延迟非常敏感的应用场景下。kmesh 也支持和 sidecar 模式一起运行。</p><p><img src=https://zhaohuabing.com/static/img/2023-09-26-istiocon-china/kmesh-3.png alt></p><p>从分享的性能测试对比来看，kmesh 的性能确实有很大提升，其 P90 时延和 kube-proxy 基本相同，相比 sidecar 模式则有数倍的提升。</p><p><img src=https://zhaohuabing.com/static/img/2023-09-26-istiocon-china/kmesh-4.png alt></p><p>该项目已经在 Github 开源，地址：https://github.com/kmesh-net/kmesh</p><p>可以看到各大厂商都在 Istio 数据面上进行创新，不过这对 Istio 控制面也带来了较大的挑战。在加入 Ambient 模式支持后，Istio 控制面已经足够复杂，也许 <strong>Istio 在七层上也需要一个类似于 Kubernetes CNI 那样简单清晰的接口来抽象不同的数据面实现</strong>。</p><h2 id=cert-manager有助于增强istio证书管理的安全性和灵活性>Cert-manager有助于增强Istio证书管理的安全性和灵活性</h2><p>超盟的分享也许不总是很时髦，但是总是很实用。这次分享的内容是如何使用 cert-manager 来管理 Istio 的证书。证书管理是 Istio 使用过程中的一个常见的问题。虽然 Istio 可以自动生成一个自签名根证书来为工作负载自动颁发和更新证书，但在生产环境下，我们一般不会使用该方案（例如多集群下该方案就会有问题，跨集群的服务证书无法相互建立信任），会引入一个第三方根证书，该根证书的签发和轮换需要进行管理。</p><p>cert-manager 是一个 Kubernetes 上的证书管理工具，可以帮助用户自动化地颁发、更新和删除证书。该分享主要介绍了如何使用 cert-manager 来管理 Istio CA 和 Ingress Gateway 的证书。</p><p>cert-manager 会连接到 CA provider，然后生成 CSR，调用 CA Provider 提供的服务生成 Istio CA 的证书。cert-manager 会将证书存储到 Kubernetes 的 Secret 中，然后 Istio CA 会从 Secret 中读取证书。</p><p><img src=https://zhaohuabing.com/static/img/2023-09-26-istiocon-china/cm-1.png alt>
<img src=https://zhaohuabing.com/static/img/2023-09-26-istiocon-china/cm-2.png alt>
<img src=https://zhaohuabing.com/static/img/2023-09-26-istiocon-china/cm-3.png alt>
<img src=https://zhaohuabing.com/static/img/2023-09-26-istiocon-china/cm-4.png alt>
<img src=https://zhaohuabing.com/static/img/2023-09-26-istiocon-china/cm-5.png alt></p><h2 id=基于-istio-和-virtual-kubelet-的无服务器服务网格>基于 Istio 和 Virtual Kubelet 的无服务器服务网格</h2><p>阿里分享了采用 VK（Virtual Kubelet） 来实现无服务器网格的思路：VK 是集群中的一个虚拟节点，用户在使用时只需要将 VK 作为普通节点一样加入到集群中。VK 的主要优势是其节点本身的容量是可以弹性伸缩的，并不需要提前规划。因此 VK 的该一特性可以很好地用于 waypoint 代理的部署：数据面实现了弹性伸缩-无需提前规划 node 容量。</p><p>更进一步，waypoint 还可以部署到云厂商自身的托管资源池中，然后通过托管池的弹性伸缩能力来实现 waypoint 的弹性伸缩。</p><p>可以看到阿里 VK 无服务器网格的思路和 Google 的思路类似，都是<strong>通过托管控制面和数据面来的方式将服务网格从用户集群中剥离出去，使其成为一个云上的基础设施</strong>。这应该也是未来云厂商提供服务网格的主要发展方向。</p><p><img src=https://zhaohuabing.com/static/img/2023-09-26-istiocon-china/vk-1.png alt>
<img src=https://zhaohuabing.com/static/img/2023-09-26-istiocon-china/vk-2.png alt>
<img src=https://zhaohuabing.com/static/img/2023-09-26-istiocon-china/vk-3.png alt>
<img src=https://zhaohuabing.com/static/img/2023-09-26-istiocon-china/vk-4.png alt></p><h2 id=其他>其他</h2><p>来自印尼的朋友 Zufar Dhiyaulhaq 分享了采用 Coraza Proxy WASM 来扩展 Envoy， 快速实现自定义 WAF （Web Application Firewall）的实践。 WAF 在企业应用中，特别是金融、银行、保险等对安全要求严格的行业是一个非常重要的产品。传统的 WAF 产品通常是一个独立的设备，需要单独部署和管理，而且需要和应用进行集成。Coraza Proxy WASM 可以将 WAF 的能力下沉到 Envoy 中，从而实现无缝集成。而且由于采用了 WASM 来实现，可以非常方便地扩展和定制 WAF 的能力。</p><p><img src=https://zhaohuabing.com/static/img/2023-09-26-istiocon-china/waf.png alt></p><p>Coraza Proxy WASM 也是我公司（<a href=https://tetrate.io/>Tetrate.io</a>）贡献的一个开源项目，欢迎大家关注。</p><p><a href=https://github.com/corazawaf/coraza-proxy-wasm>https://github.com/corazawaf/coraza-proxy-wasm</a></p><p>我和 Boss 直聘的 覃士林 一起分享了 Aeraki Mesh 在 Boss 直聘中的 Dubbo 服务治理实践。大家有兴趣的话可以从 <a href=https://istioconchina2023.sched.com/>https://istioconchina2023.sched.com/</a> <a href=https://istioconchina2023.sched.com/>下载</a> 演讲 PPT。本文提到的其他演讲 PPT 也都可以从 <a href=https://istioconchina2023.sched.com/>https://istioconchina2023.sched.com/</a> 下载。</p><p><img src=https://zhaohuabing.com/static/img/2023-09-26-istiocon-china/boss-architecture.png alt></p><div class="entry-shang text-center"><p>「真诚赞赏，手留余香」</p><button class="zs show-zs btn btn-bred">赞赏支持</button></div><div class=zs-modal-bg></div><div class=zs-modal-box><div class=zs-modal-head><button type=button class=close>×</button>
<span class=author><a href=https://lopins.github.io/hugo-template/><img src=/hugo-template/img/favicon.png>Huabing Blog</a></span><p class=tip><i></i><span>真诚赞赏，手留余香</span></p></div><div class=zs-modal-body><div class=zs-modal-btns><button class="btn btn-blink" data-num=2>2元</button>
<button class="btn btn-blink" data-num=5>5元</button>
<button class="btn btn-blink" data-num=10>10元</button>
<button class="btn btn-blink" data-num=50>50元</button>
<button class="btn btn-blink" data-num=100>100元</button>
<button class="btn btn-blink" data-num=1>任意金额</button></div><div class=zs-modal-pay><button class="btn btn-bred" id=pay-text>2元</button><p>使用<span id=pay-type>微信</span>扫描二维码完成支付</p><img src=/hugo-template/img/reward/wechat-2.png id=pay-image></div></div><div class=zs-modal-footer><label><input type=radio name=zs-type value=wechat class=zs-type checked><span><span class=zs-wechat><img src=/hugo-template/img/reward/wechat-btn.png></span></label>
<label><input type=radio name=zs-type value=alipay class=zs-type class=zs-alipay><img src=/hugo-template/img/reward/alipay-btn.png></span></label></div></div><script type=text/javascript src=/hugo-template/js/reward.js></script><hr><ul class=pager><li class=previous><a href=/hugo-template/post/2023-06-24-aeraki-1.4.0/ data-toggle=tooltip data-placement=top title="Aeraki Mesh 发布 1.4.0 版本（代号：Heshun）">&larr;
Previous Post</a></li><li class=next><a href=/hugo-template/post/envoy-thread-local--storage/ data-toggle=tooltip data-placement=top title>Next
Post &rarr;</a></li></ul><link href=https://xxx.xxx.com/dist/Artalk.css rel=stylesheet><script src=https://xxx.xxx.com/dist/Artalk.js></script><div id=Comments></div><script>Artalk.init({el:"#Comments",pageKey:"https://lopins.github.io/hugo-template/post/2023-09-26-istiocon-china/",pageTitle:"IstioCon 2023 要点总结",server:"https://xxx.xxx.com",site:"xxx blog"})</script></div><div class="col-lg-2 col-lg-offset-0
visible-lg-block
sidebar-container
catalog-container"><div class=side-catalog><hr class="hidden-sm hidden-xs"><h5><a class=catalog-toggle href=#>CATALOG</a></h5><ul class=catalog-body></ul></div></div><div class="col-lg-8 col-lg-offset-2
col-md-10 col-md-offset-1
sidebar-container"><section><hr class="hidden-sm hidden-xs"><h5><a href=/tags/>FEATURED TAGS</a></h5><div class=tags><a href=/tags/aeraki title=aeraki>aeraki
</a><a href=/tags/aeraki-mesh title="aeraki mesh">aeraki mesh
</a><a href=/tags/ambient-mesh title="ambient mesh">ambient mesh
</a><a href=/tags/api-gateway title="api gateway">api gateway
</a><a href=/tags/bitcoin title=bitcoin>bitcoin
</a><a href=/tags/blockchain title=blockchain>blockchain
</a><a href=/tags/cka title=cka>cka
</a><a href=/tags/cncf title=cncf>cncf
</a><a href=/tags/cryptocurrency title=cryptocurrency>cryptocurrency
</a><a href=/tags/digital-signature title="digital signature">digital signature
</a><a href=/tags/docker title=docker>docker
</a><a href=/tags/dubbo title=dubbo>dubbo
</a><a href=/tags/envoy title=envoy>envoy
</a><a href=/tags/envoy-gateway title="envoy gateway">envoy gateway
</a><a href=/tags/ingress title=ingress>ingress
</a><a href=/tags/istio title=istio>istio
</a><a href=/tags/jaeger title=jaeger>jaeger
</a><a href=/tags/kafka title=kafka>kafka
</a><a href=/tags/knowledge-graph title="knowledge graph">knowledge graph
</a><a href=/tags/kubecon title=kubecon>kubecon
</a><a href=/tags/kubernetes title=kubernetes>kubernetes
</a><a href=/tags/linux title=linux>linux
</a><a href=/tags/loadbalancer title=loadbalancer>loadbalancer
</a><a href=/tags/metaprotocol title=metaprotocol>metaprotocol
</a><a href=/tags/microservice title=microservice>microservice
</a><a href=/tags/network title=network>network
</a><a href=/tags/network-service-mesh title="network service mesh">network service mesh
</a><a href=/tags/nfv title=nfv>nfv
</a><a href=/tags/nodeport title=nodeport>nodeport
</a><a href=/tags/onap title=onap>onap
</a><a href=/tags/opentracing title=opentracing>opentracing
</a><a href=/tags/pilot title=pilot>pilot
</a><a href=/tags/proxy-protocol title="proxy protocol">proxy protocol
</a><a href=/tags/redis title=redis>redis
</a><a href=/tags/sdn title=sdn>sdn
</a><a href=/tags/security title=security>security
</a><a href=/tags/service-mesh title="service mesh">service mesh
</a><a href=/tags/tencent title=tencent>tencent
</a><a href=/tags/x-forwarded-for title=x-forwarded-for>x-forwarded-for</a></div></section><section><hr><h5>FRIENDS</h5><ul class=list-inline><li><a target=_blank href=https://zhaozhihan.com>Linda的博客</a></li></ul></section></div></div></div></article><footer><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><ul class="list-inline text-center"><li><a href=mailto:youremail@gmail.com><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fas fa-envelope fa-stack-1x fa-inverse"></i></span></a></li><li><a target=_blank href=/hugo-template/your%20wechat%20qr%20code%20image><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-weixin fa-stack-1x fa-inverse"></i></span></a></li><li><a target=_blank href=https://github.com/yourgithub><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-github fa-stack-1x fa-inverse"></i></span></a></li><li><a target=_blank href=https://www.linkedin.com/in/yourlinkedinid><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-linkedin fa-stack-1x fa-inverse"></i></span></a></li><li><a target=_blank href=https://stackoverflow.com/users/yourstackoverflowid><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-stack-overflow fa-stack-1x fa-inverse"></i></span></a></li><li><a href rel=alternate type=application/rss+xml title="Huabing Blog"><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fas fa-rss fa-stack-1x fa-inverse"></i></span></a></li></ul><p class="copyright text-muted">Copyright &copy; Huabing Blog 2024<br><a href=https://themes.gohugo.io/hugo-theme-cleanwhite>CleanWhite Hugo Theme</a> by <a href=https://zhaohuabing.com>Huabing</a> |
<iframe style=margin-left:2px;margin-bottom:-5px frameborder=0 scrolling=0 width=100px height=20px src="https://ghbtns.com/github-btn.html?user=zhaohuabing&repo=hugo-theme-cleanwhite&type=star&count=true"></iframe></p></div></div></div></footer><script>function loadAsync(e,t){var s=document,o="script",n=s.createElement(o),i=s.getElementsByTagName(o)[0];n.src=e,t&&n.addEventListener("load",function(e){t(null,e)},!1),i.parentNode.insertBefore(n,i)}</script><script>$("#tag_cloud").length!==0&&loadAsync("/js/jquery.tagcloud.js",function(){$.fn.tagcloud.defaults={color:{start:"#bbbbee",end:"#0085a1"}},$("#tag_cloud a").tagcloud()})</script><script>loadAsync("https://cdn.jsdelivr.net/npm/fastclick@1.0.6/lib/fastclick.min.js",function(){var e=document.querySelector("nav");e&&FastClick.attach(e)})</script><script type=text/javascript>function generateCatalog(e){_containerSelector="div.post-container";var t,n,s,o,i,a=$(_containerSelector),r=a.find("h1,h2,h3,h4,h5,h6");return $(e).html(""),r.each(function(){t=$(this).prop("tagName").toLowerCase(),o="#"+$(this).prop("id"),n=$(this).text(),i=$('<a href="'+o+'" rel="nofollow">'+n+"</a>"),s=$('<li class="'+t+'_nav"></li>').append(i),$(e).append(s)}),!0}generateCatalog(".catalog-body"),$(".catalog-toggle").click(function(e){e.preventDefault(),$(".side-catalog").toggleClass("fold")}),loadAsync("/hugo-template/js/jquery.nav.js",function(){$(".catalog-body").onePageNav({currentClass:"active",changeHash:!1,easing:"swing",filter:"",scrollSpeed:700,scrollOffset:0,scrollThreshold:.2,begin:null,end:null,scrollChange:null,padding:80})})</script></body></html>